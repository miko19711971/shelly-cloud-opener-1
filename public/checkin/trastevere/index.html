<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Check-in Guide — Viale Trastevere 108</title>
<link rel="icon" href="building-entrance.jpg">
<style>
  :root { --brand:#2b2118; --ink:#1f2937; --muted:#6b7280; --bg:#f7f7f7; --card:#ffffff; --line:#e5e7eb; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:860px;margin:0 auto;padding:16px}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--line);padding:12px 14px;z-index:5}
  h1{font-size:20px;margin:0}
  .addr{font-size:14px;color:var(--muted)}
  .langbar{font-size:14px;margin-top:6px;color:var(--muted)}
  .lang-btn{font-weight:700;margin-right:10px;text-decoration:none;color:var(--ink)}
  .lang-btn.active{text-decoration:underline}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;margin:14px 0}
  .step{display:flex;gap:12px;align-items:flex-start}
  .num{flex:0 0 36px;height:36px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
  h2{margin:6px 0 8px 0;font-size:18px}
  p{margin:6px 0;line-height:1.45}
  figure{margin:10px 0}
  img{max-width:100%;height:auto;border-radius:10px;border:1px solid var(--line);display:block}
  figcaption{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
  .cta{display:inline-block;margin-top:10px;padding:10px 12px;border-radius:10px;background:var(--brand);color:#fff;text-decoration:none}
  .status{font-size:13px;color:#6b7280;margin-top:6px}
  footer{color:var(--muted);text-align:center;font-size:12px;margin:18px 0}
</style>
<script>
  async function openWith(statusId, path){
    const s = document.getElementById(statusId);
    try{
      s.textContent = 'Generating one-time key…';
      const r = await fetch(path, {cache:'no-store'});
      const j = await r.json();
      if (j && j.url){ s.textContent = 'Key OK. Redirecting…'; location.href = j.url; }
      else { s.textContent = (j && (j.error||j.message)) ? String(j.error||j.message) : 'No URL returned.'; }
    }catch(e){ s.textContent = String(e); }
  }
</script>
</head>
<body>
<header class="wrap">
  <h1 id="title">Check-in Guide — Viale Trastevere 108</h1>
  <div class="addr" id="addr">Address: Viale Trastevere 108, Rome • Intercom: B-9 “Chiani”</div>
  <div class="langbar" id="langbar"></div>
</header>

<main class="wrap">
  <!-- 1 -->
  <section class="card">
    <div class="step">
      <div class="num">1</div>
      <div>
        <h2 id="s1_t">Arriving at the Building</h2>
        <p id="s1_p">When you arrive at the entrance shown below, you’ve reached your destination.</p>
        <figure>
          <img src="building-entrance.jpg" alt="Building entrance / passageway to the courtyard">
          <figcaption id="s1_cap">Building entrance / passageway to the courtyard.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- 2 -->
  <section class="card">
    <div class="step">
      <div class="num">2</div>
      <div>
        <h2 id="s2_t">Using the Intercom</h2>
        <p><span id="s2_p1">Press B-9 (Chiani) on the intercom panel.</span></p>
        <figure>
          <img id="s2_img" src="intercom-b9.jpg" alt="Intercom panel — press B-9 (Chiani)">
          <figcaption id="s2_cap">Intercom panel — press B-9 (Chiani).</figcaption>
        </figure>

        <!-- Bottone di apertura (spostato qui) -->
        <a class="cta" href="#" onclick="openWith('statusBuilding','/token/leonina-building');return false;" id="btn_building">Open Building Gate</a>
        <div class="status" id="statusBuilding"></div>
      </div>
    </div>
  </section>

  <!-- 3 -->
  <section class="card">
    <div class="step">
      <div class="num">3</div>
      <div>
        <h2 id="s3_t">Go Through the Passage</h2>
        <p id="s3_p">Walk straight through the passage to the inner gate.</p>
        <figure>
          <img src="corridor-gate.jpg" alt="Walk straight to the inner gate">
          <figcaption id="s3_cap">Walk straight to the inner gate.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- 4 -->
  <section class="card">
    <div class="step">
      <div class="num">4</div>
      <div>
        <h2 id="s4_t">Reaching the Apartment</h2>
        <p id="s4_p1">Take the stairs/elevator to the 4th floor.</p>
        <figure>
          <img src="apartment-door.jpg" alt="Apartment door">
          <figcaption id="s4_cap">Apartment door.</figcaption>
        </figure>

        <a class="cta" href="#" onclick="openWith('statusDoor','/token/leonina-door');return false;" id="btn_door">Open Apartment Door</a>
        <div class="status" id="statusDoor"></div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2 id="help">Need help?</h2>
    <p id="call">Call or WhatsApp: <a class="cta" href="tel:+393355245756">+39 335 524 5756</a></p>
  </section>

  <footer id="footer">niceflatinrome.com • Quick visual check-in guide</footer>
</main>

<script>
  /* ---- DIZIONARIO CON 5 LINGUE (bottoni inclusi) ---- */
  const T = {
    en: { langName:'English', langLabel:'Language',
      title:'Check-in Guide — Viale Trastevere 108',
      addressLine:'Address: Viale Trastevere 108, Rome • Intercom: B-9 “Chiani”',
      help:'Need help?', call:'Call or WhatsApp', phone:'+39 335 524 5756',
      s1_t:'Arriving at the Building', s1_p:'When you arrive at the entrance shown below, you’ve reached your destination.', s1_cap:'Building entrance / passageway to the courtyard.',
      s2_t:'Using the Intercom', s2_p1:'Press B-9 (Chiani) on the intercom panel.', s2_cap:'Intercom panel — press B-9 (Chiani).',
      s3_t:'Go Through the Passage', s3_p:'Walk straight through the passage to the inner gate.', s3_cap:'Walk straight to the inner gate.',
      s4_t:'Reaching the Apartment', s4_p1:'Take the stairs/elevator to the 4th floor.', s4_cap:'Apartment door.',
      btn_building:'Open Building Gate', btn_door:'Open Apartment Door',
      footer:'niceflatinrome.com • Quick visual check-in guide'
    },
    it: { langName:'Italiano', langLabel:'Lingua',
      title:'Guida Check-in — Viale Trastevere 108',
      addressLine:'Indirizzo: Viale Trastevere 108, Roma • Citofono: B-9 “Chiani”',
      help:'Serve aiuto?', call:'Chiama o WhatsApp', phone:'+39 335 524 5756',
      s1_t:'Arrivo al palazzo', s1_p:'Quando vedi l’ingresso qui sotto, sei arrivato a destinazione.', s1_cap:'Ingresso / passaggio verso il cortile.',
      s2_t:'Uso del citofono', s2_p1:'Premi B-9 (Chiani) sul pannello del citofono.', s2_cap:'Pannello citofono — premi B-9 (Chiani).',
      s3_t:'Attraversa il passaggio', s3_p:'Prosegui dritto fino al cancelletto interno.', s3_cap:'Dritto fino al cancelletto interno.',
      s4_t:'Raggiungere l’appartamento', s4_p1:'Scala/ascensore fino al 4° piano.', s4_cap:'Porta dell’appartamento.',
      btn_building:'Apri cancello', btn_door:'Apri Porta Appartamento',
      footer:'niceflatinrome.com • Guida rapida di check-in'
    },
    fr: { langName:'Français', langLabel:'Langue',
      title:'Guide d’enregistrement — Viale Trastevere 108',
      addressLine:'Adresse : Viale Trastevere 108, Rome • Interphone : B-9 « Chiani »',
      help:'Besoin d’aide ?', call:'Appeler ou WhatsApp', phone:'+39 335 524 5756',
      s1_t:'Arriver à l’immeuble', s1_p:'Lorsque vous voyez l’entrée ci-dessous, vous êtes arrivés à destination.', s1_cap:'Entrée de l’immeuble / passage vers la cour.',
      s2_t:'Utiliser l’interphone', s2_p1:'Appuyez sur B-9 (Chiani) sur l’interphone.', s2_cap:'Panneau d’interphone — appuyez sur B-9 (Chiani).',
      s3_t:'Traversez le passage', s3_p:'Allez tout droit jusqu’au portail intérieur.', s3_cap:'Tout droit jusqu’au portail intérieur.',
      s4_t:'Rejoindre l’appartement', s4_p1:'Prenez l’escalier/l’ascenseur jusqu’au 4e étage.', s4_cap:'Porte de l’appartement.',
      btn_building:'Ouvrir le portail', btn_door:'Ouvrir la porte de l’appartement',
      footer:'niceflatinrome.com • Guide visuel rapide de check-in'
    },
    de: { langName:'Deutsch', langLabel:'Sprache',
      title:'Check-in-Leitfaden — Viale Trastevere 108',
      addressLine:'Adresse: Viale Trastevere 108, Rom • Gegensprechanlage: B-9 „Chiani“',
      help:'Brauchen Sie Hilfe?', call:'Anrufen oder WhatsApp', phone:'+39 335 524 5756',
      s1_t:'Ankunft am Gebäude', s1_p:'Wenn Sie den unten gezeigten Eingang sehen, sind Sie am Ziel.', s1_cap:'Gebäudeeingang / Durchgang zum Innenhof.',
      s2_t:'Gegensprechanlage benutzen', s2_p1:'Drücken Sie B-9 (Chiani) an der Gegensprechanlage.', s2_cap:'Gegensprechanlage — drücken Sie B-9 (Chiani).',
      s3_t:'Durch den Durchgang gehen', s3_p:'Gehen Sie geradeaus bis zum inneren Tor.', s3_cap:'Geradeaus bis zum inneren Tor.',
      s4_t:'Zum Apartment gelangen', s4_p1:'Nehmen Sie die Treppe/den Aufzug in den 4. Stock.', s4_cap:'Apartmenttür.',
      btn_building:'Tor öffnen', btn_door:'Wohnungstür öffnen',
      footer:'niceflatinrome.com • Kurzanleitung für den Check-in'
    },
    es: { langName:'Español', langLabel:'Idioma',
      title:'Guía de check-in — Viale Trastevere 108',
      addressLine:'Dirección: Viale Trastevere 108, Roma • Portero: B-9 “Chiani”',
      help:'¿Necesitas ayuda?', call:'Llama o WhatsApp', phone:'+39 335 524 5756',
      s1_t:'Llegada al edificio', s1_p:'Cuando veas la entrada que aparece abajo, habrás llegado a tu destino.', s1_cap:'Entrada del edificio / pasaje hacia el patio.',
      s2_t:'Uso del portero', s2_p1:'Pulsa B-9 (Chiani) en el panel del portero.', s2_cap:'Panel del portero — pulsa B-9 (Chiani).',
      s3_t:'Cruza el pasaje', s3_p:'Sigue recto hasta la puerta interior.', s3_cap:'Recto hasta la puerta interior.',
      s4_t:'Llegar al apartamento', s4_p1:'Toma las escaleras/el ascensor hasta el 4º piso.', s4_cap:'Puerta del apartamento.',
      btn_building:'Abrir el portón', btn_door:'Abrir la puerta del apartamento',
      footer:'niceflatinrome.com • Guía visual rápida de check-in'
    }
  };

  const q = new URLSearchParams(location.search);
  const lang = (q.get('lang')||'en').toLowerCase();
  const L = T[lang] || T.en;

  // barra lingue
  const buttons = Object.entries(T).map(([code,v])=>{
    const cls = (code===lang)?'lang-btn active':'lang-btn';
    return `<a class="${cls}" href="?lang=${code}">${v.langName}</a>`;
  }).join(' ');
  document.getElementById('langbar').innerHTML = `${L.langLabel}: ${buttons}`;

  // helper sicuro
  const setText = (id, text) => {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
  };

  setText('title', L.title);
  setText('addr', L.addressLine);
  setText('s1_t', L.s1_t);
  setText('s1_p', L.s1_p);
  setText('s1_cap', L.s1_cap);
  setText('s2_t', L.s2_t);
  setText('s2_p1', L.s2_p1);
  setText('s2_cap', L.s2_cap);
  setText('s3_t', L.s3_t);
  setText('s3_p', L.s3_p);
  setText('s3_cap', L.s3_cap);
  setText('s4_t', L.s4_t);
  setText('s4_p1', L.s4_p1);
  setText('s4_cap', L.s4_cap);
  setText('help', L.help);
  // "Call or WhatsApp: " + link già presente
  const call = document.getElementById('call');
  if (call && call.firstChild) call.firstChild.textContent = L.call + ': ';
  // bottoni localizzati
  setText('btn_building', L.btn_building);
  setText('btn_door', L.btn_door);
  // telefono nel testo (se mai servisse in futuro)
  const phoneEl = document.getElementById('phone');
  if (phoneEl) phoneEl.textContent = L.phone;
  const phone2El = document.getElementById('phone2');
  if (phone2El) phone2El.textContent = L.phone;
  setText('footer', L.footer);
</script>
</body>
</html>
