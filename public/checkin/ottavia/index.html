<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guida Check-in — Via del Portico d’Ottavia 1D</title>
<link rel="icon" href="./building-door.jpg?v=2">
<style>
  :root { --brand:#2b2118; --ink:#1f2937; --muted:#6b7280; --bg:#f7f7f7; --card:#fff; --line:#e5e7eb; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:860px;margin:0 auto;padding:16px}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--line);padding:12px 14px;z-index:5}
  h1{font-size:20px;margin:0}
  .addr{font-size:14px;color:var(--muted)}
  .lang{font-size:15px;font-weight:800;margin-top:8px}
  .lang a{color:var(--ink);text-decoration:none}
  .lang a.active{text-decoration:underline}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;margin:14px 0}
  .step{display:flex;gap:12px;align-items:flex-start}
  .num{flex:0 0 36px;height:36px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
  h2{margin:6px 0 8px 0;font-size:18px}
  p{margin:6px 0;line-height:1.45}
  figure{margin:10px 0}
  img{max-width:100%;height:auto;border-radius:10px;border:1px solid var(--line);display:block}
  figure img{width:90%;margin:0 auto}
  figcaption{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
  .cta{display:inline-block;margin-top:10px;padding:10px 12px;border-radius:10px;background:var(--brand);color:#fff;text-decoration:none;cursor:pointer}
  .status{font-size:13px;color:#6b7280;margin-top:6px}
  footer{color:var(--muted);text-align:center;font-size:12px;margin:18px 0}
</style>
</head>
<body>
<header class="wrap">
  <h1 id="title">Guida Check-in — Via del Portico d’Ottavia 1D</h1>
  <div class="addr" id="addr">Indirizzo: Via del Portico d’Ottavia 1D, Roma</div>
  <div class="lang" id="langbar">Lingua:
    <a href="#" data-lang="it" class="active">Italiano</a> ·
    <a href="#" data-lang="en">English</a>
  </div>
</header>

<main class="wrap">
  <!-- 1 -->
  <section class="card">
    <div class="step">
      <div class="num">1</div>
      <div>
        <h2 id="s1_t">Arrivo all’edificio</h2>
        <p id="s1_p">Quando arrivi a Via del Portico d’Ottavia 1D, cerca questo portone.</p>
        <figure>
          <!-- immagine con bust-cache e fallback -->
          <img id="img-building" src="./building-door.jpg?v=2" alt="Ingresso — piccolo portone in legno">
          <figcaption id="s1_cap">Ingresso — piccolo portone in legno.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- 2: Apri Portone -->
  <section class="card">
    <div class="step">
      <div class="num">2</div>
      <div>
        <h2 id="s2_t">Apri il portone</h2>
        <p id="s2_p">Usa il pulsante qui sotto per aprire il portone del palazzo.</p>
        <a class="cta" id="openBuildingBtn" href="#"
           onclick="openWithFallback(['/token/ottavia-building','/token/ottavia-gate','/token/portico-building'],'statusBuilding');return false;">➜ Apri Portone</a>
        <div class="status" id="statusBuilding"></div>
      </div>
    </div>
  </section>

  <!-- 3 -->
  <section class="card">
    <div class="step">
      <div class="num">3</div>
      <div>
        <h2 id="s3_t">Luci del corridoio (timer)</h2>
        <p id="s3_p">Prima delle scale, a sinistra, trovi il pulsante delle luci interne. Si spegne dopo ~5 minuti.</p>
        <figure>
          <img src="./hallway-light.jpg" alt="Corridoio — pulsante luce a sinistra, prima delle scale">
          <figcaption id="s3_cap">Corridoio — pulsante luce a sinistra, prima delle scale.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- 4 -->
  <section class="card">
    <div class="step">
      <div class="num">4</div>
      <div>
        <h2 id="s4_t">Raggiungere l’appartamento</h2>
        <p id="s4_p">Sali fino al 3º piano.</p>
        <figure>
          <img src="./apartment-door.jpg" alt="Porta appartamento — 3º piano">
          <figcaption id="s4_cap">Porta appartamento — 3º piano.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- 5: Apri Appartamento -->
  <section class="card">
    <div class="step">
      <div class="num">5</div>
      <div>
        <h2 id="s5_t">Apri la porta dell’appartamento</h2>
        <p id="s5_p">Premere solo se si è davanti alla porta.</p>
        <a class="cta" id="openAptBtn" href="#"
           onclick="openWithFallback(['/token/ottavia-apartment','/token/ottavia-door'],'statusApartment');return false;">➜ Apri Porta Appartamento</a>
        <div class="status" id="statusApartment"></div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2 id="help_h">Serve aiuto?</h2>
    <p id="help_p">Chiama o WhatsApp: <a class="cta" href="tel:+393355245756">+39 335 524 5756</a></p>
  </section>

  <footer id="footer">niceflatinrome.com • Guida rapida arrivi — Via del Portico d’Ottavia 1D</footer>
</main>

<script>
/* ---- testi minimi IT/EN ---- */
const T={
  it:{title:'Guida Check-in — Via del Portico d’Ottavia 1D',addr:'Indirizzo: Via del Portico d’Ottavia 1D, Roma',
      s1_t:'Arrivo all’edificio',s1_p:'Quando arrivi a Via del Portico d’Ottavia 1D, cerca questo portone.',s1_cap:'Ingresso — piccolo portone in legno.',
      s2_t:'Apri il portone',s2_p:'Usa il pulsante qui sotto per aprire il portone del palazzo.',
      s3_t:'Luci del corridoio (timer)',s3_p:'Prima delle scale, a sinistra, trovi il pulsante delle luci interne. Si spegne dopo ~5 minuti.',s3_cap:'Corridoio — pulsante luce a sinistra, prima delle scale.',
      s4_t:'Raggiungere l’appartamento',s4_p:'Sali fino al 3º piano.',s4_cap:'Porta appartamento — 3º piano.',
      s5_t:'Apri la porta dell’appartamento',s5_p:'Premere solo se si è davanti alla porta.',
      help_h:'Serve aiuto?',help_p:'Chiama o WhatsApp: ',phone:'+39 335 524 5756',
      footer:'niceflatinrome.com • Guida rapida arrivi — Via del Portico d’Ottavia 1D'},
  en:{title:'Check-in Guide — Via del Portico d’Ottavia 1D',addr:'Address: Via del Portico d’Ottavia 1D, Rome',
      s1_t:'Arrival at the building',s1_p:'When you reach Via del Portico d’Ottavia 1D, look for this small wooden door.',s1_cap:'Building entrance — little wooden door.',
      s2_t:'Open the building door',s2_p:'Use the button below to open the building door.',
      s3_t:'Hallway lights (timer)',s3_p:'Before the stairs on the left there is a light button (auto-off after ~5 min).',s3_cap:'Hallway — light button on the left, before the stairs.',
      s4_t:'Reach the apartment',s4_p:'Go up to the 3rd floor.',s4_cap:'Apartment door — 3rd floor.',
      s5_t:'Open the apartment door',s5_p:'Press only if you are in front of the door.',
      help_h:'Need help?',help_p:'Call or WhatsApp: ',phone:'+39 335 524 5756',
      footer:'niceflatinrome.com • Quick visual guide — Via del Portico d’Ottavia 1D'}
};
const params=new URLSearchParams(location.search);
const L=(params.get('lang')||'it').toLowerCase();
applyLang(L);
document.querySelectorAll('#langbar a').forEach(a=>{
  a.addEventListener('click',e=>{
    e.preventDefault();
    location.search='?lang='+a.getAttribute('data-lang');
  });
});
function applyLang(code){
  const t=T[code]||T.it;
  title.textContent=t.title; addr.textContent=t.addr;
  s1_t.textContent=t.s1_t; s1_p.textContent=t.s1_p; s1_cap.textContent=t.s1_cap;
  s2_t.textContent=t.s2_t; s2_p.textContent=t.s2_p;
  s3_t.textContent=t.s3_t; s3_p.textContent=t.s3_p; s3_cap.textContent=t.s3_cap;
  s4_t.textContent=t.s4_t; s4_p.textContent=t.s4_p; s4_cap.textContent=t.s4_cap;
  s5_t.textContent=t.s5_t; s5_p.textContent=t.s5_p;
  help_h.textContent=t.help_h; help_p.innerHTML=t.help_p+'<a class="cta" href="tel:+393355245756">'+t.phone+'</a>';
  footer.textContent=t.footer;
}

/* ---- Loader robusto per la PRIMA FOTO (prova varianti) ---- */
(function ensureBuildingPhoto(){
  const el=document.getElementById('img-building');
  const origin=location.origin;
  const candidates=[
    './building-door.jpg?v=2',
    './building-door.jpeg?v=2',
    'building-door.jpg',
    'building-door.jpeg',
    origin+'/checkin/ottavia/building-door.jpg',
    origin+'/checkin/ottavia/building-door.jpeg'
  ];
  let i=0;
  el.onerror=function(){
    i++;
    if(i<candidates.length) el.src=candidates[i];
  };
})();

/* ---- Apertura con fallback: prova più endpoint finché uno risponde con {url} ---- */
async function openWithFallback(paths, statusId){
  const s=document.getElementById(statusId);
  s.textContent='Genero chiave monouso…';
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:'no-store'});
      if(!r.ok) continue;
      const j=await r.json();
      if(j && j.url){ s.textContent='Apro…'; location.href=j.url; return; }
    }catch(_){}
  }
  s.textContent='Nessun URL restituito. Riprova.';
}
</script>
</body>
</html>
