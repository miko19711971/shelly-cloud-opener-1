<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help ‚Äî Via Arenula 16</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:pre-wrap}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: ARENULA16</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">üîá Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>

  <main id="chat" aria-live="polite"></main>

  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>

<script>
  
/* === CONFIG === */
const APARTMENT_ID = "ARENULA16";
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzI-uKj5SjzxpidtJJczWGi1ZIy9n5fkqHEqs8A4LkdeRluJJ14uEqlKzio5rD3Kus8/exec";

/* ============ CONTENUTI LOCALIZZATI (ARENULA 16) ============ */
const DATA = {

  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶",
      apt_label: "Apartment",
      voice_on: "üîä Voice: On",
      voice_off: "üîá Voice: Off",
      quick: ["wifi","check in","check out","water","AC","bathroom","gas","building","eat","drink","shop","visit","experience","day trips","transport","services","emergency","tickets & events","museums & sites","exhibitions"],
      fallback: "I did not find a direct answer. Try a quick button like wifi, gas, transport, or visit.",
      fb_label:"Was this helpful?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Thanks for your feedback!"
    },
    apt: {
      checkin_time:'15:00', 
      checkout_time:'11:00',
      wifi_note:'The router is on the desk by the window. Turn it to see the network name and password.',
      wifi_ssid:'See router label', 
      wifi_password:'See router label',
      water_note:'Tap water is safe and drinkable. Hot water is always available.',
      ac_note:'Please switch off the air conditioning when you go out.',
      bathroom_amenities:'Toilet paper, hand soap, bath mat, and hairdryer.',
      towels_note:'Per guest: 1 large and 1 medium towel. Bed is already prepared on arrival.',
      gas_steps:'To light the gas: open the gas valve (horizontal position means open, vertical means closed). Choose the burner you want to use. Light a match or lighter and bring it close to the burner. Turn and press the black knob until the flame is steady, then release.',
      intercom_code:'C8', 
      elevator_note:'Elevator is reserved for owners only. Please do not use it.',
      main_door_hours:'The main door is open from 08:00 to 13:00 and from 15:30 to 18:00', 
      concierge:'Paolo',
      pharmacy:'Farmacia Arenula is located at Via Arenula 19‚Äì21. Phone: +39 06 686 8815',
      hospital:'Fatebenefratelli Hospital, Tiber Island 1',
      atms:'ATMs available: Unicredit at Largo Arenula 1, BNL at Via Arenula 41, Intesa Sanpaolo at Via Arenula 27',
      sims:'SIM card shops: Vodafone at Corso Vittorio Emanuele II 209, TIM at Piazza Venezia 2, Iliad at Via del Corso 282',
      laundry:'Self-service laundry at Via Arenula 47',
      luggage:'Radical Storage luggage deposit at Largo di Torre Argentina, 5 minutes walk',
      transport:'Tram 8 (Arenula or Cairoli stop) takes you to Trastevere or Piazza Venezia. Buses 40 and 64 connect to Termini station and the Vatican. For taxis call +39 06 3570 or use the FreeNow app.',
      airports:'From Fiumicino: take tram 8 to Trastevere, then FL1 train (about 45 minutes total). From Ciampino: Terravision bus or taxi. For private transfers we recommend Welcome Pickups.',
      emergency:'EU emergency number: 112. Police: 113. Ambulance: 118. Fire brigade: 115. English-speaking doctor: +39 06 488 2371. 24-hour vet: +39 06 660 681',
      eat:'Recommended restaurants: Roscioli for cured meats and cheeses, Emma Pizzeria for Roman-style pizza, Ditirambo for creative cuisine, Osteria da Fortunata for handmade fresh pasta, Pianostrada for contemporary dishes, Forno Campo de\' Fiori for pizza by the slice, Gelateria del Teatro for the best artisan gelato.',
      drink:'Bars and caf√©s: Caff√® Camerino at Largo Arenula 30 for coffee and aperitifs, Irish Pub at Largo Argentina for beer and casual atmosphere, Modius Radisson Rooftop for cocktails with panoramic views of Rome.',
      shop:'Neighborhood shops: on Via Arenula you will find delis, bakeries and gelato shops. The fish market is held in Piazza Costaguti. Forno Boccione is famous for traditional Jewish pastries. Mercato Monti (open on weekends) offers vintage and crafts.',
      visit:'Places to visit on foot: Largo di Torre Argentina with ancient Roman temples and cat sanctuary, Portico d\'Ottavia in the Jewish Ghetto, Tiber Island on the river, Piazza Farnese with its Renaissance palace. Also discover hidden churches like Chiesa Nuova, Santa Maria in Campitelli and Santa Barbara dei Librari.',
      experiences:'Recommended experiences: evening walk from Largo Argentina through the Ghetto to Tiber Island and the Theatre of Marcellus. Aperitif at sunset at Caff√® Camerino or on the Modius terrace. Try traditional pastries at Forno Boccione. Enjoy the sunset walking along the Lungotevere.',
      daytrips:'Day trips: Ostia Antica to visit the Roman ruins (about 40 minutes). Tivoli for Villa d\'Este with its gardens and fountains and Villa Adriana (about 1 hour). Castelli Romani for picturesque villages and local wine tasting.',
      checkout_note:'Before leaving: turn off all lights and air conditioning, close all windows properly, leave the keys on the table, and gently close the front door.',
      host_phone:'+39 335 5245756'
    },
    intents: [
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router','network'],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Network name: ${a.wifi_ssid}<br>Password: ${a.wifi_password}`},
      
      {k:'check in',keys:['check in','arrival','access','intercom','code','enter'],t:a=>`<b>CHECK-IN</b><br>You can check in from ${a.checkin_time}.<br><br>Intercom code: <b>${a.intercom_code}</b><br><br>${a.main_door_hours}.<br>The concierge is ${a.concierge}.<br><br>Need help? Call us at ${a.host_phone}`},
      
      {k:'check out',keys:['check out','departure','leave','leaving'],t:a=>`<b>CHECK-OUT</b><br>Check-out time is ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:'water',keys:['water','hot water','drinkable','tap','drink'],t:a=>`<b>WATER</b><br>${a.water_note}`},
      
      {k:'AC',keys:['ac','air conditioning','aircon','air','climate','heating','cooling'],t:a=>`<b>AIR CONDITIONING</b><br>${a.ac_note}`},
      
      {k:'bathroom',keys:['bathroom','hairdryer','soap','towels','shower','hair dryer'],t:a=>`<b>BATHROOM</b><br>You will find: ${a.bathroom_amenities}<br><br><b>Towels:</b> ${a.towels_note}`},
      
      {k:'gas',keys:['gas','kitchen','cook','flame','burner','cooking','stove'],t:a=>`<b>HOW TO USE THE GAS</b><br>${a.gas_steps}`},
      
      {k:'building',keys:['building','elevator','door','hours','concierge','palace','condominium'],t:a=>`<b>BUILDING INFORMATION</b><br><b>Intercom:</b> ${a.intercom_code}<br><br><b>Elevator:</b> ${a.elevator_note}<br><br><b>Main door:</b> ${a.main_door_hours}<br><br><b>Concierge:</b> ${a.concierge}`},
      
      {k:'services',keys:['pharmacy','hospital','atm','sim','laundry','luggage','services','cash','sim card'],t:a=>`<b>USEFUL SERVICES</b><br><br><b>Pharmacy:</b> ${a.pharmacy}<br><br><b>Hospital:</b> ${a.hospital}<br><br><b>ATMs:</b> ${a.atms}<br><br><b>SIM cards:</b> ${a.sims}<br><br><b>Laundry:</b> ${a.laundry}<br><br><b>Luggage storage:</b> ${a.luggage}`},
      
      {k:'transport',keys:['transport','tram','bus','taxi','airport','train','metro','getting around','how to get'],t:a=>`<b>TRANSPORT</b><br>${a.transport}<br><br><b>Airports:</b> ${a.airports}`},
      
      {k:'eat',keys:['eat','restaurant','dinner','lunch','food','where to eat','pizzeria','trattoria'],t:a=>`<b>WHERE TO EAT</b><br>${a.eat}`},
      
      {k:'drink',keys:['drink','bar','wine','cocktail','aperitivo','coffee','drinks'],t:a=>`<b>WHERE TO DRINK</b><br>${a.drink}`},
      
      {k:'shop',keys:['shop','market','shopping','buy','grocery','supermarket'],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:'visit',keys:['visit','what to see','museum','attractions','see','monuments','tourism','sites'],t:a=>`<b>WHAT TO VISIT</b><br>${a.visit}`},
      
      {k:'experience',keys:['experience','walk','tour','itinerary','sunset','what to do','activities'],t:a=>`<b>RECOMMENDED EXPERIENCES</b><br>${a.experiences}`},
      
      {k:'day trips',keys:['day trips','day trip','tivoli','ostia','castelli','excursion','excursions','outside rome'],t:a=>`<b>DAY TRIPS</b><br>${a.daytrips}`},
      
      {k:'emergency',keys:['emergency','police','ambulance','fire','doctor','vet','help','urgent','sos'],t:a=>`<b>EMERGENCIES</b><br>${a.emergency}`},

      {
        k:'tickets & events',
        keys:['tickets & events','tickets','events','concert','concerts','match','shows','theatre'],
        t:()=>`<b>TICKETS AND EVENTS IN ROME</b><br><br>‚Ä¢ <b>TicketOne</b> - concerts, theatre, sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - official tickets:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - official tickets:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:'museums & sites',
        keys:['museums & sites','museums','museum','sites','monuments','colosseum','vatican','forums'],
        t:()=>`<b>MUSEUMS AND ARCHAEOLOGICAL SITES</b><br><br>‚Ä¢ <b>Colosseum, Roman Forum and Palatine:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Vatican Museums and Sistine Chapel:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Rome Museums</b> (Capitoline, Ara Pacis, etc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:'exhibitions',
        keys:['exhibitions','exhibition','art','shows','temporary','galleries'],
        t:()=>`<b>EXHIBITIONS AND ART SHOWS</b><br><br>‚Ä¢ <b>Musei in Comune</b> - temporary exhibitions:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museum of 21st Century Arts:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

  it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante ‚Äî oppure scrivi qui‚Ä¶",
      apt_label:"Appartamento", 
      voice_on:"üîä Voce: On", 
      voice_off:"üîá Voce: Off",
      quick:["wifi","check in","check out","acqua","aria condizionata","bagno","gas","edificio","mangiare","bere","shopping","visitare","esperienze","gite di un giorno","trasporti","servizi","emergenza","tickets & events","museums & sites","exhibitions"],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante rapido come wifi, gas, trasporti o visitare.",
      fb_label:"Ti √® stato utile?",
      fb_like:"üëç Mi piace",
      fb_dislike:"üëé Non mi piace",
      fb_thanks:"Grazie per il tuo feedback!"
    },
    apt:{
      checkin_time:'15:00', 
      checkout_time:'11:00',
      wifi_note:"Il router si trova sulla scrivania vicino alla finestra. Giralo per leggere il nome della rete e la password.",
      wifi_ssid:"Vedi etichetta del router", 
      wifi_password:"Vedi etichetta del router",
      water_note:"L'acqua del rubinetto √® sicura e potabile. L'acqua calda √® sempre disponibile.",
      ac_note:"Per favore, spegni l'aria condizionata quando esci dall'appartamento.",
      bathroom_amenities:"Carta igienica, sapone per le mani, tappetino da bagno e asciugacapelli.",
      towels_note:"Per ogni ospite: 1 asciugamano grande e 1 medio. Il letto √® gi√† preparato al tuo arrivo.",
      gas_steps:"Per accendere il gas: apri la valvola del gas (posizione orizzontale significa aperto, verticale significa chiuso). Scegli il fornello che vuoi usare. Accendi un fiammifero o un accendino e avvicinalo al fornello. Gira e premi la manopola nera finch√© la fiamma non diventa stabile, poi rilascia.",
      intercom_code:"C8", 
      elevator_note:"L'ascensore √® riservato ai proprietari. Per favore non utilizzarlo.",
      main_door_hours:"Il portone principale √® aperto dalle 08:00 alle 13:00 e dalle 15:30 alle 18:00", 
      concierge:"Paolo",
      pharmacy:"Farmacia Arenula si trova in Via Arenula 19‚Äì21. Telefono: +39 06 686 8815",
      hospital:"Ospedale Fatebenefratelli, Isola Tiberina 1",
      atms:"Bancomat disponibili: Unicredit a Largo Arenula 1, BNL in Via Arenula 41, Intesa Sanpaolo in Via Arenula 27",
      sims:"Negozi per SIM card: Vodafone in Corso Vittorio Emanuele II 209, TIM in Piazza Venezia 2, Iliad in Via del Corso 282",
      laundry:"Lavanderia self-service in Via Arenula 47",
      luggage:"Deposito bagagli Radical Storage a Largo di Torre Argentina, a 5 minuti a piedi",
      transport:"Il tram 8 (fermata Arenula o Cairoli) ti porta a Trastevere o Piazza Venezia. Gli autobus 40 e 64 collegano con la stazione Termini e il Vaticano. Per i taxi chiama il numero +39 06 3570 oppure usa l'app FreeNow.",
      airports:"Da Fiumicino: prendi il tram 8 fino a Trastevere, poi il treno FL1 (circa 45 minuti totali). Da Ciampino: autobus Terravision o taxi. Per transfer privati ti consigliamo Welcome Pickups.",
      emergency:"Numero unico emergenze UE: 112. Polizia: 113. Ambulanza: 118. Vigili del Fuoco: 115. Medico che parla inglese: +39 06 488 2371. Veterinario 24 ore: +39 06 660 681",
      eat:"Ristoranti consigliati: Roscioli per salumi e formaggi, Emma Pizzeria per pizza romana, Ditirambo per cucina creativa, Osteria da Fortunata per pasta fresca fatta a mano, Pianostrada per piatti contemporanei, Forno Campo de' Fiori per pizza al taglio, Gelateria del Teatro per il miglior gelato artigianale.",
      drink:"Bar e locali: Caff√® Camerino a Largo Arenula 30 per caff√® e aperitivi, Irish Pub a Largo Argentina per birra e ambiente informale, Modius Radisson Rooftop per cocktail con vista panoramica su Roma.",
      shop:"Negozi di quartiere: su Via Arenula trovi gastronomie, forni e gelaterie. Il mercato del pesce si tiene in Piazza Costaguti. Il Forno Boccione √® famoso per i dolci ebraici tradizionali. Il Mercato Monti (aperto nei weekend) offre vintage e artigianato.",
      visit:"Luoghi da visitare a piedi: Largo di Torre Argentina con i templi romani antichi e la colonia felina, il Portico d'Ottavia nel Ghetto ebraico, l'Isola Tiberina sul fiume Tevere, Piazza Farnese con il suo palazzo rinascimentale. Scopri anche le chiese nascoste come Chiesa Nuova, Santa Maria in Campitelli e Santa Barbara dei Librari.",
      experiences:"Esperienze consigliate: passeggiata serale da Largo Argentina attraverso il Ghetto fino all'Isola Tiberina e al Teatro di Marcello. Aperitivo al tramonto da Caff√® Camerino o sulla terrazza del Modius. Assaggia i dolci tradizionali al Forno Boccione. Goditi il tramonto passeggiando sul Lungotevere.",
      daytrips:"Escursioni di un giorno: Ostia Antica per visitare gli scavi romani (circa 40 minuti). Tivoli per Villa d'Este con i suoi giardini e fontane e Villa Adriana (circa 1 ora). I Castelli Romani per borghi pittoreschi e degustazione di vini locali.",
      checkout_note:"Prima di partire: spegni tutte le luci e l'aria condizionata, chiudi bene le finestre, lascia le chiavi sul tavolo, e chiudi delicatamente la porta d'ingresso.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router','rete'],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Nome rete: ${a.wifi_ssid}<br>Password: ${a.wifi_password}`},
      
      {k:'check in',keys:['check in','arrivo','accesso','citofono','codice','entrare'],t:a=>`<b>CHECK-IN</b><br>Puoi effettuare il check-in a partire dalle ${a.checkin_time}.<br><br>Codice citofono: <b>${a.intercom_code}</b><br><br>${a.main_door_hours}.<br>Il portiere si chiama ${a.concierge}.<br><br>Hai bisogno di aiuto? Chiamaci al ${a.host_phone}`},
      
      {k:'check out',keys:['check out','partenza','lasciare','uscita'],t:a=>`<b>CHECK-OUT</b><br>Il check-out √® alle ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:'acqua',keys:['acqua','acqua calda','potabile','rubinetto','bere'],t:a=>`<b>ACQUA</b><br>${a.water_note}`},
      
      {k:'aria condizionata',keys:['aria condizionata','clima','condizionatore','ac','climatizzatore','freddo','caldo'],t:a=>`<b>ARIA CONDIZIONATA</b><br>${a.ac_note}`},
      
      {k:'bagno',keys:['bagno','asciugacapelli','sapone','asciugamani','doccia','phon'],t:a=>`<b>BAGNO</b><br>Troverai: ${a.bathroom_amenities}<br><br><b>Asciugamani:</b> ${a.towels_note}`},
      
      {k:'gas',keys:['gas','cucina','fornello','fiamma','bruciatore','cucinare','piano cottura'],t:a=>`<b>COME USARE IL GAS</b><br>${a.gas_steps}`},
      
      {k:'edificio',keys:['edificio','ascensore','portone','orari','portineria','palazzo','condominio'],t:a=>`<b>INFORMAZIONI EDIFICIO</b><br><b>Citofono:</b> ${a.intercom_code}<br><br><b>Ascensore:</b> ${a.elevator_note}<br><br><b>Portone principale:</b> ${a.main_door_hours}<br><br><b>Portiere:</b> ${a.concierge}`},
      
      {k:'servizi',keys:['farmacia','ospedale','bancomat','sim','lavanderia','bagagli','servizi','atm','carta sim'],t:a=>`<b>SERVIZI UTILI</b><br><br><b>Farmacia:</b> ${a.pharmacy}<br><br><b>Ospedale:</b> ${a.hospital}<br><br><b>Bancomat:</b> ${a.atms}<br><br><b>SIM card:</b> ${a.sims}<br><br><b>Lavanderia:</b> ${a.laundry}<br><br><b>Deposito bagagli:</b> ${a.luggage}`},
      
      {k:'trasporti',keys:['trasporti','tram','bus','taxi','aeroporto','treno','metro','muoversi','come arrivare'],t:a=>`<b>TRASPORTI</b><br>${a.transport}<br><br><b>Aeroporti:</b> ${a.airports}`},
      
      {k:'mangiare',keys:['mangiare','ristorante','cena','pranzo','cibo','dove mangiare','pizzeria','trattoria'],t:a=>`<b>DOVE MANGIARE</b><br>${a.eat}`},
      
      {k:'bere',keys:['bere','bar','vino','cocktail','aperitivo','caff√®','drink'],t:a=>`<b>DOVE BERE</b><br>${a.drink}`},
      
      {k:'shopping',keys:['shopping','mercato','negozi','comprare','spesa','supermercato'],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:'visitare',keys:['visitare','cosa vedere','museo','attrazioni','vedere','monumenti','turismo','siti'],t:a=>`<b>COSA VISITARE</b><br>${a.visit}`},
      
      {k:'esperienze',keys:['esperienze','passeggiata','tour','itinerario','tramonto','cosa fare','attivit√†'],t:a=>`<b>ESPERIENZE CONSIGLIATE</b><br>${a.experiences}`},
      
      {k:'gite di un giorno',keys:['gite','gita','tivoli','ostia','castelli','escursione','escursioni','fuori roma'],t:a=>`<b>GITE DI UN GIORNO</b><br>${a.daytrips}`},
      
      {k:'emergenza',keys:['emergenza','polizia','ambulanza','vigili','medico','veterinario','aiuto','urgenza','sos'],t:a=>`<b>EMERGENZE</b><br>${a.emergency}`},

      {
        k:'tickets & events',
        keys:['tickets & events','tickets','events','biglietti','concerto','concerti','partita','eventi','spettacoli','teatro'],
        t:()=>`<b>BIGLIETTI ED EVENTI A ROMA</b><br><br>‚Ä¢ <b>TicketOne</b> - concerti, teatro, sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - biglietti ufficiali:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - biglietti ufficiali:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:'museums & sites',
        keys:['museums & sites','musei','museo','siti','monumenti','colosseo','vaticano','fori'],
        t:()=>`<b>MUSEI E SITI ARCHEOLOGICI</b><br><br>‚Ä¢ <b>Colosseo, Foro Romano e Palatino:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Musei Vaticani e Cappella Sistina:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Musei di Roma Capitale</b> (Capitolini, Ara Pacis, ecc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:'exhibitions',
        keys:['exhibitions','mostre','mostra','arte','esposizioni','gallerie'],
        t:()=>`<b>MOSTRE ED ESPOSIZIONI</b><br><br>‚Ä¢ <b>Musei in Comune</b> - mostre temporanee:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museo delle Arti del XXI secolo:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une r√©ponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ‚Äî ou √©crivez ici‚Ä¶",
      apt_label:"Appartement", 
      voice_on:"üîä Voix : Activ√©e", 
      voice_off:"üîá Voix : D√©sactiv√©e",
      quick:["wifi","check in","check out","eau","climatisation","salle de bain","gaz","immeuble","manger","boire","shopping","visiter","exp√©riences","excursions","transports","services","urgence","tickets & events","museums & sites","exhibitions"],
      fallback:"Je n'ai pas trouv√© de r√©ponse directe. Essayez un bouton rapide comme wifi, gaz, transports ou visiter.",
      fb_label:"Cette r√©ponse vous a-t-elle aid√©¬∑e ?",
      fb_like:"üëç J'aime",
      fb_dislike:"üëé Je n'aime pas",
      fb_thanks:"Merci pour votre retour !"
    },
    apt:{
      checkin_time:'15:00', 
      checkout_time:'11:00',
      wifi_note:"Le routeur se trouve sur le bureau pr√®s de la fen√™tre. Tournez-le pour lire le nom du r√©seau et le mot de passe.",
      wifi_ssid:"Voir l'√©tiquette du routeur", 
      wifi_password:"Voir l'√©tiquette du routeur",
      water_note:"L'eau du robinet est s√ªre et potable. L'eau chaude est toujours disponible.",
      ac_note:"Merci d'√©teindre la climatisation lorsque vous sortez de l'appartement.",
      bathroom_amenities:"Papier toilette, savon pour les mains, tapis de bain et s√®che-cheveux.",
      towels_note:"Par personne : 1 grande et 1 moyenne serviette. Le lit est d√©j√† pr√©par√© √† votre arriv√©e.",
      gas_steps:"Pour allumer le gaz : ouvrez la vanne de gaz (position horizontale signifie ouvert, verticale signifie ferm√©). Choisissez le br√ªleur que vous souhaitez utiliser. Allumez une allumette ou un briquet et approchez-le du br√ªleur. Tournez et appuyez sur le bouton noir jusqu'√† ce que la flamme soit stable, puis rel√¢chez.",
      intercom_code:"C8", 
      elevator_note:"L'ascenseur est r√©serv√© aux propri√©taires. Merci de ne pas l'utiliser.",
      main_door_hours:"La porte principale est ouverte de 08:00 √† 13:00 et de 15:30 √† 18:00", 
      concierge:"Paolo",
      pharmacy:"La Farmacia Arenula se trouve Via Arenula 19‚Äì21. T√©l√©phone : +39 06 686 8815",
      hospital:"H√¥pital Fatebenefratelli, √éle Tib√©rine 1",
      atms:"Distributeurs disponibles : Unicredit √† Largo Arenula 1, BNL √† Via Arenula 41, Intesa Sanpaolo √† Via Arenula 27",
      sims:"Boutiques de cartes SIM : Vodafone √† Corso Vittorio Emanuele II 209, TIM √† Piazza Venezia 2, Iliad √† Via del Corso 282",
      laundry:"Laverie en libre-service √† Via Arenula 47",
      luggage:"Consigne √† bagages Radical Storage √† Largo di Torre Argentina, √† 5 minutes √† pied",
      transport:"Le tram 8 (arr√™t Arenula ou Cairoli) vous emm√®ne √† Trastevere ou Piazza Venezia. Les bus 40 et 64 relient la gare Termini et le Vatican. Pour les taxis, appelez le +39 06 3570 ou utilisez l'application FreeNow.",
      airports:"Depuis Fiumicino : prenez le tram 8 jusqu'√† Trastevere, puis le train FL1 (environ 45 minutes au total). Depuis Ciampino : bus Terravision ou taxi. Pour les transferts priv√©s, nous recommandons Welcome Pickups.",
      emergency:"Num√©ro d'urgence europ√©en : 112. Police : 113. Ambulance : 118. Pompiers : 115. M√©decin anglophone : +39 06 488 2371. V√©t√©rinaire 24h : +39 06 660 681",
      eat:"Restaurants recommand√©s : Roscioli pour charcuteries et fromages, Emma Pizzeria pour pizza romaine, Ditirambo pour cuisine cr√©ative, Osteria da Fortunata pour p√¢tes fra√Æches faites main, Pianostrada pour plats contemporains, Forno Campo de' Fiori pour pizza √† emporter, Gelateria del Teatro pour la meilleure glace artisanale.",
      drink:"Bars et caf√©s : Caff√® Camerino √† Largo Arenula 30 pour caf√© et ap√©ritifs, Irish Pub √† Largo Argentina pour bi√®re et ambiance d√©contract√©e, Modius Radisson Rooftop pour cocktails avec vue panoramique sur Rome.",
      shop:"Commerces de quartier : sur Via Arenula vous trouverez √©piceries fines, boulangeries et glaciers. Le march√© aux poissons se tient Piazza Costaguti. Le Forno Boccione est c√©l√®bre pour ses p√¢tisseries juives traditionnelles. Le Mercato Monti (ouvert le week-end) propose vintage et artisanat.",
      visit:"Lieux √† visiter √† pied : Largo di Torre Argentina avec les temples romains antiques et le refuge pour chats, le Portique d'Octavie dans le Ghetto juif, l'√éle Tib√©rine sur le fleuve, Piazza Farnese avec son palais Renaissance. D√©couvrez aussi les √©glises cach√©es comme Chiesa Nuova, Santa Maria in Campitelli et Santa Barbara dei Librari.",
      experiences:"Exp√©riences recommand√©es : promenade du soir depuis Largo Argentina √† travers le Ghetto jusqu'√† l'√éle Tib√©rine et le Th√©√¢tre de Marcellus. Ap√©ritif au coucher du soleil au Caff√® Camerino ou sur la terrasse du Modius. Go√ªtez les p√¢tisseries traditionnelles au Forno Boccione. Profitez du coucher de soleil en vous promenant sur le Lungotevere.",
      daytrips:"Excursions d'une journ√©e : Ostia Antica pour visiter les ruines romaines (environ 40 minutes). Tivoli pour la Villa d'Este avec ses jardins et fontaines et la Villa Adriana (environ 1 heure). Les Castelli Romani pour villages pittoresques et d√©gustation de vins locaux.",
      checkout_note:"Avant de partir : √©teignez toutes les lumi√®res et la climatisation, fermez bien les fen√™tres, laissez les cl√©s sur la table, et fermez doucement la porte d'entr√©e.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','mot de passe','routeur','r√©seau'],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Nom du r√©seau : ${a.wifi_ssid}<br>Mot de passe : ${a.wifi_password}`},
      
      {k:'check in',keys:['check in','arriv√©e','acc√®s','interphone','code','entrer'],t:a=>`<b>CHECK-IN</b><br>Vous pouvez effectuer le check-in √† partir de ${a.checkin_time}.<br><br>Code interphone : <b>${a.intercom_code}</b><br><br>${a.main_door_hours}.<br>Le concierge s'appelle ${a.concierge}.<br><br>Besoin d'aide ? Appelez-nous au ${a.host_phone}`},
      
      {k:'check out',keys:['check out','d√©part','quitter','sortie'],t:a=>`<b>CHECK-OUT</b><br>Le check-out est √† ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:'eau',keys:['eau','chaude','potable','robinet','boire'],t:a=>`<b>EAU</b><br>${a.water_note}`},
      
      {k:'climatisation',keys:['climatisation','clim','ac','climatiseur','froid','chaud'],t:a=>`<b>CLIMATISATION</b><br>${a.ac_note}`},
      
      {k:'salle de bain',keys:['salle de bain','s√®che-cheveux','savon','serviettes','douche','s√©choir'],t:a=>`<b>SALLE DE BAIN</b><br>Vous trouverez : ${a.bathroom_amenities}<br><br><b>Serviettes :</b> ${a.towels_note}`},
      
      {k:'gaz',keys:['gaz','cuisine','br√ªleur','flamme','cuisiner','plaque'],t:a=>`<b>COMMENT UTILISER LE GAZ</b><br>${a.gas_steps}`},
      
      {k:'immeuble',keys:['immeuble','ascenseur','porte','horaires','concierge','b√¢timent','copropri√©t√©'],t:a=>`<b>INFORMATIONS IMMEUBLE</b><br><b>Interphone :</b> ${a.intercom_code}<br><br><b>Ascenseur :</b> ${a.elevator_note}<br><br><b>Porte principale :</b> ${a.main_door_hours}<br><br><b>Concierge :</b> ${a.concierge}`},
      
      {k:'services',keys:['pharmacie','h√¥pital','dab','sim','laverie','consigne','services','distributeur','carte sim'],t:a=>`<b>SERVICES UTILES</b><br><br><b>Pharmacie :</b> ${a.pharmacy}<br><br><b>H√¥pital :</b> ${a.hospital}<br><br><b>Distributeurs :</b> ${a.atms}<br><br><b>Cartes SIM :</b> ${a.sims}<br><br><b>Laverie :</b> ${a.laundry}<br><br><b>Consigne √† bagages :</b> ${a.luggage}`},
      
      {k:'transports',keys:['transports','tram','bus','taxi','a√©roport','train','m√©tro','se d√©placer','comment arriver'],t:a=>`<b>TRANSPORTS</b><br>${a.transport}<br><br><b>A√©roports :</b> ${a.airports}`},
      
      {k:'manger',keys:['manger','restaurant','d√Æner','d√©jeuner','nourriture','o√π manger','pizzeria','trattoria'],t:a=>`<b>O√ô MANGER</b><br>${a.eat}`},
      
      {k:'boire',keys:['boire','bar','vin','cocktail','ap√©ritif','caf√©','boissons'],t:a=>`<b>O√ô BOIRE</b><br>${a.drink}`},
      
      {k:'shopping',keys:['shopping','march√©','boutiques','acheter','courses','supermarch√©'],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:'visiter',keys:['visiter','quoi voir','mus√©e','attractions','voir','monuments','tourisme','sites'],t:a=>`<b>QUOI VISITER</b><br>${a.visit}`},
      
      {k:'exp√©riences',keys:['exp√©riences','promenade','tour','itin√©raire','coucher de soleil','quoi faire','activit√©s'],t:a=>`<b>EXP√âRIENCES RECOMMAND√âES</b><br>${a.experiences}`},
      
      {k:'excursions',keys:['excursions','excursion','tivoli','ostia','castelli','sortie','sorties','hors rome'],t:a=>`<b>EXCURSIONS D'UNE JOURN√âE</b><br>${a.daytrips}`},
      
      {k:'urgence',keys:['urgence','police','ambulance','pompiers','m√©decin','v√©t√©rinaire','aide','urgent','sos'],t:a=>`<b>URGENCES</b><br>${a.emergency}`},

      {
        k:'tickets & events',
        keys:['tickets & events','tickets','events','billets','concert','concerts','match','√©v√©nements','spectacles','th√©√¢tre'],
        t:()=>`<b>BILLETS ET √âV√âNEMENTS √Ä ROME</b><br><br>‚Ä¢ <b>TicketOne</b> - concerts, th√©√¢tre, sport :<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - billets officiels :<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - billets officiels :<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:'museums & sites',
        keys:['museums & sites','mus√©es','mus√©e','sites','monuments','colis√©e','vatican','forums'],
        t:()=>`<b>MUS√âES ET SITES ARCH√âOLOGIQUES</b><br><br>‚Ä¢ <b>Colis√©e, Forum Romain et Palatin :</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Mus√©es du Vatican et Chapelle Sixtine :</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Mus√©es de Rome</b> (Capitolins, Ara Pacis, etc.) :<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:'exhibitions',
        keys:['exhibitions','exposition','expositions','art','shows','galeries'],
        t:()=>`<b>EXPOSITIONS ET SHOWS D'ART</b><br><br>‚Ä¢ <b>Musei in Comune</b> - expositions temporaires :<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale :</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Mus√©e des Arts du XXIe si√®cle :<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

  de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button f√ºr eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button ‚Äî oder schreibe hier‚Ä¶",
      apt_label:"Apartment", 
      voice_on:"üîä Stimme: An", 
      voice_off:"üîá Stimme: Aus",
      quick:["WLAN","check in","check out","Wasser","Klimaanlage","Bad","Gas","Geb√§ude","Essen","Trinken","Shopping","Sehensw√ºrdigkeiten","Erlebnisse","Tagesausfl√ºge","Verkehr","Services","Notfall","tickets & events","museums & sites","exhibitions"],
      fallback:"Keine direkte Antwort gefunden. Nutze einen schnellen Button wie WLAN, Gas, Verkehr oder Sehensw√ºrdigkeiten.",
      fb_label:"War diese Antwort hilfreich?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Danke f√ºr dein Feedback!"
    },
    apt:{
      checkin_time:'15:00', 
      checkout_time:'11:00',
      wifi_note:"Der Router befindet sich auf dem Schreibtisch am Fenster. Drehe ihn um, um den Netzwerknamen und das Passwort zu lesen.",
      wifi_ssid:"Siehe Router-Etikett", 
      wifi_password:"Siehe Router-Etikett",
      water_note:"Leitungswasser ist sicher und trinkbar. Warmwasser ist immer verf√ºgbar.",
      ac_note:"Bitte schalten Sie die Klimaanlage aus, wenn Sie die Wohnung verlassen.",
      bathroom_amenities:"Toilettenpapier, Handseife, Badematte und F√∂hn.",
      towels_note:"Pro Gast: 1 gro√ües und 1 mittleres Handtuch. Das Bett ist bei Ankunft bereits gemacht.",
      gas_steps:"So schalten Sie das Gas ein: √ñffnen Sie den Gashahn (waagerechte Position bedeutet offen, senkrecht bedeutet geschlossen). W√§hlen Sie den Brenner, den Sie verwenden m√∂chten. Z√ºnden Sie ein Streichholz oder Feuerzeug an und bringen Sie es zum Brenner. Drehen und dr√ºcken Sie den schwarzen Knopf, bis die Flamme stabil ist, dann loslassen.",
      intercom_code:"C8", 
      elevator_note:"Der Aufzug ist nur f√ºr Eigent√ºmer reserviert. Bitte nicht benutzen.",
      main_door_hours:"Die Hauptt√ºr ist von 08:00 bis 13:00 und von 15:30 bis 18:00 ge√∂ffnet", 
      concierge:"Paolo",
      pharmacy:"Die Farmacia Arenula befindet sich in der Via Arenula 19‚Äì21. Telefon: +39 06 686 8815",
      hospital:"Krankenhaus Fatebenefratelli, Tiberinsel 1",
      atms:"Verf√ºgbare Geldautomaten: Unicredit am Largo Arenula 1, BNL in der Via Arenula 41, Intesa Sanpaolo in der Via Arenula 27",
      sims:"SIM-Karten-Shops: Vodafone am Corso Vittorio Emanuele II 209, TIM an der Piazza Venezia 2, Iliad in der Via del Corso 282",
      laundry:"Selbstbedienungs-Waschsalon in der Via Arenula 47",
      luggage:"Gep√§ckaufbewahrung Radical Storage am Largo di Torre Argentina, 5 Minuten zu Fu√ü",
      transport:"Die Stra√üenbahn 8 (Haltestelle Arenula oder Cairoli) bringt Sie nach Trastevere oder Piazza Venezia. Die Busse 40 und 64 verbinden mit dem Bahnhof Termini und dem Vatikan. F√ºr Taxis rufen Sie +39 06 3570 an oder nutzen Sie die FreeNow-App.",
      airports:"Von Fiumicino: Nehmen Sie die Stra√üenbahn 8 bis Trastevere, dann den Zug FL1 (insgesamt ca. 45 Minuten). Von Ciampino: Terravision-Bus oder Taxi. F√ºr private Transfers empfehlen wir Welcome Pickups.",
      emergency:"EU-Notrufnummer: 112. Polizei: 113. Rettungsdienst: 118. Feuerwehr: 115. Englischsprachiger Arzt: +39 06 488 2371. 24-Stunden-Tierarzt: +39 06 660 681",
      eat:"Empfohlene Restaurants: Roscioli f√ºr Wurstwaren und K√§se, Emma Pizzeria f√ºr r√∂mische Pizza, Ditirambo f√ºr kreative K√ºche, Osteria da Fortunata f√ºr handgemachte frische Pasta, Pianostrada f√ºr zeitgen√∂ssische Gerichte, Forno Campo de' Fiori f√ºr Pizza zum Mitnehmen, Gelateria del Teatro f√ºr das beste handwerkliche Eis.",
      drink:"Bars und Caf√©s: Caff√® Camerino am Largo Arenula 30 f√ºr Kaffee und Aperitifs, Irish Pub am Largo Argentina f√ºr Bier und ungezwungene Atmosph√§re, Modius Radisson Rooftop f√ºr Cocktails mit Panoramablick auf Rom.",
      shop:"Gesch√§fte im Viertel: In der Via Arenula finden Sie Feinkostl√§den, B√§ckereien und Eisdielen. Der Fischmarkt findet auf der Piazza Costaguti statt. Das Forno Boccione ist ber√ºhmt f√ºr traditionelles j√ºdisches Geb√§ck. Der Mercato Monti (am Wochenende ge√∂ffnet) bietet Vintage und Kunsthandwerk.",
      visit:"Zu Fu√ü zu besichtigende Orte: Largo di Torre Argentina mit antiken r√∂mischen Tempeln und Katzenkolonie, das Portikus der Octavia im j√ºdischen Ghetto, die Tiberinsel am Fluss, Piazza Farnese mit ihrem Renaissance-Palast. Entdecken Sie auch versteckte Kirchen wie Chiesa Nuova, Santa Maria in Campitelli und Santa Barbara dei Librari.",
      experiences:"Empfohlene Erlebnisse: Abendspaziergang vom Largo Argentina durch das Ghetto zur Tiberinsel und zum Theater des Marcellus. Aperitif bei Sonnenuntergang im Caff√® Camerino oder auf der Terrasse des Modius. Probieren Sie traditionelles Geb√§ck im Forno Boccione. Genie√üen Sie den Sonnenuntergang bei einem Spaziergang am Lungotevere.",
      daytrips:"Tagesausfl√ºge: Ostia Antica zur Besichtigung der r√∂mischen Ruinen (ca. 40 Minuten). Tivoli f√ºr die Villa d'Este mit ihren G√§rten und Brunnen und die Villa Adriana (ca. 1 Stunde). Die Castelli Romani f√ºr malerische D√∂rfer und lokale Weinverkostung.",
      checkout_note:"Vor der Abreise: Schalten Sie alle Lichter und die Klimaanlage aus, schlie√üen Sie alle Fenster gut, lassen Sie die Schl√ºssel auf dem Tisch und schlie√üen Sie die Eingangst√ºr sanft.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:'WLAN',keys:['wlan','wifi','wi-fi','internet','passwort','router','netzwerk'],t:a=>`<b>WLAN</b><br>${a.wifi_note}<br><br>Netzwerkname: ${a.wifi_ssid}<br>Passwort: ${a.wifi_password}`},
      
      {k:'check in',keys:['check in','ankunft','zugang','sprechanlage','code','eintreten'],t:a=>`<b>CHECK-IN</b><br>Sie k√∂nnen ab ${a.checkin_time} einchecken.<br><br>Sprechanlagen-Code: <b>${a.intercom_code}</b><br><br>${a.main_door_hours}.<br>Der Hausmeister hei√üt ${a.concierge}.<br><br>Brauchen Sie Hilfe? Rufen Sie uns an unter ${a.host_phone}`},
      
      {k:'check out',keys:['check out','abreise','verlassen','ausgang'],t:a=>`<b>CHECK-OUT</b><br>Der Check-out ist um ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:'Wasser',keys:['wasser','warmwasser','trinkbar','hahn','trinken'],t:a=>`<b>WASSER</b><br>${a.water_note}`},
      
      {k:'Klimaanlage',keys:['klimaanlage','klima','ac','klimager√§t','kalt','warm'],t:a=>`<b>KLIMAANLAGE</b><br>${a.ac_note}`},
      
      {k:'Bad',keys:['bad','f√∂hn','seife','handt√ºcher','dusche','haartrockner'],t:a=>`<b>BADEZIMMER</b><br>Sie finden: ${a.bathroom_amenities}<br><br><b>Handt√ºcher:</b> ${a.towels_note}`},
      
      {k:'Gas',keys:['gas','k√ºche','herd','flamme','brenner','kochen','kochfeld'],t:a=>`<b>WIE MAN DAS GAS BENUTZT</b><br>${a.gas_steps}`},
      
      {k:'Geb√§ude',keys:['geb√§ude','aufzug','t√ºr','zeiten','hausmeister','palace','wohnanlage'],t:a=>`<b>GEB√ÑUDE-INFORMATIONEN</b><br><b>Sprechanlage:</b> ${a.intercom_code}<br><br><b>Aufzug:</b> ${a.elevator_note}<br><br><b>Hauptt√ºr:</b> ${a.main_door_hours}<br><br><b>Hausmeister:</b> ${a.concierge}`},
      
      {k:'Services',keys:['apotheke','krankenhaus','geldautomat','sim','w√§scherei','gep√§ck','services','atm','sim-karte'],t:a=>`<b>N√úTZLICHE SERVICES</b><br><br><b>Apotheke:</b> ${a.pharmacy}<br><br><b>Krankenhaus:</b> ${a.hospital}<br><br><b>Geldautomaten:</b> ${a.atms}<br><br><b>SIM-Karten:</b> ${a.sims}<br><br><b>Waschsalon:</b> ${a.laundry}<br><br><b>Gep√§ckaufbewahrung:</b> ${a.luggage}`},
      
      {k:'Verkehr',keys:['verkehr','stra√üenbahn','bus','taxi','flughafen','zug','metro','fortbewegen','wie komme ich'],t:a=>`<b>VERKEHR</b><br>${a.transport}<br><br><b>Flugh√§fen:</b> ${a.airports}`},
      
      {k:'Essen',keys:['essen','restaurant','abendessen','mittagessen','nahrung','wo essen','pizzeria','trattoria'],t:a=>`<b>WO ESSEN</b><br>${a.eat}`},
      
      {k:'Trinken',keys:['trinken','bar','wein','cocktail','aperitif','kaffee','getr√§nke'],t:a=>`<b>WO TRINKEN</b><br>${a.drink}`},
      
      {k:'Shopping',keys:['shopping','markt','gesch√§fte','kaufen','einkaufen','supermarkt'],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:'Sehensw√ºrdigkeiten',keys:['sehensw√ºrdigkeiten','was sehen','museum','attraktionen','sehen','denkm√§ler','tourismus','st√§tten'],t:a=>`<b>WAS BESICHTIGEN</b><br>${a.visit}`},
      
      {k:'Erlebnisse',keys:['erlebnisse','spaziergang','tour','route','sonnenuntergang','was tun','aktivit√§ten'],t:a=>`<b>EMPFOHLENE ERLEBNISSE</b><br>${a.experiences}`},
      
      {k:'Tagesausfl√ºge',keys:['tagesausfl√ºge','tagesausflug','tivoli','ostia','castelli','ausflug','ausfl√ºge','au√üerhalb rom'],t:a=>`<b>TAGESAUSFL√úGE</b><br>${a.daytrips}`},
      
      {k:'Notfall',keys:['notfall','polizei','rettungsdienst','feuerwehr','arzt','tierarzt','hilfe','dringend','sos'],t:a=>`<b>NOTF√ÑLLE</b><br>${a.emergency}`},

      {
        k:'tickets & events',
        keys:['tickets & events','tickets','events','eintrittskarten','konzert','konzerte','spiel','veranstaltungen','shows','theater'],
        t:()=>`<b>TICKETS UND VERANSTALTUNGEN IN ROM</b><br><br>‚Ä¢ <b>TicketOne</b> - Konzerte, Theater, Sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - offizielle Tickets:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - offizielle Tickets:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:'museums & sites',
        keys:['museums & sites','museen','museum','st√§tten','denkm√§ler','kolosseum','vatikan','foren'],
        t:()=>`<b>MUSEEN UND ARCH√ÑOLOGISCHE ST√ÑTTEN</b><br><br>‚Ä¢ <b>Kolosseum, Forum Romanum und Palatin:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Vatikanische Museen und Sixtinische Kapelle:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Museen von Rom</b> (Kapitolinische, Ara Pacis, usw.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:'exhibitions',
        keys:['exhibitions','ausstellung','ausstellungen','kunst','shows','galerien'],
        t:()=>`<b>AUSSTELLUNGEN UND KUNSTSHOWS</b><br><br>‚Ä¢ <b>Musei in Comune</b> - tempor√§re Ausstellungen:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museum f√ºr Kunst des 21. Jahrhunderts:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

es: {
    ui:{
      welcome:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n para una respuesta r√°pida.",
      placeholder:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n ‚Äî o escribe aqu√≠‚Ä¶",
      apt_label:"Apartamento", 
      voice_on:"üîä Voz: Activada", 
      voice_off:"üîá Voz: Desactivada",
      quick:["wifi","check in","check out","agua","aire acondicionado","ba√±o","gas","edificio","comer","beber","compras","visitar","experiencias","excursiones","transporte","servicios","emergencia","tickets & events","museums & sites","exhibitions"],
      fallback:"No encontr√© una respuesta directa. Prueba un bot√≥n r√°pido como wifi, gas, transporte o visitar.",
      fb_label:"¬øTe result√≥ √∫til?",
      fb_like:"üëç Me gusta",
      fb_dislike:"üëé No me gusta",
      fb_thanks:"¬°Gracias por tu opini√≥n!"
    },
    apt:{
      checkin_time:'15:00', 
      checkout_time:'11:00',
      wifi_note:"El router est√° en el escritorio junto a la ventana. G√≠ralo para leer el nombre de la red y la contrase√±a.",
      wifi_ssid:"Ver etiqueta del router", 
      wifi_password:"Ver etiqueta del router",
      water_note:"El agua del grifo es segura y potable. El agua caliente est√° siempre disponible.",
      ac_note:"Por favor, apaga el aire acondicionado cuando salgas del apartamento.",
      bathroom_amenities:"Papel higi√©nico, jab√≥n de manos, alfombrilla de ba√±o y secador de pelo.",
      towels_note:"Por hu√©sped: 1 toalla grande y 1 mediana. La cama ya est√° preparada a tu llegada.",
      gas_steps:"Para encender el gas: abre la llave del gas (posici√≥n horizontal significa abierto, vertical significa cerrado). Elige el quemador que quieres usar. Enciende una cerilla o mechero y ac√©rcalo al quemador. Gira y presiona la perilla negra hasta que la llama sea estable, luego suelta.",
      intercom_code:"C8", 
      elevator_note:"El ascensor est√° reservado para propietarios. Por favor no lo uses.",
      main_door_hours:"La puerta principal est√° abierta de 08:00 a 13:00 y de 15:30 a 18:00", 
      concierge:"Paolo",
      pharmacy:"La Farmacia Arenula se encuentra en Via Arenula 19‚Äì21. Tel√©fono: +39 06 686 8815",
      hospital:"Hospital Fatebenefratelli, Isla Tiberina 1",
      atms:"Cajeros disponibles: Unicredit en Largo Arenula 1, BNL en Via Arenula 41, Intesa Sanpaolo en Via Arenula 27",
      sims:"Tiendas de tarjetas SIM: Vodafone en Corso Vittorio Emanuele II 209, TIM en Piazza Venezia 2, Iliad en Via del Corso 282",
      laundry:"Lavander√≠a autoservicio en Via Arenula 47",
      luggage:"Consigna de equipaje Radical Storage en Largo di Torre Argentina, a 5 minutos a pie",
      transport:"El tranv√≠a 8 (parada Arenula o Cairoli) te lleva a Trastevere o Piazza Venezia. Los autobuses 40 y 64 conectan con la estaci√≥n Termini y el Vaticano. Para taxis llama al +39 06 3570 o usa la app FreeNow.",
      airports:"Desde Fiumicino: toma el tranv√≠a 8 hasta Trastevere, luego el tren FL1 (unos 45 minutos en total). Desde Ciampino: autob√∫s Terravision o taxi. Para traslados privados recomendamos Welcome Pickups.",
      emergency:"N√∫mero de emergencia europeo: 112. Polic√≠a: 113. Ambulancia: 118. Bomberos: 115. M√©dico que habla ingl√©s: +39 06 488 2371. Veterinario 24 horas: +39 06 660 681",
      eat:"Restaurantes recomendados: Roscioli para embutidos y quesos, Emma Pizzeria para pizza romana, Ditirambo para cocina creativa, Osteria da Fortunata para pasta fresca hecha a mano, Pianostrada para platos contempor√°neos, Forno Campo de' Fiori para pizza al corte, Gelateria del Teatro para el mejor helado artesanal.",
      drink:"Bares y caf√©s: Caff√® Camerino en Largo Arenula 30 para caf√© y aperitivos, Irish Pub en Largo Argentina para cerveza y ambiente informal, Modius Radisson Rooftop para c√≥cteles con vistas panor√°micas de Roma.",
      shop:"Tiendas del barrio: en Via Arenula encontrar√°s tiendas gourmet, panader√≠as y helader√≠as. El mercado de pescado se celebra en Piazza Costaguti. El Forno Boccione es famoso por sus dulces jud√≠os tradicionales. El Mercato Monti (abierto los fines de semana) ofrece vintage y artesan√≠a.",
      visit:"Lugares para visitar a pie: Largo di Torre Argentina con templos romanos antiguos y santuario de gatos, el P√≥rtico de Octavia en el Gueto jud√≠o, la Isla Tiberina en el r√≠o, Piazza Farnese con su palacio renacentista. Descubre tambi√©n iglesias ocultas como Chiesa Nuova, Santa Maria in Campitelli y Santa Barbara dei Librari.",
      experiences:"Experiencias recomendadas: paseo nocturno desde Largo Argentina a trav√©s del Gueto hasta la Isla Tiberina y el Teatro de Marcelo. Aperitivo al atardecer en Caff√® Camerino o en la terraza del Modius. Prueba los dulces tradicionales en Forno Boccione. Disfruta del atardecer paseando por el Lungotevere.",
      daytrips:"Excursiones de un d√≠a: Ostia Antica para visitar las ruinas romanas (unos 40 minutos). Tivoli para Villa d'Este con sus jardines y fuentes y Villa Adriana (una hora aproximadamente). Los Castelli Romani para pueblos pintorescos y degustaci√≥n de vinos locales.",
      checkout_note:"Antes de salir: apaga todas las luces y el aire acondicionado, cierra bien las ventanas, deja las llaves en la mesa y cierra suavemente la puerta de entrada.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','contrase√±a','router','red'],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Nombre de la red: ${a.wifi_ssid}<br>Contrase√±a: ${a.wifi_password}`},
      
      {k:'check in',keys:['check in','llegada','acceso','portero','c√≥digo','entrar'],t:a=>`<b>CHECK-IN</b><br>Puedes hacer el check-in a partir de las ${a.checkin_time}.<br><br>C√≥digo del portero: <b>${a.intercom_code}</b><br><br>${a.main_door_hours}.<br>El conserje se llama ${a.concierge}.<br><br>¬øNecesitas ayuda? Ll√°manos al ${a.host_phone}`},
      
      {k:'check out',keys:['check out','salida','marchar','salir'],t:a=>`<b>CHECK-OUT</b><br>El check-out es a las ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:'agua',keys:['agua','caliente','potable','grifo','beber'],t:a=>`<b>AGUA</b><br>${a.water_note}`},
      
      {k:'aire acondicionado',keys:['aire acondicionado','ac','clima','climatizador','fr√≠o','calor'],t:a=>`<b>AIRE ACONDICIONADO</b><br>${a.ac_note}`},
      
      {k:'ba√±o',keys:['ba√±o','secador','jab√≥n','toallas','ducha','secador de pelo'],t:a=>`<b>BA√ëO</b><br>Encontrar√°s: ${a.bathroom_amenities}<br><br><b>Toallas:</b> ${a.towels_note}`},
      
      {k:'gas',keys:['gas','cocina','hornilla','llama','quemador','cocinar','placa'],t:a=>`<b>C√ìMO USAR EL GAS</b><br>${a.gas_steps}`},
      
      {k:'edificio',keys:['edificio','ascensor','puerta','horarios','conserje','palacio','condominio'],t:a=>`<b>INFORMACI√ìN DEL EDIFICIO</b><br><b>Portero autom√°tico:</b> ${a.intercom_code}<br><br><b>Ascensor:</b> ${a.elevator_note}<br><br><b>Puerta principal:</b> ${a.main_door_hours}<br><br><b>Conserje:</b> ${a.concierge}`},
      
      {k:'servicios',keys:['farmacia','hospital','cajero','sim','lavander√≠a','equipaje','servicios','atm','tarjeta sim'],t:a=>`<b>SERVICIOS √öTILES</b><br><br><b>Farmacia:</b> ${a.pharmacy}<br><br><b>Hospital:</b> ${a.hospital}<br><br><b>Cajeros:</b> ${a.atms}<br><br><b>Tarjetas SIM:</b> ${a.sims}<br><br><b>Lavander√≠a:</b> ${a.laundry}<br><br><b>Consigna de equipaje:</b> ${a.luggage}`},
      
      {k:'transporte',keys:['transporte','tranv√≠a','autob√∫s','taxi','aeropuerto','tren','metro','moverse','c√≥mo llegar'],t:a=>`<b>TRANSPORTE</b><br>${a.transport}<br><br><b>Aeropuertos:</b> ${a.airports}`},
      
      {k:'comer',keys:['comer','restaurante','cena','almuerzo','comida','d√≥nde comer','pizzer√≠a','trattoria'],t:a=>`<b>D√ìNDE COMER</b><br>${a.eat}`},
      
      {k:'beber',keys:['beber','bar','vino','c√≥ctel','aperitivo','caf√©','bebidas'],t:a=>`<b>D√ìNDE BEBER</b><br>${a.drink}`},
      
      {k:'compras',keys:['compras','mercado','tiendas','comprar','hacer la compra','supermercado'],t:a=>`<b>COMPRAS</b><br>${a.shop}`},
      
      {k:'visitar',keys:['visitar','qu√© ver','museo','atracciones','ver','monumentos','turismo','sitios'],t:a=>`<b>QU√â VISITAR</b><br>${a.visit}`},
      
      {k:'experiencias',keys:['experiencias','paseo','tour','itinerario','atardecer','qu√© hacer','actividades'],t:a=>`<b>EXPERIENCIAS RECOMENDADAS</b><br>${a.experiences}`},
      
      {k:'excursiones',keys:['excursiones','excursi√≥n','tivoli','ostia','castelli','salida','salidas','fuera de roma'],t:a=>`<b>EXCURSIONES DE UN D√çA</b><br>${a.daytrips}`},
      
      {k:'emergencia',keys:['emergencia','polic√≠a','ambulancia','bomberos','m√©dico','veterinario','ayuda','urgente','sos'],t:a=>`<b>EMERGENCIAS</b><br>${a.emergency}`},

      {
        k:'tickets & events',
        keys:['tickets & events','tickets','events','entradas','concierto','conciertos','partido','eventos','espect√°culos','teatro'],
        t:()=>`<b>ENTRADAS Y EVENTOS EN ROMA</b><br><br>‚Ä¢ <b>TicketOne</b> - conciertos, teatro, deporte:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - entradas oficiales:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - entradas oficiales:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:'museums & sites',
        keys:['museums & sites','museos','museo','sitios','monumentos','coliseo','vaticano','foros'],
        t:()=>`<b>MUSEOS Y SITIOS ARQUEOL√ìGICOS</b><br><br>‚Ä¢ <b>Coliseo, Foro Romano y Palatino:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Museos Vaticanos y Capilla Sixtina:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Museos de Roma</b> (Capitolinos, Ara Pacis, etc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:'exhibitions',
        keys:['exhibitions','exposici√≥n','exposiciones','arte','shows','galer√≠as'],
        t:()=>`<b>EXPOSICIONES Y MUESTRAS DE ARTE</b><br><br>‚Ä¢ <b>Musei in Comune</b> - exposiciones temporales:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museo de las Artes del siglo XXI:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  }

}; /* <-- chiude const DATA */

/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang); history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:['Samantha','Google US English','Google UK English Female','Microsoft Aria Online (Natural)'],
  it:['Alice','Eloisa','Google italiano','Microsoft Elsa Online (Natural)','Microsoft Isabella Online (Natural)'],
  fr:['Amelie','Thomas','Google fran√ßais','Microsoft Denise Online (Natural)','Microsoft Vivienne Online (Natural)'],
  de:['Anna','Markus','Google Deutsch','Microsoft Katja Online (Natural)','Microsoft Conrad Online (Natural)'],
  es:['Monica','Jorge','Paulina','Google espa√±ol','Microsoft Alvaro Online (Natural)']
};
function selectVoice(){
  if(!('speechSynthesis' in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||'').toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||'').toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if('speechSynthesis' in window){ refreshVoice(); speechSynthesis.onvoiceschanged = refreshVoice; }
function warm(){
  if(!('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance('.');
    dot.volume=0.01; if(pick) dot.voice=pick; dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch{}
}
function speak(t){
  if(!voiceOn || !('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t.replace(/<[^>]+>/g,'')); // legge senza tag
    if(pick) u.voice=pick; u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch{}
}

document.getElementById('voiceBtn').addEventListener('click',e=>{
  voiceOn=!voiceOn; e.currentTarget.setAttribute('aria-pressed',String(voiceOn));
  applyUI(); if(voiceOn) warm();
});
document.querySelector('.lang').addEventListener('click',e=>{
  const btn=e.target.closest('[data-lang]'); if(!btn) return;
  lang = btn.getAttribute('data-lang');
  localStorage.setItem('lang',lang);
  const u=new URL(location.href); u.searchParams.set('lang',lang); history.replaceState(null,'',u);
  refreshVoice(); applyUI(); chatEl.innerHTML=''; welcome();
  if(voiceOn) warm();
});

function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById('aptLabel').textContent = L.apt_label;
  document.getElementById('voiceBtn').textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll('.lang [data-lang]').forEach(b=> b.setAttribute('aria-current', b.getAttribute('data-lang')===lang ? 'true':'false'));
}

/* ============ CHAT LOGIC + FEEDBACK ============ */
function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  if(type==='me'){
    d.textContent = txt;
  } else {
    d.innerHTML = txt;  // <<< QUI: il bot pu√≤ mostrare link cliccabili
  }
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
  return d;
}

function detectIntent(text){
  const L = DATA[lang]; const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0; for(const k of it.keys){ if(t.includes(k.toLowerCase())) s++; }
    if(s>score){ score=s; best=it; }
  }
  return best;
}
function getAnswer(text){
  const L = DATA[lang]; const apt=L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic: 'fallback' };
  try{ return { text: m.t(apt), topic: m.k }; }catch{ return { text: L.ui.fallback, topic: 'fallback' }; }
}

/* --- invio feedback al Google Sheet --- */
function postFeedback(vote, topic, answerText){
  fetch("/feedback", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      apartment: APARTMENT_ID.toLowerCase(),
      language: lang || "en",
      topic: topic,
      answer: answerText || "",
      vote: vote
    })
  }).catch(()=>{});
}

function attachFeedbackUI(botNode, topic, answerText) {
  window.currentTopic = topic;
  window.lastAnswer = answerText;

  const wrap = document.createElement("div");
  wrap.style.display = "flex";
  wrap.style.gap = "8px";
  wrap.style.marginTop = "6px";

  const like = document.createElement("button");
  like.textContent = "üëç";
  like.onclick = () => sendFeedback("like");

  const dislike = document.createElement("button");
  dislike.textContent = "üëé";
  dislike.onclick = () => sendFeedback("dislike");

  wrap.appendChild(like);
  wrap.appendChild(dislike);
  botNode.appendChild(wrap);
}

function welcome(){
  const L=DATA[lang].ui;
  const intro=document.createElement('div'); intro.className='intro';
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div'); q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button'); b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}

/* --- invio messaggio --- */
function send(){
  const text=(input.value||'').trim(); 
  if(!text) return;
  add('me',text); 
  input.value='';
  const {text:bot, topic} = getAnswer(text);
  const botNode = add('wd',bot); 
  speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}

/* --- eventi --- */
sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });

applyUI(); 
welcome();
</script>
</body>
</html>
