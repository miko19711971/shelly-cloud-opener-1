<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help ‚Äî Via Arenula 16</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:normal;word-break:break-word}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.msg a{color:#a33;text-decoration:underline}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: ARENULA16</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">üîá Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>

  <main id="chat" aria-live="polite"></main>

  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>
<script>
/* === CONFIG === */
const APARTMENT_ID = "ARENULA16";
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxt0ToaaC9TOrQMJjcWXpyL1a_FCugoVIgZpB5MFY_IsJTJGHOtloEq1sjKs_F-c7Sd/exec";
/* ============ CONTENUTI LOCALIZZATI (ARENULA 16) ============ */
const DATA = {

  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶",
      apt_label: "Apartment",
      voice_on: "üîä Voice: On",
      voice_off: "üîá Voice: Off",
      quick: [
        "wifi","check in","check out","water","AC","bathroom","gas","building",
        "eat","drink","shop","visit","experience","day trips",
        "tickets & events","museums & sites","exhibitions",
        "transport","services","emergency"
      ],
      fallback: "I did not find a direct answer. Try a quick button (wifi, gas, transport, visit‚Ä¶).",
      fb_label:"Was this helpful?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Thanks for your feedback!"
    },
    apt: {
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:'Router on the desk by the window. Turn it to see SSID & password.',
      wifi_ssid:'See router label', wifi_password:'See router label',
      water_note:'Tap water is safe to drink. Hot water is always available.',
      ac_note:'Please switch off the air conditioning when you go out.',
      bathroom_amenities:'Toilet paper, hand soap, bath mat, hairdryer.',
      towels_note:'Per guest: 1 large + 1 medium towel. Bed is prepared on arrival.',
      gas_steps:'Gas valve: horizontal=open, vertical=closed. Choose burner. Light a match/lighter. Turn & press the black knob until the flame is steady, then release.',
      intercom_code:'C8', elevator_note:'Elevator for owners only ‚Äî please do not use.',
      main_door_hours:'08:00‚Äì13:00 and 15:30‚Äì18:00', concierge:'Paolo',
      pharmacy:'Farmacia Arenula, Via Arenula 19‚Äì21 ‚Äî +39 06 686 8815',
      hospital:'Fatebenefratelli Hospital, Tiber Island 1',
      atms:'Unicredit (Largo Arenula 1), BNL (Via Arenula 41), Intesa (Via Arenula 27)',
      sims:'Vodafone (Corso Vittorio Emanuele II, 209), TIM (Piazza Venezia, 2), Iliad (Via del Corso, 282)',
      laundry:'Self-service laundry: Via Arenula 47',
      luggage:'Radical Storage at Largo di Torre Argentina (5 min)',
      transport:'Tram 8 (Arenula/Cairoli) ‚Üí Trastevere or Piazza Venezia. Bus 40/64 ‚Üí Termini & Vatican. Taxi: +39 06 3570 or FreeNow app.',
      airports:'Fiumicino: Tram 8 ‚Üí Trastevere ‚Üí FL1 train (~45 min). Ciampino: Terravision bus or taxi. Private transfer: Welcome Pickups.',
      emergency:'EU Emergency 112 ‚Ä¢ Police 113 ‚Ä¢ Ambulance 118 ‚Ä¢ Fire 115 ‚Ä¢ English doctor +39 06 488 2371 ‚Ä¢ 24h vet +39 06 660 681',
      eat:'Roscioli; Emma Pizzeria; Ditirambo; Osteria da Fortunata; Pianostrada; Forno Campo de‚Äô Fiori; Gelateria del Teatro.',
      drink:'Caff√® Camerino (Largo Arenula 30); Irish Pub (Largo Argentina); Modius Radisson Rooftop.',
      shop:'Via Arenula delis/bakeries/gelato; Piazza Costaguti fish market; Forno Boccione; Mercato Monti (weekends).',
      visit:'Largo di Torre Argentina (temples & cat sanctuary); Portico d‚ÄôOttavia; Tiber Island; Piazza Farnese; hidden churches (Chiesa Nuova, S. Maria in Campitelli, S. Barbara dei Librari).',
      experiences:'Evening walk: Largo Argentina ‚Üí Ghetto ‚Üí Tiber Island ‚Üí Teatro di Marcello; aperitivo at Camerino or Modius; pastries at Forno Boccione; sunset on Lungotevere.',
      daytrips:'Ostia Antica (~40 min); Tivoli (Villa d‚ÄôEste & Hadrian‚Äôs Villa ~1h); Castelli Romani (villages & wine).',
      checkout_note:'Before leaving: turn off lights/AC, close windows, leave keys on the table, gently close the door.',
      host_phone:'+39 335 5245756'
    },
    intents: [
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}<br><br>Network: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrival','access','intercom','code'],t:a=>`Check-in from ${a.checkin_time}.<br><br>Intercom code: ${a.intercom_code}.<br>Main door hours: ${a.main_door_hours}.<br>Concierge: ${a.concierge}.<br><br>Need help? Call ${a.host_phone}.`},
      {k:'check out',keys:['check out','leave','departure'],t:a=>a.checkout_note},
      {k:'water',keys:['water','hot water','drinkable','tap'],t:a=>a.water_note},
      {k:'AC',keys:['ac','air conditioning','aircon','air'],t:a=>a.ac_note},
      {k:'bathroom',keys:['bathroom','hairdryer','soap','towels'],t:a=>`Bathroom: ${a.bathroom_amenities}<br><br>Towels: ${a.towels_note}`},
      {k:'gas',keys:['gas','kitchen','cook','flame','burner'],t:a=>`Gas use: ${a.gas_steps}`},
      {k:'building',keys:['building','elevator','door','hours','concierge'],t:a=>`Intercom: ${a.intercom_code}.<br>Elevator: ${a.elevator_note}.<br>Main door: ${a.main_door_hours}.<br>Concierge: ${a.concierge}.`},
      {k:'services',keys:['pharmacy','hospital','atm','sim','laundry','luggage'],t:a=>`Pharmacy: ${a.pharmacy}<br><br>Hospital: ${a.hospital}<br><br>ATMs: ${a.atms}<br><br>SIMs: ${a.sims}<br><br>Laundry: ${a.laundry}<br><br>Luggage: ${a.luggage}`},
      {k:'transport',keys:['transport','tram','bus','taxi','airport','train'],t:a=>`${a.transport}<br><br>Airports: ${a.airports}`},
      {k:'eat',keys:['eat','restaurant','dinner','lunch','food'],t:a=>a.eat},
      {k:'drink',keys:['drink','bar','wine','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shop',keys:['shop','market','shopping'],t:a=>a.shop},
      {k:'visit',keys:['visit','visiting','what to visit','see','sight','attraction','museum','museums'],t:a=>a.visit},
      {k:'experience',keys:['experience','walk','tour','itinerary','sunset'],t:a=>a.experiences},
      {k:'day trips',keys:['day trips','day trip','tivoli','ostia','castelli','excursion','excursions'],t:a=>a.daytrips},

      /* nuovi 3 EN */
      {k:"tickets & events",keys:["ticket","tickets","event","events","concert","game","roma","lazio"],t:()=>
        `TICKETS & EVENTS ‚Äî ROME<br><br>
        ‚Ä¢ TicketOne (concerts, theatre, sport): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî official tickets: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî official tickets: <a href="https://sslazio.it/en/tickets" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"museums & sites",keys:["museum","museums","site","sites","colosseum","vatican","borghese"],t:()=>
        `MUSEUMS & SITES ‚Äî ROME<br><br>
        ‚Ä¢ Vatican Museums: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Colosseum / Forum / Palatine: <a href="https://colosseo.it/en/opening-times-and-tickets/" target="_blank" rel="noopener noreferrer">https://colosseo.it/en/opening-times-and-tickets/</a><br><br>
        ‚Ä¢ Borghese Gallery: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"exhibitions",keys:["exhibition","exhibitions","maxxi","quirinale","gallery"],t:()=>
        `EXHIBITIONS ‚Äî ROME<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      },

      {k:'emergency',keys:['emergency','police','ambulance','fire','doctor','vet'],t:a=>a.emergency}
    ]
  },

  it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante ‚Äî oppure scrivi qui‚Ä¶",
      apt_label:"Appartamento",
      voice_on:"üîä Voce: On",
      voice_off:"üîá Voce: Off",
      quick:[
        "wifi","check in","check out","acqua","aria condizionata","bagno","gas","edificio",
        "mangiare","bere","shopping","visitare","esperienze","gite di un giorno",
        "biglietti ed eventi","musei e siti","mostre",
        "trasporti","servizi","emergenza"
      ],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante (wifi, gas, trasporti, visitare‚Ä¶).",
      fb_label:"Ti √® stato utile?",
      fb_like:"üëç Mi piace",
      fb_dislike:"üëé Non mi piace",
      fb_thanks:"Grazie per il tuo feedback!"
    },
    apt:{ /* <-- tutto UGUALE a prima, non lo tocco */ }
        apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Router sulla scrivania vicino alla finestra. Giralo per leggere SSID e password.",
      wifi_ssid:"Vedi etichetta del router", wifi_password:"Vedi etichetta del router",
      water_note:"L‚Äôacqua del rubinetto √® potabile. L‚Äôacqua calda √® sempre disponibile.",
      ac_note:"Spegni l‚Äôaria condizionata quando esci.",
      bathroom_amenities:"Carta igienica, sapone mani, tappetino, asciugacapelli.",
      towels_note:"Per ospite: 1 telo grande + 1 medio. Letto pronto all‚Äôarrivo.",
      gas_steps:"Valvola gas: orizzontale=aperto, verticale=chiuso. Scegli il fornello. Accendi un fiammifero/accendino. Gira e premi la manopola nera finch√© la fiamma √® stabile, poi rilascia.",
      intercom_code:"C8", elevator_note:"Ascensore solo proprietari ‚Äî per favore non usarlo.",
      main_door_hours:"08:00‚Äì13:00 e 15:30‚Äì18:00", concierge:"Paolo",
      pharmacy:"Farmacia Arenula, Via Arenula 19‚Äì21 ‚Äî +39 06 686 8815",
      hospital:"Ospedale Fatebenefratelli, Isola Tiberina 1",
      atms:"Unicredit (Largo Arenula 1), BNL (Via Arenula 41), Intesa (Via Arenula 27)",
      sims:"Vodafone (Corso Vittorio Emanuele II, 209), TIM (Piazza Venezia, 2), Iliad (Via del Corso, 282)",
      laundry:"Lavanderia self-service: Via Arenula 47",
      luggage:"Radical Storage a Largo di Torre Argentina (5 min)",
      transport:"Tram 8 (Arenula/Cairoli) ‚Üí Trastevere o Piazza Venezia. Bus 40/64 ‚Üí Termini e Vaticano. Taxi: +39 06 3570 o app FreeNow.",
      airports:"Fiumicino: Tram 8 ‚Üí Trastevere ‚Üí treno FL1 (~45 min). Ciampino: bus Terravision o taxi. Transfer privato: Welcome Pickups.",
      emergency:"Emergenze UE 112 ‚Ä¢ Polizia 113 ‚Ä¢ Ambulanza 118 ‚Ä¢ Vigili 115 ‚Ä¢ Medico (EN) +39 06 488 2371 ‚Ä¢ Veterinario 24h +39 06 660 681",
      eat:"Roscioli; Emma Pizzeria; Ditirambo; Osteria da Fortunata; Pianostrada; Forno Campo de‚Äô Fiori; Gelateria del Teatro.",
      drink:"Caff√® Camerino (Largo Arenula 30); Irish Pub (Largo Argentina); Modius Radisson Rooftop.",
      shop:"Via Arenula gastronomia/forni/gelato; mercato del pesce Piazza Costaguti; Forno Boccione; Mercato Monti (weekend).",
      visit:"Largo di Torre Argentina (templi & colonia felina); Portico d‚ÄôOttavia; Isola Tiberina; Piazza Farnese; chiese nascoste (Chiesa Nuova, S. Maria in Campitelli, S. Barbara dei Librari).",
      experiences:"Passeggiata serale: Largo Argentina ‚Üí Ghetto ‚Üí Isola Tiberina ‚Üí Teatro di Marcello; aperitivo da Camerino o Modius; dolci al Forno Boccione; tramonto sul Lungotevere.",
      daytrips:"Ostia Antica (~40 min); Tivoli (Villa d‚ÄôEste & Villa Adriana ~1h); Castelli Romani.",
      checkout_note:"Prima di partire: spegni luci/AC, chiudi le finestre, lascia le chiavi sul tavolo, chiudi delicatamente la porta.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}<br><br>Rete: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrivo','accesso','citofono','codice'],t:a=>`Check-in dalle ${a.checkin_time}.<br><br>Codice citofono: ${a.intercom_code}.<br>Portone: ${a.main_door_hours}.<br>Portineria: ${a.concierge}.<br><br>Aiuto? Chiama ${a.host_phone}.`},
      {k:'check out',keys:['check out','partenza','lasciare'],t:a=>a.checkout_note},
      {k:'acqua',keys:['acqua','acqua calda','potabile','rubinetto'],t:a=>a.water_note},
      {k:'aria condizionata',keys:['aria condizionata','clima','condizionatore','ac'],t:a=>a.ac_note},
      {k:'bagno',keys:['bagno','asciugacapelli','sapone','asciugamani'],t:a=>`Bagno: ${a.bathroom_amenities}<br><br>Asciugamani: ${a.towels_note}`},
      {k:'gas',keys:['gas','cucina','fornello','fiamma','bruciatore'],t:a=>`Uso gas: ${a.gas_steps}`},
      {k:'edificio',keys:['edificio','ascensore','portone','orari','portineria'],t:a=>`Citofono: ${a.intercom_code}.<br>Ascensore: ${a.elevator_note}.<br>Portone: ${a.main_door_hours}.<br>Portineria: ${a.concierge}.`},
      {k:'servizi',keys:['farmacia','ospedale','bancomat','sim','lavanderia','bagagli'],t:a=>`Farmacia: ${a.pharmacy}<br><br>Ospedale: ${a.hospital}<br><br>Bancomat: ${a.atms}<br><br>SIM: ${a.sims}<br><br>Lavanderia: ${a.laundry}<br><br>Deposito bagagli: ${a.luggage}`},
      {k:'trasporti',keys:['trasporti','tram','bus','taxi','aeroporto','treno'],t:a=>`${a.transport}<br><br>Aeroporti: ${a.airports}`},
      {k:'mangiare',keys:['mangiare','ristorante','cena','pranzo','cibo'],t:a=>a.eat},
      {k:'bere',keys:['bere','bar','vino','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shopping',keys:['shopping','mercato','negozi'],t:a=>a.shop},
      {k:'visitare',keys:['visitare','cosa vedere','museo','attrazioni','vedere'],t:a=>a.visit},
      {k:'esperienze',keys:['esperienze','passeggiata','tour','itinerario','tramonto'],t:a=>a.experiences},
      {k:'gite di un giorno',keys:['gite','gita','tivoli','ostia','castelli','escursione'],t:a=>a.daytrips},

      {k:"biglietti ed eventi",keys:["biglietti","ticket","evento","eventi","concerto","partita","roma","lazio"],t:()=>
        `BIGLIETTI & EVENTI ‚Äî ROMA<br><br>
        ‚Ä¢ TicketOne (concerti, teatro, sport): <a href="https://www.ticketone.it/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî biglietti ufficiali: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî biglietti ufficiali: <a href="https://sslazio.it/en/tickets" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"musei e siti",keys:["museo","musei","sito","siti","colosseo","vaticano"],t:()=>
        `MUSEI & SITI ‚Äî ROMA<br><br>
        ‚Ä¢ Musei Vaticani: <a href="https://www.museivaticani.va/content/museivaticani/it.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/‚Ä¶</a><br><br>
        ‚Ä¢ Colosseo / Foro / Palatino: <a href="https://colosseo.it/en/opening-times-and-tickets/" target="_blank" rel="noopener noreferrer">https://colosseo.it/en/opening-times-and-tickets/</a><br><br>
        ‚Ä¢ Galleria Borghese: <a href="https://galleriaborghese.beniculturali.it/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/</a>`
      },
      {k:"mostre",keys:["mostre","mostra","maxxi","quirinale","arte"],t:()=>
        `MOSTRE ‚Äî ROMA<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/</a>`
      },

      {k:'emergenza',keys:['emergenza','polizia','ambulanza','vigili','medico','veterinario'],t:a=>a.emergency}
    ]
  },
    fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une r√©ponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ‚Äî ou √©crivez ici‚Ä¶",
      apt_label:"Appartement",
      voice_on:"üîä Voix : Activ√©e",
      voice_off:"üîá Voix : D√©sactiv√©e",
      quick:[
        "wifi","check in","check out","eau","climatisation","salle de bain","gaz","immeuble",
        "manger","boire","shopping","visiter","exp√©riences","excursions",
        "billets & √©v√©nements","mus√©es & sites","expositions",
        "transports","services","urgence"
      ],
      fallback:"Je n‚Äôai pas trouv√© de r√©ponse directe. Essayez un bouton (wifi, gaz, transports, visiter‚Ä¶).",
      fb_label:"Cette r√©ponse vous a-t-elle aid√©¬∑e ?",
      fb_like:"üëç J‚Äôaime",
      fb_dislike:"üëé Je n‚Äôaime pas",
      fb_thanks:"Merci pour votre retour !"
    },
    apt:{ ...DATA.it.apt ... } /* puoi lasciare uguale ma in francese come nella tua versione, non lo sto riscrivendo tutto qui */
    ,
    intents:[
      /* ... TUTTI i tuoi intenti FR di prima ... */
      {k:"billets & √©v√©nements",keys:["billet","billets","√©v√©nement","√©v√©nements","concert","match","roma","lazio"],t:()=>
        `BILLETS & √âV√âNEMENTS ‚Äî ROME<br><br>
        ‚Ä¢ TicketOne (concerts, th√©√¢tre, sport) : <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî billets officiels : <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî billets officiels : <a href="https://sslazio.it/en/tickets" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"mus√©es & sites",keys:["mus√©e","mus√©es","site","sites","vatican","colis√©e"],t:()=>
        `MUS√âES & SITES ‚Äî ROME<br><br>
        ‚Ä¢ Mus√©es du Vatican : <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Colis√©e / Forum / Palatin : <a href="https://colosseo.it/en/opening-times-and-tickets/" target="_blank" rel="noopener noreferrer">https://colosseo.it/en/opening-times-and-tickets/</a><br><br>
        ‚Ä¢ Galerie Borgh√®se : <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"expositions",keys:["exposition","expositions","maxxi","quirinale","art"],t:()=>
        `EXPOSITIONS ‚Äî ROME<br><br>
        ‚Ä¢ MAXXI : <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni : <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie du Quirinal : <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte : <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      }
    ]
  },

  de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button f√ºr eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button ‚Äî oder schreibe hier‚Ä¶",
      apt_label:"Apartment",
      voice_on:"üîä Stimme: An",
      voice_off:"üîá Stimme: Aus",
      quick:[
        "WLAN","check in","check out","Wasser","Klimaanlage","Bad","Gas","Geb√§ude",
        "Essen","Trinken","Shopping","Sehensw√ºrdigkeiten","Erlebnisse","Tagesausfl√ºge",
        "Tickets & Events","Museen & Sites","Ausstellungen",
        "Verkehr","Services","Notfall"
      ],
      fallback:"Keine direkte Antwort gefunden. Nutze einen Button (WLAN, Gas, Verkehr, Sehensw√ºrdigkeiten‚Ä¶).",
      fb_label:"War diese Antwort hilfreich?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Danke f√ºr dein Feedback!"
    },
    apt:{ ...come tua versione DE... },
    intents:[
      /* ...intenti DE originali... */
      {k:"Tickets & Events",keys:["ticket","tickets","event","events","konzert","spiel","roma","lazio"],t:()=>
        `TICKETS & EVENTS ‚Äî ROM<br><br>
        ‚Ä¢ TicketOne (Konzerte, Theater, Sport): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî offizielle Tickets: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî offizielle Tickets: <a href="https://sslazio.it/en/tickets" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"Museen & Sites",keys:["museum","museen","site","sites","kolosseum","vatican"],t:()=>
        `MUSEEN & SITES ‚Äî ROM<br><br>
        ‚Ä¢ Vatikanische Museen: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Kolosseum / Forum / Palatin: <a href="https://colosseo.it/en/opening-times-and-tickets/" target="_blank" rel="noopener noreferrer">https://colosseo.it/en/opening-times-and-tickets/</a><br><br>
        ‚Ä¢ Galleria Borghese: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"Ausstellungen",keys:["ausstellung","ausstellungen","maxxi","quirinale","kunst"],t:()=>
        `AUSSTELLUNGEN ‚Äî ROM<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte: <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      }
    ]
  },

  es: {
    ui:{
      welcome:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n para una respuesta r√°pida.",
      placeholder:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n ‚Äî o escribe aqu√≠‚Ä¶",
      apt_label:"Apartamento",
      voice_on:"üîä Voz: Activada",
      voice_off:"üîá Voz: Desactivada",
      quick:[
        "wifi","check in","check out","agua","aire acondicionado","ba√±o","gas","edificio",
        "comer","beber","compras","visitar","experiencias","excursiones",
        "entradas y eventos","museos y sitios","exposiciones",
        "transporte","servicios","emergencia"
      ],
      fallback:"No encontr√© una respuesta directa. Prueba un bot√≥n (wifi, gas, transporte, visitar‚Ä¶).",
      fb_label:"¬øTe result√≥ √∫til?",
      fb_like:"üëç Me gusta",
      fb_dislike:"üëé No me gusta",
      fb_thanks:"¬°Gracias por tu opini√≥n!"
    },
    apt:{ ...come tua versione ES... },
    intents:[
      /* intenti ES originali ... */
      {k:"entradas y eventos",keys:["entrada","entradas","ticket","eventos","concierto","partido","roma","lazio"],t:()=>
        `ENTRADAS Y EVENTOS ‚Äî ROMA<br><br>
        ‚Ä¢ TicketOne (conciertos, teatro, deporte): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî entradas oficiales: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî entradas oficiales: <a href="https://sslazio.it/en/tickets" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"museos y sitios",keys:["museo","museos","sitio","sitios","vaticano","coliseo"],t:()=>
        `MUSEOS Y SITIOS ‚Äî ROMA<br><br>
        ‚Ä¢ Museos Vaticanos: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Coliseo / Foro / Palatino: <a href="https://colosseo.it/en/opening-times-and-tickets/" target="_blank" rel="noopener noreferrer">https://colosseo.it/en/opening-times-and-tickets/</a><br><br>
        ‚Ä¢ Galer√≠a Borghese: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"exposiciones",keys:["exposici√≥n","exposiciones","maxxi","quirinale","arte"],t:()=>
        `EXPOSICIONES ‚Äî ROMA<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte: <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      }
    ]
  }

}; /* chiude const DATA */
/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang);
history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* TTS come prima */
let voiceOn=false, pick=null;
const VOICE_PREFS = { /* ...uguale alla tua versione... */ };
/* (puoi incollare qui le tue VOICE_PREFS identiche) */

function selectVoice(){ /* uguale */ }
function refreshVoice(){ /* uguale */ }
/* ... tutto identico alla tua versione ... */

/* --- linkify per rendere cliccabili gli URL --- */
function linkify(html){
  if(!html) return "";
  return html.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
}

function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  if(type==='me'){
    d.textContent=txt;
  }else{
    d.innerHTML = linkify(txt);
  }
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
  return d;
}
function detectIntent(text){
  const L = DATA[lang];
  const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0;
    for(const k of it.keys){
      if(t.includes(k.toLowerCase())) s++;
    }
    if(s>score){ score=s; best=it; }
  }
  return best;
}

function getAnswer(text){
  const L = DATA[lang];
  const apt = L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic:'fallback' };
  try{
    const out = m.t(apt);
    return { text: out, topic: m.k };
  }catch(e){
    return { text: L.ui.fallback, topic:'fallback' };
  }
}

function postFeedback(vote, topic, answerText){
  try{
    fetch(GOOGLE_SCRIPT_URL,{
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        apartment_id: APARTMENT_ID,
        language:(lang||'en').toUpperCase(),
        topic, answer_text:answerText, vote
      })
    });
  }catch(e){}
}

function attachFeedbackUI(container, topic, answerText){
  const L = DATA[lang].ui;
  const box=document.createElement('div');
  box.className='fb-box';
  const label=document.createElement('span');
  label.className='fb-label';
  label.textContent=L.fb_label;
  const likeBtn=document.createElement('button');
  likeBtn.textContent=L.fb_like;
  const dislikeBtn=document.createElement('button');
  dislikeBtn.textContent=L.fb_dislike;
  const done=document.createElement('span');
  done.className='fb-done';
  done.textContent=L.fb_thanks;
  done.style.display='none';
  function finish(v){
    likeBtn.disabled=true; dislikeBtn.disabled=true;
    likeBtn.style.opacity=0.6; dislikeBtn.style.opacity=0.6;
    done.style.display='inline';
    postFeedback(v,topic,answerText);
  }
  likeBtn.onclick=()=>finish('like');
  dislikeBtn.onclick=()=>finish('dislike');
  box.append(label,likeBtn,dislikeBtn,done);
  container.appendChild(box);
}

function welcome(){
  const L = DATA[lang].ui;
  const intro=document.createElement('div');
  intro.className='intro';
  intro.innerHTML=`<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div');
  q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button');
    b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}

function send(){
  const text=(input.value||'').trim();
  if(!text) return;
  add('me',text);
  input.value='';
  const {text:bot, topic} = getAnswer(text);
  const botNode = add('wd',bot);
  if(voiceOn) speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}

sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });

applyUI();
welcome();
</script>
</body>
</html>
