<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help ‚Äî Via Leonina 71</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px;z-index:10}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:normal;word-break:break-word}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.msg a{color:#a33;text-decoration:underline}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
/* --- Feedback UI --- */
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: LEONINA71</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">üîá Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>
  <main id="chat" aria-live="polite"></main>
  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>
<script>
/* === CONFIG === */
const APARTMENT_ID = "LEONINA71";
/* stesso deployment Google Script che stai usando sugli altri */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxt0ToaaC9TOrQMJjcWXpyL1a_FCugoVIgZpB5MFY_IsJTJGHOtloEq1sjKs_F-c7Sd/exec";

/* ============ CONTENUTI LOCALIZZATI (LEONINA 71) ============ */
const DATA = {
  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶",
      apt_label: "Apartment",
      voice_on: "üîä Voice: On",
      voice_off: "üîá Voice: Off",
      quick: [
        "wifi","check in","check out","water","AC","bathroom","kitchen","terrace",
        "eat","drink","shop","visit","hidden gems","experience","day trips",
        "tickets & events","museums & sites","exhibitions",
        "transport","services","emergency"
      ],
      fallback: "I did not find a direct answer. Try a quick button (wifi, terrace, transport, visit‚Ä¶).",
      fb_label:"Was this helpful?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Thanks for your feedback!"
    },
    apt: {
      checkin_time:"15:00", checkout_time:"11:00",
      wifi_note:"Router on the table. Turn it around to see the SSID and password on the label.",
      wifi_ssid:"See router label", wifi_password:"See router label",
      water_note:"Tap water is safe to drink. Hot water is always available.<br><br><b>IMPORTANT:</b> do NOT touch the switch on the left side of the bathroom mirror (it controls the hot water system).",
      ac_note:"Air conditioning is available. Please turn it OFF when you leave the apartment.",
      bathroom_amenities:"Hairdryer, bath mat, toilet paper, hand soap.",
      towels_note:"Per guest: 1 large + 1 medium + 1 small towel. Beds are prepared on arrival.",
      lighting_note:"Kitchen lights: switch on the right side of the stairs (facing the kitchen). Terrace lights: switch inside on the right before exiting to the terrace.",
      kitchen_note:"Kitchen is fully equipped.<br><br><b>Electric hot plate:</b> always switch OFF after use and never leave pots unattended.",
      terrace_note:"If you open the terrace umbrella, TIE it to the railing. Always close and untie it before leaving.",
      plants_note:"If you like, you may water the plants once a day (except cacti).",
      front_door_access:"Use the long key with the square end; pull the heavy door toward you and turn the key counter-clockwise to open.",
      building_code:"Main door code (alternative to round key): <b>7171 + key symbol</b>.",
      intercom_note:"‚Äî",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express (Via Urbana) ‚Ä¢ Mini-markets on Via Leonina.",
      pharmacies:"Farmacia Cavour (Via Cavour 84) ‚Ä¢ Pharmacy on Via Panisperna 40.",
      atms:"BNL ATM (Via Cavour 84) ‚Ä¢ UniCredit ATM (Piazza della Suburra 5).",
      laundry:"Wash & Dry Laundromat ‚Äî Via Cavour 194 (self-service).",
      luggage:"Radical Storage points around Termini and Largo Argentina (book online).",
      sims:"Iliad ‚Äî Via Cavour 196 ‚Ä¢ TIM/Vodafone ‚Äî Via Nazionale.",
      transport:"Metro B ‚Äî Cavour station (~5 min). Bus 75, 117, 84 on Via Cavour. Walking is ideal in Monti.",
      airports:"Fiumicino: Metro B Cavour ‚Üí Termini ‚Üí Leonardo Express (32 min) or FL1 from Trastevere. Ciampino: bus to Termini ‚Üí Metro B Cavour. Private transfer: Welcome Pickups.",
      taxi:"Radio Taxi +39 06 3570 or FreeNow app.",
      emergency:"EU Emergency 112 ‚Ä¢ Police 113 ‚Ä¢ Ambulance 118 ‚Ä¢ Fire 115 ‚Ä¢ English-speaking doctor +39 06 488 2371 ‚Ä¢ 24h vet +39 06 660 681",
      eat:"La Carbonara ‚Ä¢ Ai Tre Scalini ‚Ä¢ Trattoria Vecchia Roma ‚Ä¢ Fafiuche Wine Bar ‚Ä¢ Al42 by Pasta Chef Monti ‚Ä¢ Broccoletti ‚Ä¢ Cuoco e Camicia",
      drink:"VinoRoma Wine Studio ‚Ä¢ La Bottega del Caff√® (Piazza Madonna dei Monti) ‚Ä¢ Spritzeria Monti ‚Ä¢ Blackmarket Hall.",
      shop:"Mercato Monti Vintage Market (Via Leonina 46, weekends) ‚Ä¢ Via Urbana & Via del Boschetto boutiques ‚Ä¢ Panisperna Bookshop ‚Ä¢ Artisan leather & design stores in Monti.",
      visit:"Piazza Madonna dei Monti ‚Ä¢ Santa Maria ai Monti ‚Ä¢ San Martino ai Monti ‚Ä¢ San Pietro in Vincoli (Michelangelo‚Äôs Moses) ‚Ä¢ Colle Oppio Park & Domus Aurea ‚Ä¢ Trajan‚Äôs Market & Forum.",
      hidden_gems:"Sotterranei di San Martino ai Monti (guided) ‚Ä¢ Santa Prassede (Chapel of St. Zeno) ‚Ä¢ Scalinata dei Borgia ‚Ä¢ Ancient Suburra streets ‚Ä¢ Roman houses beneath Santa Pudenziana.",
      experiences:"Aperitivo in Piazza Madonna dei Monti ‚Ä¢ Vintage browsing at Mercato Monti ‚Ä¢ Sunset photos on rooftops/terrace ‚Ä¢ Stroll Via Urbana & Via dei Serpenti ‚Ä¢ Evening walk by the Roman Forum.",
      romantic_walk:"Start: Via Leonina 71 ‚Üí Colosseum ‚Üí Arch of Constantine ‚Üí Via dei Fori Imperiali ‚Üí Campidoglio view ‚Üí Fatamorgana Monti gelato ‚Üí La Bottega del Caff√® ‚Üí back to Via Leonina 71.",
      daytrips:"Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & Hadrian‚Äôs Villa ~1h) ‚Ä¢ Castelli Romani (villages & wine).",
      checkout_note:"Before leaving: turn off lights/AC, close windows, leave keys on the table, gently close the door."
    },
    intents: [
      {k:"wifi",keys:["wifi","wi-fi","internet","password","router"],t:a=>`Wi-Fi: ${a.wifi_note}<br><br>Network: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:"check in",keys:["check in","arrival","access","entrance","door","front door","building","code","intercom"],t:a=>`Check-in from ${a.checkin_time}.<br><br>Access: ${a.front_door_access}<br><br>Building code: ${a.building_code}<br><br>Need help? Call ${a.host_phone}.`},
      {k:"check out",keys:["check out","leave","departure"],t:a=>a.checkout_note},
      {k:"water",keys:["water","hot water","drinkable","tap","mirror switch","boiler"],t:a=>a.water_note},
      {k:"AC",keys:["ac","air conditioning","aircon","air conditioner"],t:a=>a.ac_note},
      {k:"bathroom",keys:["bathroom","hairdryer","soap","towels","amenities"],t:a=>`Bathroom: ${a.bathroom_amenities}<br><br>Towels: ${a.towels_note}`},
      {k:"kitchen",keys:["kitchen","cook","cooking","stove","hot plate"],t:a=>a.kitchen_note},
      {k:"terrace",keys:["terrace","umbrella","plants","balcony","light"],t:a=>`Terrace: ${a.terrace_note}<br><br>Plants: ${a.plants_note}<br><br>Lights: ${a.lighting_note}`},
      {k:"services",keys:["pharmacy","hospital","atm","sim","laundry","luggage","supermarket","groceries"],t:a=>
        `Supermarkets: ${a.supermarkets}<br><br>Pharmacies: ${a.pharmacies}<br><br>ATMs: ${a.atms}<br><br>Laundry: ${a.laundry}<br><br>Luggage: ${a.luggage}<br><br>SIMs: ${a.sims}`
      },
      {k:"transport",keys:["transport","tram","bus","taxi","airport","train","metro"],t:a=>
        `${a.transport}<br><br>Airports: ${a.airports}<br><br>Taxi: ${a.taxi}`
      },
      {k:"eat",keys:["eat","restaurant","dinner","lunch","food"],t:a=>a.eat},
      {k:"drink",keys:["drink","bar","wine","cocktail","aperitivo"],t:a=>a.drink},
      {k:"shop",keys:["shop","market","shopping","boutique","vintage"],t:a=>a.shop},
      {k:"visit",keys:["visit","see","sight","attraction","museum","moses","domus aurea"],t:a=>a.visit},
      {k:"hidden gems",keys:["hidden","secret","gem","less-known","underground","suburra","pudenziana"],t:a=>a.hidden_gems},
      {k:"experience",keys:["experience","walk","tour","itinerary","sunset","romantic"],t:a=>`${a.experiences}<br><br>Romantic route: ${a.romantic_walk}`},
      {k:"day trips",keys:["day trip","tivoli","ostia","castelli","excursion"],t:a=>a.daytrips},

      /* --- cleaned EN buttons --- */
      {k:"tickets & events",keys:["ticket","tickets","event","events","match","concert","football","roma","lazio"],t:()=>
        `TICKETS & EVENTS ‚Äî ROME<br><br>
        ‚Ä¢ TicketOne (concerts, theatre, sports): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî official tickets: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî official tickets: <a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"museums & sites",keys:["museum","museums","site","sites","colosseum","vatican","borghese"],t:()=>
        `MUSEUMS & SITES ‚Äî ROME<br><br>
        ‚Ä¢ Vatican Museums: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Colosseum, Roman Forum & Palatine Hill: <a href="https://parcocolosseo.it/en/" target="_blank" rel="noopener noreferrer">https://parcocolosseo.it/en/</a><br><br>
        ‚Ä¢ Galleria Borghese: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"exhibitions",keys:["exhibition","exhibitions","maxxi","quirinale","gallery"],t:()=>
        `EXHIBITIONS ‚Äî ROME<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      },

      {k:"emergency",keys:["emergency","police","ambulance","fire","doctor","vet","help"],t:a=>a.emergency}
    ]
  },
    it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante ‚Äî oppure scrivi qui‚Ä¶",
      apt_label:"Appartamento",
      voice_on:"üîä Voce: On",
      voice_off:"üîá Voce: Off",
      quick:[
        "wifi","check in","check out","acqua","aria condizionata","bagno","cucina","terrazzo",
        "mangiare","bere","shopping","visitare","angoli nascosti","esperienze","gite di un giorno",
        "biglietti ed eventi","musei e siti","mostre",
        "trasporti","servizi","emergenza"
      ],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante (wifi, terrazzo, trasporti, visitare‚Ä¶).",
      fb_label:"Ti √® stato utile?",
      fb_like:"üëç Mi piace",
      fb_dislike:"üëé Non mi piace",
      fb_thanks:"Grazie per il tuo feedback!"
    },
    apt:{
      checkin_time:"15:00", checkout_time:"11:00",
      wifi_note:"Router sul tavolo. Giralo per leggere SSID e password sull‚Äôetichetta.",
      wifi_ssid:"Vedi etichetta del router", wifi_password:"Vedi etichetta del router",
      water_note:"L‚Äôacqua del rubinetto √® potabile. L‚Äôacqua calda √® sempre disponibile.<br><br><b>IMPORTANTE:</b> non toccare l‚Äôinterruttore a sinistra dello specchio del bagno (comanda l‚Äôimpianto dell‚Äôacqua calda).",
      ac_note:"Aria condizionata presente. Spegnila quando esci dall‚Äôappartamento.",
      bathroom_amenities:"Asciugacapelli, tappetino, carta igienica, sapone mani.",
      towels_note:"Per ospite: 1 telo grande + 1 medio + 1 piccolo. Letti pronti all‚Äôarrivo.",
      lighting_note:"Luci cucina: interruttore a destra delle scale (guardando la cucina). Luci terrazzo: interruttore interno a destra prima dell‚Äôuscita.",
      kitchen_note:"Cucina attrezzata.<br><br><b>Piastra elettrica:</b> spegnerla SEMPRE dopo l‚Äôuso e non lasciare mai pentole incustodite.",
      terrace_note:"Se apri l‚Äôombrellone del terrazzo, LEGALO alla ringhiera. Chiudilo e scioglilo sempre prima di uscire.",
      plants_note:"Se vuoi puoi bagnare le piante una volta al giorno (esclusi i cactus).",
      front_door_access:"Usa la chiave lunga con punta quadrata; tira il portone verso di te e gira in senso antiorario.",
      building_code:"Codice portone (alternativa alla chiave tonda): <b>7171 + simbolo chiave</b>.",
      intercom_note:"‚Äî",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express (Via Urbana) ‚Ä¢ Minimarket in Via Leonina.",
      pharmacies:"Farmacia Cavour (Via Cavour 84) ‚Ä¢ Farmacia in Via Panisperna 40.",
      atms:"BNL (Via Cavour 84) ‚Ä¢ UniCredit (Piazza della Suburra 5).",
      laundry:"Lavanderia Wash & Dry ‚Äî Via Cavour 194 (self-service).",
      luggage:"Radical Storage in zona Termini e Largo Argentina (prenota online).",
      sims:"Iliad ‚Äî Via Cavour 196 ‚Ä¢ TIM/Vodafone ‚Äî Via Nazionale.",
      transport:"Metro B ‚Äî fermata Cavour (~5 min). Bus 75, 117, 84 su Via Cavour. A Monti ci si muove bene a piedi.",
      airports:"Fiumicino: Metro B Cavour ‚Üí Termini ‚Üí Leonardo Express (32 min) o FL1 da Trastevere. Ciampino: bus per Termini ‚Üí Metro B Cavour. Transfer privato: Welcome Pickups.",
      taxi:"Radio Taxi +39 06 3570 o app FreeNow.",
      emergency:"Emergenze UE 112 ‚Ä¢ Polizia 113 ‚Ä¢ Ambulanza 118 ‚Ä¢ Vigili del Fuoco 115 ‚Ä¢ Medico (EN) +39 06 488 2371 ‚Ä¢ Veterinario 24h +39 06 660 681",
      eat:"La Carbonara ‚Ä¢ Ai Tre Scalini ‚Ä¢ Trattoria Vecchia Roma ‚Ä¢ Fafiuche Wine Bar ‚Ä¢ Al42 by Pasta Chef Monti ‚Ä¢ Broccoletti ‚Ä¢ Cuoco e Camicia",
      drink:"VinoRoma ‚Ä¢ La Bottega del Caff√® (Piazza Madonna dei Monti) ‚Ä¢ Spritzeria Monti ‚Ä¢ Blackmarket Hall.",
      shop:"Mercato Monti Vintage (Via Leonina 46, weekend) ‚Ä¢ Boutique Via Urbana & Via del Boschetto ‚Ä¢ Libreria Panisperna ‚Ä¢ Artigianato pelle & design.",
      visit:"Piazza Madonna dei Monti ‚Ä¢ Santa Maria ai Monti ‚Ä¢ San Martino ai Monti ‚Ä¢ San Pietro in Vincoli (Mos√® di Michelangelo) ‚Ä¢ Parco Colle Oppio & Domus Aurea ‚Ä¢ Mercati di Traiano & Fori.",
      hidden_gems:"Sotterranei di San Martino ai Monti (visite guidate) ‚Ä¢ Santa Prassede (Cappella di S. Zenone) ‚Ä¢ Scalinata dei Borgia ‚Ä¢ Antica Suburra ‚Ä¢ Case romane sotto S. Pudenziana.",
      experiences:"Aperitivo in Piazza Madonna dei Monti ‚Ä¢ Vintage al Mercato Monti ‚Ä¢ Foto al tramonto sui tetti/terrazzo ‚Ä¢ Passeggiata in Via Urbana & Via dei Serpenti ‚Ä¢ Serale lungo i Fori.",
      romantic_walk:"Partenza: Via Leonina 71 ‚Üí Colosseo ‚Üí Arco di Costantino ‚Üí Via dei Fori Imperiali ‚Üí Vista dal Campidoglio ‚Üí gelato Fatamorgana Monti ‚Üí La Bottega del Caff√® ‚Üí ritorno.",
      daytrips:"Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & Villa Adriana ~1h) ‚Ä¢ Castelli Romani.",
      checkout_note:"Prima di partire: spegni luci/AC, chiudi le finestre, lascia le chiavi sul tavolo, chiudi la porta delicatamente."
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","password","router"],t:a=>`Wi-Fi: ${a.wifi_note}<br><br>Rete: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:"check in",keys:["check in","arrivo","accesso","ingresso","porta","portone","edificio","codice","citofono"],t:a=>`Check-in dalle ${a.checkin_time}.<br><br>Accesso: ${a.front_door_access}<br><br>Codice portone: ${a.building_code}<br><br>Aiuto? Chiama ${a.host_phone}.`},
      {k:"check out",keys:["check out","partenza","lasciare"],t:a=>a.checkout_note},
      {k:"acqua",keys:["acqua","acqua calda","potabile","rubinetto","interruttore specchio","boiler"],t:a=>a.water_note},
      {k:"aria condizionata",keys:["aria condizionata","clima","ac","condizionatore"],t:a=>a.ac_note},
      {k:"bagno",keys:["bagno","asciugacapelli","sapone","asciugamani","amenities"],t:a=>`Bagno: ${a.bathroom_amenities}<br><br>Asciugamani: ${a.towels_note}`},
      {k:"cucina",keys:["cucina","cucinare","fornelli","piastra"],t:a=>a.kitchen_note},
      {k:"terrazzo",keys:["terrazzo","ombrellone","piante","balcone","luci"],t:a=>`Terrazzo: ${a.terrace_note}<br><br>Piante: ${a.plants_note}<br><br>Luci: ${a.lighting_note}`},
      {k:"servizi",keys:["farmacia","ospedale","bancomat","sim","lavanderia","bagagli","supermercato","spesa"],t:a=>
        `Supermercati: ${a.supermarkets}<br><br>Farmacie: ${a.pharmacies}<br><br>Bancomat: ${a.atms}<br><br>Lavanderia: ${a.laundry}<br><br>Deposito bagagli: ${a.luggage}<br><br>SIM: ${a.sims}`
      },
      {k:"trasporti",keys:["trasporti","tram","bus","taxi","aeroporto","treno","metro"],t:a=>
        `${a.transport}<br><br>Aeroporti: ${a.airports}<br><br>Taxi: ${a.taxi}`
      },
      {k:"mangiare",keys:["mangiare","ristorante","cena","pranzo","cibo"],t:a=>a.eat},
      {k:"bere",keys:["bere","bar","vino","cocktail","aperitivo"],t:a=>a.drink},
      {k:"shopping",keys:["shopping","mercato","boutique","vintage"],t:a=>a.shop},
      {k:"visitare",keys:["visitare","vedere","attrazioni","museo","mos√®","domus aurea"],t:a=>a.visit},
      {k:"angoli nascosti",keys:["nascosti","segreti","gioielli","suburra","pudenziana"],t:a=>a.hidden_gems},
      {k:"esperienze",keys:["esperienze","passeggiata","tour","itinerario","tramonto","romantico"],t:a=>`${a.experiences}<br><br>Percorso romantico: ${a.romantic_walk}`},
      {k:"gite di un giorno",keys:["gite","gita","tivoli","ostia","castelli","escursione"],t:a=>a.daytrips},

      /* --- puliti IT --- */
      {k:"biglietti ed eventi",keys:["biglietti","ticket","evento","eventi","partita","concerto"],t:()=>
        `BIGLIETTI & EVENTI ‚Äî ROMA<br><br>
        ‚Ä¢ TicketOne (concerti, teatro, sport): <a href="https://www.ticketone.it/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî biglietti ufficiali: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî biglietti ufficiali: <a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"musei e siti",keys:["museo","musei","sito","siti","vaticano","colosseo"],t:()=>
        `MUSEI & SITI ‚Äî ROMA<br><br>
        ‚Ä¢ Musei Vaticani: <a href="https://www.museivaticani.va/content/museivaticani/it.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/it.html</a><br><br>
        ‚Ä¢ Colosseo / Foro / Palatino: <a href="https://parcocolosseo.it/" target="_blank" rel="noopener noreferrer">https://parcocolosseo.it/</a><br><br>
        ‚Ä¢ Galleria Borghese: <a href="https://galleriaborghese.beniculturali.it/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/</a>`
      },
      {k:"mostre",keys:["mostre","mostra","maxxi","quirinale","arte"],t:()=>
        `MOSTRE ‚Äî ROMA<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/</a>`
      },

      {k:"emergenza",keys:["emergenza","polizia","ambulanza","vigili","medico","veterinario"],t:a=>a.emergency}
    ]
  },
    fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une r√©ponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ‚Äî ou √©crivez ici‚Ä¶",
      apt_label:"Appartement",
      voice_on:"üîä Voix : Activ√©e",
      voice_off:"üîá Voix : D√©sactiv√©e",
      quick:[
        "wifi","check in","check out","eau","climatisation","salle de bain","cuisine","terrasse",
        "manger","boire","shopping","visiter","tr√©sors cach√©s","exp√©riences","excursions",
        "billets & √©v√©nements","mus√©es & sites","expositions",
        "transports","services","urgence"
      ],
      fallback:"Je n‚Äôai pas trouv√© de r√©ponse directe. Essayez un bouton (wifi, terrasse, transports, visiter‚Ä¶).",
      fb_label:"Cette r√©ponse vous a-t-elle aid√©¬∑e ?",
      fb_like:"üëç J‚Äôaime",
      fb_dislike:"üëé Je n‚Äôaime pas",
      fb_thanks:"Merci pour votre retour !"
    },
    apt:{
      checkin_time:"15:00", checkout_time:"11:00",
      wifi_note:"Routeur sur la table. Tournez-le pour lire le SSID et le mot de passe sur l‚Äô√©tiquette.",
      wifi_ssid:"Voir l‚Äô√©tiquette du routeur", wifi_password:"Voir l‚Äô√©tiquette du routeur",
      water_note:"L‚Äôeau du robinet est potable. Eau chaude toujours disponible.<br><br><b>IMPORTANT :</b> ne touchez pas l‚Äôinterrupteur √† gauche du miroir de la salle de bain (contr√¥le l‚Äôeau chaude).",
      ac_note:"Climatisation disponible. Merci de l‚Äô√©teindre en sortant.",
      bathroom_amenities:"S√®che-cheveux, tapis de bain, papier toilette, savon pour les mains.",
      towels_note:"Par personne : 1 grande + 1 moyenne + 1 petite. Lits pr√™ts √† l‚Äôarriv√©e.",
      lighting_note:"Lumi√®res cuisine : interrupteur √† droite des escaliers (face √† la cuisine). Lumi√®res terrasse : interrupteur int√©rieur √† droite avant de sortir.",
      kitchen_note:"Cuisine √©quip√©e.<br><br><b>Plaque √©lectrique :</b> l‚Äô√©teindre TOUJOURS apr√®s usage et ne jamais laisser de casseroles sans surveillance.",
      terrace_note:"Si vous ouvrez le parasol, ATTACHEZ-le √† la rambarde. Fermez/d√©tachez toujours avant de partir.",
      plants_note:"Vous pouvez arroser les plantes une fois par jour (sauf cactus).",
      front_door_access:"Utilisez la longue cl√© √† bout carr√© ; tirez la porte vers vous et tournez dans le sens antihoraire.",
      building_code:"Code du portail (alternative √† la cl√© ronde) : <b>7171 + symbole cl√©</b>.",
      intercom_note:"‚Äî",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express (Via Urbana) ‚Ä¢ Sup√©rettes Via Leonina.",
      pharmacies:"Farmacia Cavour (Via Cavour 84) ‚Ä¢ Pharmacie Via Panisperna 40.",
      atms:"BNL (Via Cavour 84) ‚Ä¢ UniCredit (Piazza della Suburra 5).",
      laundry:"Laverie Wash & Dry ‚Äî Via Cavour 194 (self-service).",
      luggage:"Radical Storage pr√®s de Termini et Largo Argentina (r√©servation en ligne).",
      sims:"Iliad ‚Äî Via Cavour 196 ‚Ä¢ TIM/Vodafone ‚Äî Via Nazionale.",
      transport:"M√©tro B ‚Äî station Cavour (~5 min). Bus 75, 117, 84 sur Via Cavour. Dans le quartier Monti on marche tr√®s bien.",
      airports:"Fiumicino : M√©tro B Cavour ‚Üí Termini ‚Üí Leonardo Express (32 min) ou FL1 depuis Trastevere. Ciampino : bus jusqu‚Äô√† Termini ‚Üí M√©tro B Cavour.",
      taxi:"Radio Taxi +39 06 3570 ou appli FreeNow.",
      emergency:"Urgences UE 112 ‚Ä¢ Police 113 ‚Ä¢ Ambulance 118 ‚Ä¢ Pompiers 115 ‚Ä¢ M√©decin anglophone +39 06 488 2371 ‚Ä¢ V√©t√©rinaire 24h +39 06 660 681",
      eat:"La Carbonara ‚Ä¢ Ai Tre Scalini ‚Ä¢ Trattoria Vecchia Roma ‚Ä¢ Fafiuche Wine Bar ‚Ä¢ Al42 by Pasta Chef Monti ‚Ä¢ Broccoletti ‚Ä¢ Cuoco e Camicia",
      drink:"VinoRoma ‚Ä¢ La Bottega del Caff√® ‚Ä¢ Spritzeria Monti ‚Ä¢ Blackmarket Hall.",
      shop:"Mercato Monti Vintage (Via Leonina 46, week-end) ‚Ä¢ Boutiques Via Urbana & Via del Boschetto ‚Ä¢ Librairie Panisperna ‚Ä¢ Artisans cuir & design.",
      visit:"Piazza Madonna dei Monti ‚Ä¢ Santa Maria ai Monti ‚Ä¢ San Martino ai Monti ‚Ä¢ San Pietro in Vincoli (Mo√Øse) ‚Ä¢ Parc Colle Oppio & Domus Aurea ‚Ä¢ March√©s de Trajan & Forum.",
      hidden_gems:"Souterrains de San Martino ai Monti (guid√©) ‚Ä¢ Santa Prassede (chapelle de St Z√©non) ‚Ä¢ Scalinata dei Borgia ‚Ä¢ Suburra antique ‚Ä¢ Maisons romaines sous Santa Pudenziana.",
      experiences:"Ap√©ritif Piazza Madonna dei Monti ‚Ä¢ Vintage au Mercato Monti ‚Ä¢ Photos coucher du soleil ‚Ä¢ Balade Via Urbana & Via dei Serpenti ‚Ä¢ Soir√©e le long des Forums.",
      romantic_walk:"D√©part : Via Leonina 71 ‚Üí Colis√©e ‚Üí Arc de Constantin ‚Üí Via dei Fori Imperiali ‚Üí belv√©d√®re du Capitole ‚Üí gelato Fatamorgana Monti ‚Üí La Bottega del Caff√® ‚Üí retour.",
      daytrips:"Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & d‚ÄôHadrien ~1h) ‚Ä¢ Castelli Romani.",
      checkout_note:"Avant de partir : √©teignez lumi√®res/clim, fermez les fen√™tres, laissez les cl√©s sur la table, fermez la porte doucement."
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","mot de passe","routeur"],t:a=>`Wi-Fi : ${a.wifi_note}<br><br>R√©seau : ${a.wifi_ssid}. Mot de passe : ${a.wifi_password}.`},
      {k:"check in",keys:["check in","arriv√©e","acc√®s","entr√©e","porte","immeuble","code","interphone"],t:a=>`Arriv√©e √† partir de ${a.checkin_time}.<br><br>Acc√®s : ${a.front_door_access}<br><br>Code du portail : ${a.building_code}<br><br>Besoin d‚Äôaide ? ${a.host_phone}.`},
      {k:"check out",keys:["check out","d√©part","quitter"],t:a=>a.checkout_note},
      {k:"eau",keys:["eau","chaude","potable","robinet","miroir","ballon"],t:a=>a.water_note},
      {k:"climatisation",keys:["climatisation","clim","ac"],t:a=>a.ac_note},
      {k:"salle de bain",keys:["salle de bain","serviettes","savon","s√®che-cheveux"],t:a=>`Salle de bain : ${a.bathroom_amenities}<br><br>Serviettes : ${a.towels_note}`},
      {k:"cuisine",keys:["cuisine","cuisiner","plaque","√©lectrique"],t:a=>a.kitchen_note},
      {k:"terrasse",keys:["terrasse","parasol","plantes","balcon","lumi√®re"],t:a=>`Terrasse : ${a.terrace_note}<br><br>Plantes : ${a.plants_note}<br><br>Lumi√®res : ${a.lighting_note}`},
      {k:"services",keys:["pharmacie","h√¥pital","dab","sim","laverie","consigne","supermarch√©","courses"],t:a=>
        `Supermarch√©s : ${a.supermarkets}<br><br>Pharmacies : ${a.pharmacies}<br><br>DAB : ${a.atms}<br><br>Laverie : ${a.laundry}<br><br>Consigne : ${a.luggage}<br><br>SIM : ${a.sims}`
      },
      {k:"transports",keys:["transports","tram","bus","taxi","a√©roport","train","m√©tro"],t:a=>
        `${a.transport}<br><br>A√©roports : ${a.airports}<br><br>Taxi : ${a.taxi}`
      },
      {k:"manger",keys:["manger","restaurant","d√Æner","d√©jeuner"],t:a=>a.eat},
      {k:"boire",keys:["boire","bar","vin","cocktail","ap√©ritif"],t:a=>a.drink},
      {k:"shopping",keys:["shopping","march√©","boutiques","vintage"],t:a=>a.shop},
      {k:"visiter",keys:["visiter","voir","attractions","mus√©e","mo√Øse","domus aurea"],t:a=>a.visit},
      {k:"tr√©sors cach√©s",keys:["cach√©s","secrets","peu connus","suburra","pudenziana"],t:a=>a.hidden_gems},
      {k:"exp√©riences",keys:["exp√©riences","balade","itin√©raire","coucher de soleil","romantique"],t:a=>`${a.experiences}<br><br>Parcours romantique : ${a.romantic_walk}`},
      {k:"excursions",keys:["excursion","tivoli","ostia","castelli","journ√©e"],t:a=>a.daytrips},

      /* --- FR puliti --- */
      {k:"billets & √©v√©nements",keys:["billet","billets","√©v√©nement","√©v√©nements","concert","match"],t:()=>
        `BILLETS & √âV√âNEMENTS ‚Äî ROME<br><br>
        ‚Ä¢ TicketOne (concerts, th√©√¢tre, sport) : <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî billets officiels : <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî billets officiels : <a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"mus√©es & sites",keys:["mus√©e","mus√©es","site","sites","vatican","colis√©e"],t:()=>
        `MUS√âES & SITES ‚Äî ROME<br><br>
        ‚Ä¢ Mus√©es du Vatican : <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Colis√©e / Forum / Palatin : <a href="https://parcocolosseo.it/en/" target="_blank" rel="noopener noreferrer">https://parcocolosseo.it/en/</a><br><br>
        ‚Ä¢ Galerie Borgh√®se : <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"expositions",keys:["exposition","expositions","maxxi","quirinale","art"],t:()=>
        `EXPOSITIONS ‚Äî ROME<br><br>
        ‚Ä¢ MAXXI : <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni : <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale : <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia) : <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      },

      {k:"urgence",keys:["urgence","police","ambulance","pompiers","m√©decin","v√©t√©rinaire"],t:a=>a.emergency}
    ]
  },
    de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button f√ºr eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button ‚Äî oder schreibe hier‚Ä¶",
      apt_label:"Apartment",
      voice_on:"üîä Stimme: An",
      voice_off:"üîá Stimme: Aus",
      quick:[
        "WLAN","check in","check out","Wasser","Klimaanlage","Bad","K√ºche","Terrasse",
        "Essen","Trinken","Shopping","Sehensw√ºrdigkeiten","versteckte Perlen","Erlebnisse","Tagesausfl√ºge",
        "Tickets & Events","Museen & Sites","Ausstellungen",
        "Verkehr","Services","Notfall"
      ],
      fallback:"Keine direkte Antwort gefunden. Nutze einen Button (WLAN, Terrasse, Verkehr, Sehensw√ºrdigkeiten‚Ä¶).",
      fb_label:"War diese Antwort hilfreich?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Danke f√ºr dein Feedback!"
    },
    apt:{
      checkin_time:"15:00", checkout_time:"11:00",
      wifi_note:"Router auf dem Tisch. Umdrehen, um SSID & Passwort auf dem Etikett zu sehen.",
      wifi_ssid:"Siehe Router-Etikett", wifi_password:"Siehe Router-Etikett",
      water_note:"Leitungswasser ist trinkbar. Warmwasser stets verf√ºgbar.<br><br><b>WICHTIG:</b> Schalter links am Badspiegel NICHT bet√§tigen (Warmwassersystem).",
      ac_note:"Klimaanlage vorhanden. Bitte beim Verlassen AUSSCHALTEN.",
      bathroom_amenities:"F√∂hn, Badematte, Toilettenpapier, Handseife.",
      towels_note:"Pro Gast: 1 gro√ües + 1 mittleres + 1 kleines Handtuch. Betten bei Ankunft gemacht.",
      lighting_note:"K√ºchenlicht: Schalter rechts an der Treppe (zur K√ºche gewandt). Terrassenlicht: Schalter innen rechts vor der T√ºr.",
      kitchen_note:"Ausgestattete K√ºche.<br><br><b>Elektrische Kochplatte:</b> immer nach Gebrauch ausschalten, nie unbeaufsichtigt lassen.",
      terrace_note:"Wenn der Terrassenschirm offen ist, an das Gel√§nder BINDEN. Vor dem Gehen immer schlie√üen/losbinden.",
      plants_note:"Wer mag, gie√üt die Pflanzen einmal t√§glich (keine Kakteen).",
      front_door_access:"Langer Schl√ºssel mit quadratischem Ende; T√ºr zu sich ziehen, gegen den Uhrzeigersinn drehen.",
      building_code:"Haust√ºr-Code (Alternative zum runden Schl√ºssel): <b>7171 + Schl√ºssel-Symbol</b>.",
      intercom_note:"‚Äî",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express (Via Urbana) ‚Ä¢ Mini-M√§rkte Via Leonina.",
      pharmacies:"Farmacia Cavour (Via Cavour 84) ‚Ä¢ Apotheke Via Panisperna 40.",
      atms:"BNL (Via Cavour 84) ‚Ä¢ UniCredit (Piazza della Suburra 5).",
      laundry:"Waschsalon Wash & Dry ‚Äî Via Cavour 194 (Self-Service).",
      luggage:"Radical Storage bei Termini & Largo Argentina (online buchen).",
      sims:"Iliad ‚Äî Via Cavour 196 ‚Ä¢ TIM/Vodafone ‚Äî Via Nazionale.",
      transport:"Metro B ‚Äî Cavour (~5 Min). Bus 75, 117, 84 in der Via Cavour. In Monti geht man am besten zu Fu√ü.",
      airports:"Fiumicino: Metro B Cavour ‚Üí Termini ‚Üí Leonardo Express (32 Min) oder FL1 ab Trastevere. Ciampino: Bus nach Termini ‚Üí Metro B Cavour.",
      taxi:"Radio Taxi +39 06 3570 oder FreeNow-App.",
      emergency:"EU-Notruf 112 ‚Ä¢ Polizei 113 ‚Ä¢ Rettung 118 ‚Ä¢ Feuerwehr 115 ‚Ä¢ Arzt (EN) +39 06 488 2371 ‚Ä¢ Tierarzt 24h +39 06 660 681",
      eat:"La Carbonara ‚Ä¢ Ai Tre Scalini ‚Ä¢ Trattoria Vecchia Roma ‚Ä¢ Fafiuche Wine Bar ‚Ä¢ Al42 by Pasta Chef Monti ‚Ä¢ Broccoletti ‚Ä¢ Cuoco e Camicia",
      drink:"VinoRoma ‚Ä¢ La Bottega del Caff√® ‚Ä¢ Spritzeria Monti ‚Ä¢ Blackmarket Hall.",
      shop:"Mercato Monti Vintage (Via Leonina 46, Wochenende) ‚Ä¢ Boutiquen Via Urbana/Del Boschetto ‚Ä¢ Panisperna Libreria ‚Ä¢ Handwerk Leder & Design.",
      visit:"Piazza Madonna dei Monti ‚Ä¢ Santa Maria ai Monti ‚Ä¢ San Martino ai Monti ‚Ä¢ San Pietro in Vincoli (Moses) ‚Ä¢ Colle Oppio & Domus Aurea ‚Ä¢ Trajansm√§rkte & Forum.",
      hidden_gems:"Unterirdisch San Martino ai Monti (gef√ºhrt) ‚Ä¢ Santa Prassede (Zenon-Kapelle) ‚Ä¢ Scalinata dei Borgia ‚Ä¢ antike Suburra ‚Ä¢ R√∂mische H√§user unter Santa Pudenziana.",
      experiences:"Aperitivo am Platz ‚Ä¢ Vintage-Shopping im Mercato Monti ‚Ä¢ Sonnenuntergangs-Fotos ‚Ä¢ Bummel Via Urbana & Via dei Serpenti ‚Ä¢ Abendrunde am Forum Romanum.",
      romantic_walk:"Start: Via Leonina 71 ‚Üí Kolosseum ‚Üí Konstantinsbogen ‚Üí Fori Imperiali ‚Üí Kapitolsblick ‚Üí Fatamorgana Monti ‚Üí La Bottega del Caff√® ‚Üí zur√ºck.",
      daytrips:"Ostia Antica (~40 Min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & Hadriansvilla ~1h) ‚Ä¢ Castelli Romani.",
      checkout_note:"Vor der Abreise: Licht/AC aus, Fenster schlie√üen, Schl√ºssel auf dem Tisch lassen, T√ºr sanft schlie√üen."
    },
    intents:[
      {k:"WLAN",keys:["wlan","wifi","wi-fi","internet","passwort","router"],t:a=>`WLAN: ${a.wifi_note}<br><br>Netz: ${a.wifi_ssid}. Passwort: ${a.wifi_password}.`},
      {k:"check in",keys:["check in","ankunft","zugang","eingang","t√ºr","haust√ºr","geb√§ude","code","sprechanlage"],t:a=>`Check-in ab ${a.checkin_time}.<br><br>Zugang: ${a.front_door_access}<br><br>T√ºr-Code: ${a.building_code}<br><br>Hilfe? ${a.host_phone}.`},
      {k:"check out",keys:["check out","abreise","verlassen"],t:a=>a.checkout_note},
      {k:"Wasser",keys:["wasser","warmwasser","trinkbar","hahn","spiegel","boiler"],t:a=>a.water_note},
      {k:"Klimaanlage",keys:["klimaanlage","klima","ac"],t:a=>a.ac_note},
      {k:"Bad",keys:["bad","f√∂hn","seife","handt√ºcher"],t:a=>`Bad: ${a.bathroom_amenities}<br><br>Handt√ºcher: ${a.towels_note}`},
      {k:"K√ºche",keys:["k√ºche","kochen","kochplatte","herd"],t:a=>a.kitchen_note},
      {k:"Terrasse",keys:["terrasse","schirm","pflanzen","balkon","licht"],t:a=>`Terrasse: ${a.terrace_note}<br><br>Pflanzen: ${a.plants_note}<br><br>Licht: ${a.lighting_note}`},
      {k:"Services",keys:["apotheke","krankenhaus","geldautomat","sim","w√§scherei","gep√§ck","supermarkt","einkauf"],t:a=>
        `Superm√§rkte: ${a.supermarkets}<br><br>Apotheken: ${a.pharmacies}<br><br>Geldautomaten: ${a.atms}<br><br>Waschsalon: ${a.laundry}<br><br>Gep√§ck: ${a.luggage}<br><br>SIM: ${a.sims}`
      },
      {k:"Verkehr",keys:["verkehr","tram","bus","taxi","flughafen","zug","metro"],t:a=>
        `${a.transport}<br><br>Flugh√§fen: ${a.airports}<br><br>Taxi: ${a.taxi}`
      },
      {k:"Essen",keys:["essen","restaurant","abendessen","mittagessen"],t:a=>a.eat},
      {k:"Trinken",keys:["trinken","bar","wein","cocktail","aperitif"],t:a=>a.drink},
      {k:"Shopping",keys:["shopping","markt","boutique","vintage"],t:a=>a.shop},
      {k:"Sehensw√ºrdigkeiten",keys:["sehen","besuchen","attraktionen","museum","mose","domus aurea"],t:a=>a.visit},
      {k:"versteckte Perlen",keys:["versteckt","geheim","suburra","pudenziana"],t:a=>a.hidden_gems},
      {k:"Erlebnisse",keys:["erlebnisse","spaziergang","tour","route","sonnenuntergang","romantisch"],t:a=>`${a.experiences}<br><br>Romantische Route: ${a.romantic_walk}`},
      {k:"Tagesausfl√ºge",keys:["tagesausflug","tivoli","ostia","castelli","ausflug"],t:a=>a.daytrips},

      /* --- DE puliti --- */
      {k:"Tickets & Events",keys:["ticket","tickets","event","events","konzert","spiel","partie","match"],t:()=>
        `TICKETS & EVENTS ‚Äî ROM<br><br>
        ‚Ä¢ TicketOne (Konzerte, Theater, Sport): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî offizielle Tickets: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî offizielle Tickets: <a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"Museen & Sites",keys:["museum","museen","site","sites","kolosseum","vatican"],t:()=>
        `MUSEEN & SITES ‚Äî ROM<br><br>
        ‚Ä¢ Vatikanische Museen: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Kolosseum / Forum / Palatin: <a href="https://parcocolosseo.it/en/" target="_blank" rel="noopener noreferrer">https://parcocolosseo.it/en/</a><br><br>
        ‚Ä¢ Galleria Borghese: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"Ausstellungen",keys:["ausstellung","ausstellungen","maxxi","quirinale","kunst"],t:()=>
        `AUSSTELLUNGEN ‚Äî ROM<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      },

      {k:"Notfall",keys:["notfall","polizei","rettung","feuerwehr","arzt","tierarzt"],t:a=>a.emergency}
    ]
  },
    es: {
    ui:{
      welcome:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n para una respuesta r√°pida.",
      placeholder:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n ‚Äî o escribe aqu√≠‚Ä¶",
      apt_label:"Apartamento",
      voice_on:"üîä Voz: Activada",
      voice_off:"üîá Voz: Desactivada",
      quick:[
        "wifi","check in","check out","agua","aire acondicionado","ba√±o","cocina","terraza",
        "comer","beber","compras","visitar","joyas ocultas","experiencias","excursiones",
        "entradas y eventos","museos y sitios","exposiciones",
        "transporte","servicios","emergencia"
      ],
      fallback:"No encontr√© una respuesta directa. Prueba un bot√≥n (wifi, terraza, transporte, visitar‚Ä¶).",
      fb_label:"¬øTe result√≥ √∫til?",
      fb_like:"üëç Me gusta",
      fb_dislike:"üëé No me gusta",
      fb_thanks:"¬°Gracias por tu opini√≥n!"
    },
    apt:{
      checkin_time:"15:00", checkout_time:"11:00",
      wifi_note:"Router sobre la mesa. G√≠ralo para ver SSID y contrase√±a en la etiqueta.",
      wifi_ssid:"Ver etiqueta del router", wifi_password:"Ver etiqueta del router",
      water_note:"El agua del grifo es potable. Agua caliente siempre disponible.<br><br><b>IMPORTANTE:</b> no toques el interruptor a la izquierda del espejo del ba√±o (controla el agua caliente).",
      ac_note:"Hay aire acondicionado. Ap√°galo al salir.",
      bathroom_amenities:"Secador, alfombrilla, papel higi√©nico, jab√≥n de manos.",
      towels_note:"Por hu√©sped: 1 toalla grande + 1 mediana + 1 peque√±a. Camas preparadas a la llegada.",
      lighting_note:"Luces cocina: interruptor a la derecha de las escaleras (mirando a la cocina). Luces terraza: interruptor interior a la derecha antes de salir.",
      kitchen_note:"Cocina equipada.<br><br><b>Placa el√©ctrica:</b> apagar SIEMPRE tras su uso y no dejar ollas sin vigilancia.",
      terrace_note:"Si abres la sombrilla de la terraza, √ÅTALA a la barandilla. Ci√©rrala y des√°tala antes de salir.",
      plants_note:"Si quieres, puedes regar las plantas una vez al d√≠a (excepto cactus).",
      front_door_access:"Usa la llave larga con punta cuadrada; tira de la puerta hacia ti y gira en sentido antihorario.",
      building_code:"C√≥digo de la puerta (alternativa a la llave redonda): <b>7171 + s√≠mbolo de llave</b>.",
      intercom_note:"‚Äî",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express (Via Urbana) ‚Ä¢ Minimercados en Via Leonina.",
      pharmacies:"Farmacia Cavour (Via Cavour 84) ‚Ä¢ Farmacia en Via Panisperna 40.",
      atms:"BNL (Via Cavour 84) ‚Ä¢ UniCredit (Piazza della Suburra 5).",
      laundry:"Lavander√≠a Wash & Dry ‚Äî Via Cavour 194 (autoservicio).",
      luggage:"Radical Storage en Termini y Largo Argentina (reserva online).",
      sims:"Iliad ‚Äî Via Cavour 196 ‚Ä¢ TIM/Vodafone ‚Äî Via Nazionale.",
      transport:"Metro B ‚Äî estaci√≥n Cavour (~5 min). Buses 75, 117, 84 en Via Cavour. En Monti se camina muy bien.",
      airports:"Fiumicino: Metro B Cavour ‚Üí Termini ‚Üí Leonardo Express (32 min) o FL1 desde Trastevere. Ciampino: bus a Termini ‚Üí Metro B Cavour.",
      taxi:"Radio Taxi +39 06 3570 o app FreeNow.",
      emergency:"Emergencia UE 112 ‚Ä¢ Polic√≠a 113 ‚Ä¢ Ambulancia 118 ‚Ä¢ Bomberos 115 ‚Ä¢ M√©dico en ingl√©s +39 06 488 2371 ‚Ä¢ Veterinario 24h +39 06 660 681",
      eat:"La Carbonara ‚Ä¢ Ai Tre Scalini ‚Ä¢ Trattoria Vecchia Roma ‚Ä¢ Fafiuche Wine Bar ‚Ä¢ Al42 by Pasta Chef Monti ‚Ä¢ Broccoletti ‚Ä¢ Cuoco e Camicia",
      drink:"VinoRoma ‚Ä¢ La Bottega del Caff√® ‚Ä¢ Spritzeria Monti ‚Ä¢ Blackmarket Hall.",
      shop:"Mercato Monti Vintage (Via Leonina 46, fines de semana) ‚Ä¢ Boutiques Via Urbana & Via del Boschetto ‚Ä¢ Librer√≠a Panisperna ‚Ä¢ Artesan√≠a cuero & dise√±o.",
      visit:"Piazza Madonna dei Monti ‚Ä¢ Santa Maria ai Monti ‚Ä¢ San Martino ai Monti ‚Ä¢ San Pietro in Vincoli (Mois√©s) ‚Ä¢ Colle Oppio & Domus Aurea ‚Ä¢ Mercados de Trajano & Foro.",
      hidden_gems:"Subterr√°neos de San Martino ai Monti (gu√≠a) ‚Ä¢ Santa Pr√°xedes (capilla de San Zen√≥n) ‚Ä¢ Scalinata dei Borgia ‚Ä¢ antigua Suburra ‚Ä¢ Casas romanas bajo Santa Pudenciana.",
      experiences:"Aperitivo en la plaza ‚Ä¢ Vintage en Mercato Monti ‚Ä¢ Fotos al atardecer ‚Ä¢ Paseo por Via Urbana & Via dei Serpenti ‚Ä¢ Ruta nocturna junto al Foro.",
      romantic_walk:"Inicio: Via Leonina 71 ‚Üí Coliseo ‚Üí Arco de Constantino ‚Üí Fori Imperiali ‚Üí vista del Campidoglio ‚Üí Fatamorgana Monti ‚Üí La Bottega del Caff√® ‚Üí regreso.",
      daytrips:"Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste y Villa Adriana ~1h) ‚Ä¢ Castelli Romani.",
      checkout_note:"Antes de salir: apaga luces/AC, cierra ventanas, deja las llaves en la mesa y cierra la puerta suavemente."
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","contrase√±a","router"],t:a=>`Wi-Fi: ${a.wifi_note}<br><br>Red: ${a.wifi_ssid}. Contrase√±a: ${a.wifi_password}.`},
      {k:"check in",keys:["check in","llegada","acceso","entrada","puerta","edificio","c√≥digo","interfono"],t:a=>`Check-in desde las ${a.checkin_time}.<br><br>Acceso: ${a.front_door_access}<br><br>C√≥digo puerta: ${a.building_code}<br><br>¬øAyuda? ${a.host_phone}.`},
      {k:"check out",keys:["check out","salida","irse"],t:a=>a.checkout_note},
      {k:"agua",keys:["agua","caliente","potable","grifo","espejo","caldera"],t:a=>a.water_note},
      {k:"aire acondicionado",keys:["aire acondicionado","ac","clima"],t:a=>a.ac_note},
      {k:"ba√±o",keys:["ba√±o","secador","jab√≥n","toallas"],t:a=>`Ba√±o: ${a.bathroom_amenities}<br><br>Toallas: ${a.towels_note}`},
      {k:"cocina",keys:["cocina","cocinar","placa","el√©ctrica"],t:a=>a.kitchen_note},
      {k:"terraza",keys:["terraza","sombrilla","plantas","balc√≥n","luz"],t:a=>`Terraza: ${a.terrace_note}<br><br>Plantas: ${a.plants_note}<br><br>Luces: ${a.lighting_note}`},
      {k:"servicios",keys:["farmacia","hospital","cajero","sim","lavander√≠a","equipaje","supermercado","compras"],t:a=>
        `Supermercados: ${a.supermarkets}<br><br>Farmacias: ${a.pharmacies}<br><br>Cajeros: ${a.atms}<br><br>Lavander√≠a: ${a.laundry}<br><br>Consigna: ${a.luggage}<br><br>SIM: ${a.sims}`
      },
      {k:"transporte",keys:["transporte","tranv√≠a","bus","taxi","aeropuerto","tren","metro"],t:a=>
        `${a.transport}<br><br>Aeropuertos: ${a.airports}<br><br>Taxi: ${a.taxi}`
      },
      {k:"comer",keys:["comer","restaurante","cena","almuerzo"],t:a=>a.eat},
      {k:"beber",keys:["beber","bar","vino","c√≥ctel"],t:a=>a.drink},
      {k:"compras",keys:["compras","mercado","boutique","vintage"],t:a=>a.shop},
      {k:"visitar",keys:["visitar","ver","atracciones","museo","mois√©s","domus aurea"],t:a=>a.visit},
      {k:"joyas ocultas",keys:["oculto","secreto","suburra","pudenciana"],t:a=>a.hidden_gems},
      {k:"experiencias",keys:["experiencias","paseo","tour","itinerario","atardecer","rom√°ntico"],t:a=>`${a.experiences}<br><br>Ruta rom√°ntica: ${a.romantic_walk}`},
      {k:"excursiones",keys:["excursi√≥n","tivoli","ostia","castelli","d√≠a"],t:a=>a.daytrips},

      /* --- ES puliti --- */
      {k:"entradas y eventos",keys:["entrada","entradas","ticket","eventos","concierto","partido","match"],t:()=>
        `ENTRADAS Y EVENTOS ‚Äî ROMA<br><br>
        ‚Ä¢ TicketOne (conciertos, teatro, deporte): <a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">https://www.ticketone.it/en/</a><br><br>
        ‚Ä¢ AS Roma ‚Äî entradas oficiales: <a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">https://www.asroma.com/en/tickets</a><br><br>
        ‚Ä¢ SS Lazio ‚Äî entradas oficiales: <a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">https://sslazio.it/en/tickets</a>`
      },
      {k:"museos y sitios",keys:["museo","museos","sitio","sitios","vaticano","coliseo"],t:()=>
        `MUSEOS Y SITIOS ‚Äî ROMA<br><br>
        ‚Ä¢ Museos Vaticanos: <a href="https://www.museivaticani.va/content/museivaticani/en.html" target="_blank" rel="noopener noreferrer">https://www.museivaticani.va/content/museivaticani/en.html</a><br><br>
        ‚Ä¢ Coliseo / Foro / Palatino: <a href="https://parcocolosseo.it/en/" target="_blank" rel="noopener noreferrer">https://parcocolosseo.it/en/</a><br><br>
        ‚Ä¢ Galer√≠a Borghese: <a href="https://galleriaborghese.beniculturali.it/en/" target="_blank" rel="noopener noreferrer">https://galleriaborghese.beniculturali.it/en/</a>`
      },
      {k:"exposiciones",keys:["exposici√≥n","exposiciones","maxxi","quirinale","arte"],t:()=>
        `EXPOSICIONES ‚Äî ROMA<br><br>
        ‚Ä¢ MAXXI: <a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">https://www.maxxi.art/en/</a><br><br>
        ‚Ä¢ Palazzo delle Esposizioni: <a href="https://www.palazzoesposizioni.it/" target="_blank" rel="noopener noreferrer">https://www.palazzoesposizioni.it/</a><br><br>
        ‚Ä¢ Scuderie del Quirinale: <a href="https://www.scuderiequirinale.it/en" target="_blank" rel="noopener noreferrer">https://www.scuderiequirinale.it/en</a><br><br>
        ‚Ä¢ Palazzo Bonaparte (Arthemisia): <a href="https://www.arthemisia.it/site/en/palazzo-bonaparte.html" target="_blank" rel="noopener noreferrer">https://www.arthemisia.it/site/en/palazzo-bonaparte.html</a>`
      },

      {k:"emergencia",keys:["emergencia","polic√≠a","ambulancia","bomberos","m√©dico","veterinario"],t:a=>a.emergency}
    ]
  }
}; /* <-- chiude const DATA */
/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById("chat");
const input  = document.getElementById("input");
const sendBtn= document.getElementById("sendBtn");

const url = new URL(location.href);
let lang = (url.searchParams.get("lang") || localStorage.getItem("lang") || (navigator.language||"en").slice(0,2)).toLowerCase();
if(!DATA[lang]) lang="en";
url.searchParams.set("lang",lang);
history.replaceState(null,"",url);
localStorage.setItem("lang",lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:["Samantha","Google US English","Google UK English Female","Microsoft Aria Online (Natural)"],
  it:["Alice","Eloisa","Google italiano","Microsoft Elsa Online (Natural)","Microsoft Isabella Online (Natural)"],
  fr:["Amelie","Thomas","Google fran√ßais","Microsoft Denise Online (Natural)","Microsoft Vivienne Online (Natural)"],
  de:["Anna","Markus","Google Deutsch","Microsoft Katja Online (Natural)","Microsoft Conrad Online (Natural)"],
  es:["Monica","Jorge","Paulina","Google espa√±ol","Microsoft Alvaro Online (Natural)"]
};
function selectVoice(){
  if(!("speechSynthesis" in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||"").toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||"").toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if("speechSynthesis" in window){
  refreshVoice();
  speechSynthesis.onvoiceschanged = refreshVoice;
}
function warm(){
  if(!("speechSynthesis" in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance(".");
    dot.volume=0.01;
    if(pick) dot.voice=pick;
    dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch(e){}
}
function speak(t){
  if(!voiceOn || !("speechSynthesis" in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t.replace(/<[^>]+>/g,""));
    if(pick) u.voice=pick;
    u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch(e){}
}

document.getElementById("voiceBtn").addEventListener("click",e=>{
  voiceOn=!voiceOn;
  e.currentTarget.setAttribute("aria-pressed",String(voiceOn));
  applyUI();
  if(voiceOn) warm();
});
document.querySelector(".lang").addEventListener("click",e=>{
  const btn=e.target.closest("[data-lang]");
  if(!btn) return;
  lang = btn.getAttribute("data-lang");
  localStorage.setItem("lang",lang);
  const u=new URL(location.href);
  u.searchParams.set("lang",lang);
  history.replaceState(null,"",u);
  refreshVoice();
  applyUI();
  chatEl.innerHTML="";
  welcome();
  if(voiceOn) warm();
});

function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById("aptLabel").textContent = L.apt_label;
  document.getElementById("voiceBtn").textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll(".lang [data-lang]").forEach(b=>{
    b.setAttribute("aria-current", b.getAttribute("data-lang")===lang ? "true" : "false");
  });
}

/* ============ CHAT LOGIC + FEEDBACK ============ */
function linkify(html){
  if(!html) return "";
  // se il testo contiene gi√† un link HTML, non tocchiamo niente
  if (html.includes("<a ") || html.includes("<A ")) {
    return html;
  }
  return html.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
}

function add(type, txt){
  const d=document.createElement("div");
  d.className="msg "+(type==="me"?"me":"wd");
  if(type==="me"){
    d.textContent = txt;
  }else{
    d.innerHTML = linkify(txt);
  }
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
  return d;
}

function detectIntent(text){
  const L = DATA[lang];
  const t = (text||"").toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0;
    for(const k of it.keys){
      if(t.includes(k.toLowerCase())) s++;
    }
    if(s>score){
      score=s;
      best=it;
    }
  }
  return best;
}

function getAnswer(text){
  const L = DATA[lang];
  const apt = L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic:'fallback' };
  try{
    const out = m.t(apt);
    return { text: out, topic: m.k };
  }catch(e){
    return { text: L.ui.fallback, topic:'fallback' };
  }
}

/* invio feedback al Google Sheet */
function postFeedback(vote, topic, answerText){
  try{
    fetch(GOOGLE_SCRIPT_URL, {
      method:"POST",
      mode:"no-cors",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        apartment_id: APARTMENT_ID,
        language: (lang||"en").toUpperCase(),
        topic: topic,
        answer_text: answerText,
        vote: vote
      })
    });
  }catch(e){}
}

function attachFeedbackUI(container, topic, answerText){
  const L = DATA[lang].ui;
  const box = document.createElement("div");
  box.className='fb-box';
  const label = document.createElement("span");
  label.className='fb-label';
  label.textContent = L.fb_label || "Was this helpful?";
  const likeBtn = document.createElement("button");
  likeBtn.type='button';
  likeBtn.textContent = L.fb_like || "üëç Like";
  const dislikeBtn = document.createElement("button");
  dislikeBtn.type='button';
  dislikeBtn.textContent = L.fb_dislike || "üëé Dislike";
  const done = document.createElement("span");
  done.className='fb-done';
  done.textContent = L.fb_thanks || "Thanks!";
  done.style.display='none';

  function finish(v){
    likeBtn.disabled = true;
    dislikeBtn.disabled = true;
    likeBtn.style.opacity = 0.6;
    dislikeBtn.style.opacity = 0.6;
    done.style.display='inline';
    postFeedback(v, topic, answerText);
  }

  likeBtn.addEventListener('click',()=>finish('like'));
  dislikeBtn.addEventListener('click',()=>finish('dislike'));

  box.appendChild(label);
  box.appendChild(likeBtn);
  box.appendChild(dislikeBtn);
  box.appendChild(done);
  container.appendChild(box);
}

function welcome(){
  const L = DATA[lang].ui;
  const intro = document.createElement("div");
  intro.className="intro";
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);

  const q = document.createElement("div");
  q.className="quick";
  for(const key of L.quick){
    const b=document.createElement("button");
    b.textContent = key;
    b.onclick = ()=>{ input.value = key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}

function send(){
  const text = (input.value||"").trim();
  if(!text) return;
  add("me", text);
  input.value='';
  const { text:bot, topic } = getAnswer(text);
  const botNode = add("wd", bot);
  speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}

sendBtn.addEventListener("click", send);
input.addEventListener("keydown", e=>{
  if(e.key==="Enter") send();
});

applyUI();
welcome();
</script>
</body>
</html>
