<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help ‚Äî Via Leonina 71</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px;z-index:10}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:normal;word-break:break-word}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.msg a{color:#a33;text-decoration:underline}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: LEONINA71</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">üîá Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>
  <main id="chat" aria-live="polite"></main>
  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>
<script>
/* === CONFIG === */
const APARTMENT_ID = "LEONINA71";
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzI-uKj5SjzxpidtJJczWGi1ZIy9n5fkqHEqs8A4LkdeRluJJ14uEqlKzio5rD3Kus8/exec";

/* ============ CONTENUTI LOCALIZZATI (LEONINA 71) ============ */
const DATA = {
  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶",
      apt_label: "Apartment",
      voice_on: "üîä Voice: On",
      voice_off: "üîá Voice: Off",
      quick: [
        "wifi","check in","check out","water","AC","bathroom","kitchen","terrace",
        "eat","drink","shop","visit","hidden gems","experience","day trips",
        "tickets & events","museums & sites","exhibitions",
        "transport","services","emergency"
      ],
      fallback: "I did not find a direct answer. Try a quick button like wifi, terrace, transport, or visit.",
      fb_label:"Was this helpful?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Thanks for your feedback!"
    },
    apt: {
      checkin_time:"15:00", 
      checkout_time:"11:00",
      wifi_note:"The router is on the table. Turn it to see the SSID and password on the label.",
      wifi_ssid:"See router label", 
      wifi_password:"See router label",
      water_note:"Tap water is safe and drinkable. Hot water is always available. Important: do not touch the switch on the left side of the bathroom mirror, it controls the hot water system.",
      ac_note:"Air conditioning is available. Please turn it OFF when you leave the apartment.",
      bathroom_amenities:"Hairdryer, bath mat, toilet paper, and hand soap.",
      towels_note:"Per guest: 1 large, 1 medium, and 1 small towel. Beds are prepared on arrival.",
      lighting_note:"Kitchen lights: switch on the right side of the stairs (facing the kitchen). Terrace lights: switch inside on the right before exiting.",
      kitchen_note:"Fully equipped kitchen. Electric hot plate: always turn it OFF after use and never leave pots unattended.",
      terrace_note:"If you open the terrace umbrella, TIE it to the railing. Always close it before leaving.",
      plants_note:"If you like, you can water the plants once a day, except cacti.",
      front_door_access:"Use the long key with the square end. Pull the door toward you and turn counter-clockwise.",
      building_code:"Building door code (alternative to the round key): 7171 followed by the key symbol.",
      intercom_note:"16",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express on Via Urbana. Mini-markets on Via Leonina.",
      pharmacies:"Farmacia Cavour at Via Cavour 84. Pharmacy at Via Panisperna 40.",
      atms:"BNL at Via Cavour 84. UniCredit at Piazza della Suburra 5.",
      laundry:"Wash and Dry self-service laundry at Via Cavour 194.",
      luggage:"Radical Storage in the Termini and Largo Argentina areas with online booking.",
      sims:"Iliad at Via Cavour 196. TIM and Vodafone on Via Nazionale.",
      transport:"Metro B Cavour stop about 5 minutes away. Buses 75, 117, and 84 on Via Cavour. The Monti district is ideal for walking.",
      airports:"Fiumicino: Metro B Cavour to Termini then Leonardo Express or FL1 from Trastevere. Ciampino: bus to Termini then Metro B Cavour. Private transfer available with Welcome Pickups.",
      taxi:"Radio Taxi 06 3570 or FreeNow app.",
      emergency:"EU Emergency 112. Police 113. Ambulance 118. Fire Brigade 115. English-speaking doctor 06 488 2371. 24-hour vet 06 660 681.",
      eat:"La Carbonara. Ai Tre Scalini. Trattoria Vecchia Roma. Fafiuche Wine Bar. Al42 by Pasta Chef Monti. Broccoletti. Cuoco e Camicia.",
      drink:"VinoRoma. La Bottega del Caff√® in Piazza Madonna dei Monti. Spritzeria Monti. Blackmarket Hall.",
      shop:"Mercato Monti Vintage at Via Leonina 46 on weekends. Boutiques on Via Urbana and Via del Boschetto. Panisperna Bookshop. Leather and design crafts.",
      visit:"Piazza Madonna dei Monti. Santa Maria ai Monti. San Martino ai Monti. San Pietro in Vincoli with Michelangelo's Moses. Colle Oppio Park and Domus Aurea. Trajan's Markets and Imperial Forums.",
      hidden_gems:"Underground of San Martino ai Monti with guided tours. Santa Prassede and Chapel of San Zenone. Borgia Staircase. Ancient Suburra. Roman houses under Santa Pudenziana.",
      experiences:"Aperitivo in Piazza Madonna dei Monti. Vintage shopping at Mercato Monti. Sunset photos from rooftops or terrace. Walk along Via Urbana and Via dei Serpenti. Evening stroll along the Forums.",
      romantic_walk:"Recommended route: Via Leonina 71, Colosseum, Arch of Constantine, Via dei Fori Imperiali, view from Campidoglio, gelato from Fatamorgana Monti, La Bottega del Caff√®, return.",
      daytrips:"Ostia Antica about 40 minutes. Tivoli with Villa d'Este and Villa Adriana about 1 hour. Castelli Romani.",
      checkout_note:"Before leaving: turn off lights and air conditioning, close windows, leave keys on the table, and gently close the door."
    },
    intents: [
      {k:"wifi",keys:["wifi","wi-fi","internet","password","router","network"],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Network: ${a.wifi_ssid}<br>Password: ${a.wifi_password}`},
      
      {k:"check in",keys:["check in","arrival","access","entrance","door","front door","building","code","intercom"],t:a=>`<b>CHECK-IN</b><br>You can check in from ${a.checkin_time}.<br><br><b>Access:</b> ${a.front_door_access}<br><br><b>Building code:</b> ${a.building_code}<br><br><b>Intercom:</b> ${a.intercom_note}<br><br>Need help? Call ${a.host_phone}`},
      
      {k:"check out",keys:["check out","departure","leave","leaving"],t:a=>`<b>CHECK-OUT</b><br>Check-out time is ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:"water",keys:["water","hot water","drinkable","tap","mirror switch","boiler"],t:a=>`<b>WATER</b><br>${a.water_note}`},
      
      {k:"AC",keys:["ac","air conditioning","aircon","air","climate","heating","cooling"],t:a=>`<b>AIR CONDITIONING</b><br>${a.ac_note}`},
      
      {k:"bathroom",keys:["bathroom","hairdryer","soap","towels","shower","hair dryer"],t:a=>`<b>BATHROOM</b><br>You will find: ${a.bathroom_amenities}<br><br><b>Towels:</b> ${a.towels_note}`},
      
      {k:"kitchen",keys:["kitchen","cook","cooking","stove","hot plate","electric"],t:a=>`<b>KITCHEN</b><br>${a.kitchen_note}`},
      
      {k:"terrace",keys:["terrace","umbrella","plants","balcony","light","lights"],t:a=>`<b>TERRACE</b><br>${a.terrace_note}<br><br><b>Plants:</b> ${a.plants_note}<br><br><b>Lights:</b> ${a.lighting_note}`},
      
      {k:"services",keys:["pharmacy","hospital","atm","sim","laundry","luggage","supermarket","groceries"],t:a=>`<b>USEFUL SERVICES</b><br><br><b>Supermarkets:</b> ${a.supermarkets}<br><br><b>Pharmacies:</b> ${a.pharmacies}<br><br><b>ATMs:</b> ${a.atms}<br><br><b>Laundry:</b> ${a.laundry}<br><br><b>Luggage storage:</b> ${a.luggage}<br><br><b>SIM cards:</b> ${a.sims}`},
      
      {k:"transport",keys:["transport","tram","bus","taxi","airport","train","metro","getting around","how to get"],t:a=>`<b>TRANSPORT</b><br>${a.transport}<br><br><b>Airports:</b> ${a.airports}<br><br><b>Taxi:</b> ${a.taxi}`},
      
      {k:"eat",keys:["eat","restaurant","dinner","lunch","food","where to eat","pizzeria","trattoria"],t:a=>`<b>WHERE TO EAT</b><br>${a.eat}`},
      
      {k:"drink",keys:["drink","bar","wine","cocktail","aperitivo","coffee","drinks"],t:a=>`<b>WHERE TO DRINK</b><br>${a.drink}`},
      
      {k:"shop",keys:["shop","market","shopping","buy","grocery","supermarket","boutique","vintage"],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:"visit",keys:["visit","what to see","museum","attractions","see","monuments","tourism","sites","moses","domus aurea"],t:a=>`<b>WHAT TO VISIT</b><br>${a.visit}`},
      
      {k:"hidden gems",keys:["hidden","secret","gem","less-known","underground","suburra","pudenziana"],t:a=>`<b>HIDDEN GEMS</b><br>${a.hidden_gems}`},
      
      {k:"experience",keys:["experience","walk","tour","itinerary","sunset","romantic","what to do","activities"],t:a=>`<b>RECOMMENDED EXPERIENCES</b><br>${a.experiences}<br><br><b>Romantic walk:</b> ${a.romantic_walk}`},
      
      {k:"day trips",keys:["day trips","day trip","tivoli","ostia","castelli","excursion","excursions","outside rome"],t:a=>`<b>DAY TRIPS</b><br>${a.daytrips}`},
      
      {k:"emergency",keys:["emergency","police","ambulance","fire","doctor","vet","help","urgent","sos"],t:a=>`<b>EMERGENCIES</b><br>${a.emergency}`},

      {
        k:"tickets & events",
        keys:["tickets & events","tickets","events","concert","concerts","match","shows","theatre"],
        t:()=>`<b>TICKETS AND EVENTS IN ROME</b><br><br>‚Ä¢ <b>TicketOne</b> - concerts, theatre, sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - official tickets:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - official tickets:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:"museums & sites",
        keys:["museums & sites","museums","museum","sites","monuments","colosseum","vatican","forums"],
        t:()=>`<b>MUSEUMS AND ARCHAEOLOGICAL SITES</b><br><br>‚Ä¢ <b>Colosseum, Roman Forum and Palatine:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Vatican Museums and Sistine Chapel:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Rome Museums</b> (Capitoline, Ara Pacis, etc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:"exhibitions",
        keys:["exhibitions","exhibition","art","shows","temporary","galleries"],
        t:()=>`<b>EXHIBITIONS AND ART SHOWS</b><br><br>‚Ä¢ <b>Musei in Comune</b> - temporary exhibitions:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museum of 21st Century Arts:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

  it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante ‚Äî oppure scrivi qui‚Ä¶",
      apt_label:"Appartamento", 
      voice_on:"üîä Voce: On", 
      voice_off:"üîá Voce: Off",
      quick:[
        "wifi","check in","check out","acqua","aria condizionata","bagno","cucina","terrazzo",
        "mangiare","bere","shopping","visitare","angoli nascosti","esperienze","gite di un giorno",
        "biglietti ed eventi","musei e siti","mostre",
        "trasporti","servizi","emergenza"
      ],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante rapido come wifi, terrazzo, trasporti o visitare.",
      fb_label:"Ti √® stato utile?",
      fb_like:"üëç Mi piace",
      fb_dislike:"üëé Non mi piace",
      fb_thanks:"Grazie per il tuo feedback!"
    },
    apt:{
      checkin_time:"15:00", 
      checkout_time:"11:00",
      wifi_note:"Il router √® sul tavolo. Giralo per leggere SSID e password sull'etichetta.",
      wifi_ssid:"Vedi etichetta del router", 
      wifi_password:"Vedi etichetta del router",
      water_note:"L'acqua del rubinetto √® potabile. L'acqua calda √® sempre disponibile. Importante: non toccare l'interruttore a sinistra dello specchio del bagno, comanda l'impianto dell'acqua calda.",
      ac_note:"Aria condizionata presente. Spegnila sempre quando esci dall'appartamento.",
      bathroom_amenities:"Asciugacapelli, tappetino, carta igienica e sapone per le mani.",
      towels_note:"Per ogni ospite: un telo grande, uno medio e uno piccolo. Letti pronti all'arrivo.",
      lighting_note:"Luci cucina: interruttore a destra delle scale guardando la cucina. Luci terrazzo: interruttore interno a destra prima dell'uscita.",
      kitchen_note:"Cucina completamente attrezzata. Piastra elettrica: spegnerla sempre dopo l'uso e non lasciare mai pentole incustodite.",
      terrace_note:"Se apri l'ombrellone del terrazzo, legalo alla ringhiera. Chiudilo sempre prima di uscire.",
      plants_note:"Se vuoi puoi bagnare le piante una volta al giorno, esclusi i cactus.",
      front_door_access:"Usa la chiave lunga con punta quadrata. Tira il portone verso di te e gira in senso antiorario.",
      building_code:"Codice portone come alternativa alla chiave tonda: 7171 seguito dal simbolo della chiave.",
      intercom_note:"16",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express in Via Urbana. Minimarket in Via Leonina.",
      pharmacies:"Farmacia Cavour in Via Cavour 84. Farmacia in Via Panisperna 40.",
      atms:"BNL in Via Cavour 84. UniCredit in Piazza della Suburra 5.",
      laundry:"Lavanderia self service Wash and Dry in Via Cavour 194.",
      luggage:"Radical Storage in zona Termini e Largo Argentina con prenotazione online.",
      sims:"Iliad in Via Cavour 196. TIM e Vodafone in Via Nazionale.",
      transport:"Metro B fermata Cavour a circa cinque minuti. Bus 75, 117 e 84 su Via Cavour. Il quartiere Monti √® ideale da girare a piedi.",
      airports:"Fiumicino: Metro B Cavour fino a Termini e poi Leonardo Express oppure FL1 da Trastevere. Ciampino: bus per Termini e poi Metro B Cavour. Disponibile transfer privato con Welcome Pickups.",
      taxi:"Radio Taxi 06 3570 oppure app FreeNow.",
      emergency:"Emergenze UE 112. Polizia 113. Ambulanza 118. Vigili del Fuoco 115. Medico in inglese 06 488 2371. Veterinario 24 ore 06 660 681.",
      eat:"La Carbonara. Ai Tre Scalini. Trattoria Vecchia Roma. Fafiuche Wine Bar. Al42 by Pasta Chef Monti. Broccoletti. Cuoco e Camicia.",
      drink:"VinoRoma. La Bottega del Caff√® in Piazza Madonna dei Monti. Spritzeria Monti. Blackmarket Hall.",
      shop:"Mercato Monti Vintage in Via Leonina 46 nel weekend. Boutique in Via Urbana e Via del Boschetto. Libreria Panisperna. Artigianato in pelle e design.",
      visit:"Piazza Madonna dei Monti. Santa Maria ai Monti. San Martino ai Monti. San Pietro in Vincoli con il Mos√® di Michelangelo. Parco del Colle Oppio e Domus Aurea. Mercati di Traiano e Fori Imperiali.",
      hidden_gems:"Sotterranei di San Martino ai Monti con visite guidate. Santa Prassede e Cappella di San Zenone. Scalinata dei Borgia. Antica Suburra. Case romane sotto Santa Pudenziana.",
      experiences:"Aperitivo in Piazza Madonna dei Monti. Shopping vintage al Mercato Monti. Foto al tramonto dai tetti o dal terrazzo. Passeggiata in Via Urbana e Via dei Serpenti. Serata lungo i Fori.",
      romantic_walk:"Percorso consigliato: Via Leonina 71, Colosseo, Arco di Costantino, Via dei Fori Imperiali, vista dal Campidoglio, gelato da Fatamorgana Monti, La Bottega del Caff√®, rientro.",
      daytrips:"Ostia Antica circa quaranta minuti. Tivoli con Villa d'Este e Villa Adriana circa un'ora. Castelli Romani.",
      checkout_note:"Prima di partire spegni luci e aria condizionata, chiudi le finestre, lascia le chiavi sul tavolo e chiudi la porta delicatamente.",
      host_phone:"+39 335 5245756"
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","password","router","rete"],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Rete: ${a.wifi_ssid}<br>Password: ${a.wifi_password}`},
      
      {k:"check in",keys:["check in","arrivo","accesso","ingresso","porta","portone","edificio","codice","citofono"],t:a=>`<b>CHECK-IN</b><br>Puoi effettuare il check-in a partire dalle ${a.checkin_time}.<br><br><b>Accesso:</b> ${a.front_door_access}<br><br><b>Codice portone:</b> ${a.building_code}<br><br><b>Citofono:</b> ${a.intercom_note}<br><br>Hai bisogno di aiuto? Chiama ${a.host_phone}`},
      
      {k:"check out",keys:["check out","partenza","lasciare","uscita"],t:a=>`<b>CHECK-OUT</b><br>Il check-out √® alle ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:"acqua",keys:["acqua","acqua calda","potabile","rubinetto","interruttore specchio","boiler"],t:a=>`<b>ACQUA</b><br>${a.water_note}`},
      
      {k:"aria condizionata",keys:["aria condizionata","clima","condizionatore","ac","climatizzatore","freddo","caldo"],t:a=>`<b>ARIA CONDIZIONATA</b><br>${a.ac_note}`},
      
      {k:"bagno",keys:["bagno","asciugacapelli","sapone","asciugamani","doccia","phon"],t:a=>`<b>BAGNO</b><br>Troverai: ${a.bathroom_amenities}<br><br><b>Asciugamani:</b> ${a.towels_note}`},
      
      {k:"cucina",keys:["cucina","cucinare","fornelli","piastra","elettrica"],t:a=>`<b>CUCINA</b><br>${a.kitchen_note}`},
      
      {k:"terrazzo",keys:["terrazzo","ombrellone","piante","balcone","luci","luce"],t:a=>`<b>TERRAZZO</b><br>${a.terrace_note}<br><br><b>Piante:</b> ${a.plants_note}<br><br><b>Luci:</b> ${a.lighting_note}`},
      
      {k:"servizi",keys:["farmacia","ospedale","bancomat","sim","lavanderia","bagagli","servizi","atm","carta sim","supermercato","spesa"],t:a=>`<b>SERVIZI UTILI</b><br><br><b>Supermercati:</b> ${a.supermarkets}<br><br><b>Farmacie:</b> ${a.pharmacies}<br><br><b>Bancomat:</b> ${a.atms}<br><br><b>Lavanderia:</b> ${a.laundry}<br><br><b>Deposito bagagli:</b> ${a.luggage}<br><br><b>SIM card:</b> ${a.sims}`},
      
      {k:"trasporti",keys:["trasporti","tram","bus","taxi","aeroporto","treno","metro","muoversi","come arrivare"],t:a=>`<b>TRASPORTI</b><br>${a.transport}<br><br><b>Aeroporti:</b> ${a.airports}<br><br><b>Taxi:</b> ${a.taxi}`},
      
      {k:"mangiare",keys:["mangiare","ristorante","cena","pranzo","cibo","dove mangiare","pizzeria","trattoria"],t:a=>`<b>DOVE MANGIARE</b><br>${a.eat}`},
      
      {k:"bere",keys:["bere","bar","vino","cocktail","aperitivo","caff√®","drink"],t:a=>`<b>DOVE BERE</b><br>${a.drink}`},
      
      {k:"shopping",keys:["shopping","mercato","negozi","comprare","spesa","supermercato","boutique","vintage"],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:"visitare",keys:["visitare","cosa vedere","museo","attrazioni","vedere","monumenti","turismo","siti","mos√®","domus aurea"],t:a=>`<b>COSA VISITARE</b><br>${a.visit}`},
      
      {k:"angoli nascosti",keys:["nascosti","segreti","angoli","poco conosciuti","sotterranei","suburra","pudenziana"],t:a=>`<b>ANGOLI NASCOSTI</b><br>${a.hidden_gems}`},
      
      {k:"esperienze",keys:["esperienze","passeggiata","tour","itinerario","tramonto","romantico","cosa fare","attivit√†"],t:a=>`<b>ESPERIENZE CONSIGLIATE</b><br>${a.experiences}<br><br><b>Passeggiata romantica:</b> ${a.romantic_walk}`},
      
      {k:"gite di un giorno",keys:["gite","gita","tivoli","ostia","castelli","escursione","escursioni","fuori roma"],t:a=>`<b>GITE DI UN GIORNO</b><br>${a.daytrips}`},
      
      {k:"emergenza",keys:["emergenza","polizia","ambulanza","vigili","medico","veterinario","aiuto","urgenza","sos"],t:a=>`<b>EMERGENZE</b><br>${a.emergency}`},

      {
        k:"biglietti ed eventi",
        keys:["biglietti","tickets","evento","eventi","concerto","concerti","partita","spettacoli","teatro"],
        t:()=>`<b>BIGLIETTI ED EVENTI A ROMA</b><br><br>‚Ä¢ <b>TicketOne</b> - concerti, teatro, sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - biglietti ufficiali:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - biglietti ufficiali:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:"musei e siti",
        keys:["museo","musei","sito","siti","monumenti","colosseo","vaticano","fori"],
        t:()=>`<b>MUSEI E SITI ARCHEOLOGICI</b><br><br>‚Ä¢ <b>Colosseo, Foro Romano e Palatino:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Musei Vaticani e Cappella Sistina:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Musei di Roma Capitale</b> (Capitolini, Ara Pacis, ecc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:"mostre",
        keys:["mostre","mostra","arte","esposizioni","temporanee","gallerie"],
        t:()=>`<b>MOSTRE ED ESPOSIZIONI</b><br><br>‚Ä¢ <b>Musei in Comune</b> - mostre temporanee:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museo delle Arti del XXI secolo:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },
  fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une r√©ponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ‚Äî ou √©crivez ici‚Ä¶",
      apt_label:"Appartement", 
      voice_on:"üîä Voix : Activ√©e", 
      voice_off:"üîá Voix : D√©sactiv√©e",
      quick:[
        "wifi","check in","check out","eau","climatisation","salle de bain","cuisine","terrasse",
        "manger","boire","shopping","visiter","tr√©sors cach√©s","exp√©riences","excursions",
        "billets & √©v√©nements","mus√©es & sites","expositions",
        "transports","services","urgence"
      ],
      fallback:"Je n'ai pas trouv√© de r√©ponse directe. Essayez un bouton rapide comme wifi, terrasse, transports ou visiter.",
      fb_label:"Cette r√©ponse vous a-t-elle aid√©¬∑e ?",
      fb_like:"üëç J'aime",
      fb_dislike:"üëé Je n'aime pas",
      fb_thanks:"Merci pour votre retour !"
    },
    apt:{
      checkin_time:"15:00", 
      checkout_time:"11:00",
      wifi_note:"Le routeur est sur la table. Tournez-le pour lire le SSID et le mot de passe sur l'√©tiquette.",
      wifi_ssid:"Voir l'√©tiquette du routeur", 
      wifi_password:"Voir l'√©tiquette du routeur",
      water_note:"L'eau du robinet est potable. L'eau chaude est toujours disponible. Important : ne touchez pas l'interrupteur √† gauche du miroir de la salle de bain, il contr√¥le le syst√®me d'eau chaude.",
      ac_note:"Climatisation disponible. Merci de l'√©teindre en sortant de l'appartement.",
      bathroom_amenities:"S√®che-cheveux, tapis de bain, papier toilette et savon pour les mains.",
      towels_note:"Par personne : une grande, une moyenne et une petite serviette. Lits pr√©par√©s √† l'arriv√©e.",
      lighting_note:"Lumi√®res cuisine : interrupteur √† droite des escaliers (face √† la cuisine). Lumi√®res terrasse : interrupteur int√©rieur √† droite avant de sortir.",
      kitchen_note:"Cuisine enti√®rement √©quip√©e. Plaque √©lectrique : l'√©teindre toujours apr√®s usage et ne jamais laisser de casseroles sans surveillance.",
      terrace_note:"Si vous ouvrez le parasol de la terrasse, attachez-le √† la rambarde. Fermez-le toujours avant de partir.",
      plants_note:"Si vous le souhaitez, vous pouvez arroser les plantes une fois par jour, sauf les cactus.",
      front_door_access:"Utilisez la longue cl√© √† bout carr√©. Tirez la porte vers vous et tournez dans le sens antihoraire.",
      building_code:"Code du portail (alternative √† la cl√© ronde) : 7171 suivi du symbole cl√©.",
      intercom_note:"16",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express dans la Via Urbana. Sup√©rettes dans la Via Leonina.",
      pharmacies:"Farmacia Cavour √† la Via Cavour 84. Pharmacie √† la Via Panisperna 40.",
      atms:"BNL √† la Via Cavour 84. UniCredit √† la Piazza della Suburra 5.",
      laundry:"Laverie Wash and Dry en libre-service √† la Via Cavour 194.",
      luggage:"Radical Storage dans les zones Termini et Largo Argentina avec r√©servation en ligne.",
      sims:"Iliad √† la Via Cavour 196. TIM et Vodafone dans la Via Nazionale.",
      transport:"M√©tro B station Cavour √† environ 5 minutes. Bus 75, 117 et 84 sur la Via Cavour. Le quartier Monti est id√©al pour marcher.",
      airports:"Fiumicino : M√©tro B Cavour jusqu'√† Termini puis Leonardo Express ou FL1 depuis Trastevere. Ciampino : bus jusqu'√† Termini puis M√©tro B Cavour. Transfert priv√© disponible avec Welcome Pickups.",
      taxi:"Radio Taxi 06 3570 ou application FreeNow.",
      emergency:"Urgences UE 112. Police 113. Ambulance 118. Pompiers 115. M√©decin anglophone 06 488 2371. V√©t√©rinaire 24h 06 660 681.",
      eat:"La Carbonara. Ai Tre Scalini. Trattoria Vecchia Roma. Fafiuche Wine Bar. Al42 by Pasta Chef Monti. Broccoletti. Cuoco e Camicia.",
      drink:"VinoRoma. La Bottega del Caff√® √† la Piazza Madonna dei Monti. Spritzeria Monti. Blackmarket Hall.",
      shop:"Mercato Monti Vintage √† la Via Leonina 46 le week-end. Boutiques dans la Via Urbana et Via del Boschetto. Librairie Panisperna. Artisanat en cuir et design.",
      visit:"Piazza Madonna dei Monti. Santa Maria ai Monti. San Martino ai Monti. San Pietro in Vincoli avec le Mo√Øse de Michel-Ange. Parc du Colle Oppio et Domus Aurea. March√©s de Trajan et Forums Imp√©riaux.",
      hidden_gems:"Souterrains de San Martino ai Monti avec visites guid√©es. Santa Prassede et Chapelle de San Zenone. Escalier des Borgia. Ancienne Suburra. Maisons romaines sous Santa Pudenziana.",
      experiences:"Ap√©ritif √† la Piazza Madonna dei Monti. Shopping vintage au Mercato Monti. Photos au coucher du soleil depuis les toits ou la terrasse. Promenade dans la Via Urbana et Via dei Serpenti. Soir√©e le long des Forums.",
      romantic_walk:"Itin√©raire recommand√© : Via Leonina 71, Colis√©e, Arc de Constantin, Via dei Fori Imperiali, vue depuis le Campidoglio, gelato de Fatamorgana Monti, La Bottega del Caff√®, retour.",
      daytrips:"Ostia Antica environ 40 minutes. Tivoli avec Villa d'Este et Villa Adriana environ 1 heure. Castelli Romani.",
      checkout_note:"Avant de partir : √©teignez les lumi√®res et la climatisation, fermez les fen√™tres, laissez les cl√©s sur la table et fermez doucement la porte."
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","mot de passe","routeur","r√©seau"],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>R√©seau : ${a.wifi_ssid}<br>Mot de passe : ${a.wifi_password}`},
      
      {k:"check in",keys:["check in","arriv√©e","acc√®s","entr√©e","porte","portail","immeuble","code","interphone"],t:a=>`<b>CHECK-IN</b><br>Vous pouvez effectuer le check-in √† partir de ${a.checkin_time}.<br><br><b>Acc√®s :</b> ${a.front_door_access}<br><br><b>Code du portail :</b> ${a.building_code}<br><br><b>Interphone :</b> ${a.intercom_note}<br><br>Besoin d'aide ? Appelez ${a.host_phone}`},
      
      {k:"check out",keys:["check out","d√©part","quitter","sortie"],t:a=>`<b>CHECK-OUT</b><br>Le check-out est √† ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:"eau",keys:["eau","chaude","potable","robinet","miroir","chauffe-eau"],t:a=>`<b>EAU</b><br>${a.water_note}`},
      
      {k:"climatisation",keys:["climatisation","clim","ac","air","climat","chauffage","refroidissement"],t:a=>`<b>CLIMATISATION</b><br>${a.ac_note}`},
      
      {k:"salle de bain",keys:["salle de bain","s√®che-cheveux","savon","serviettes","douche","s√©choir"],t:a=>`<b>SALLE DE BAIN</b><br>Vous trouverez : ${a.bathroom_amenities}<br><br><b>Serviettes :</b> ${a.towels_note}`},
      
      {k:"cuisine",keys:["cuisine","cuisiner","cuisini√®re","plaque","√©lectrique"],t:a=>`<b>CUISINE</b><br>${a.kitchen_note}`},
      
      {k:"terrasse",keys:["terrasse","parasol","plantes","balcon","lumi√®res","lumi√®re"],t:a=>`<b>TERRASSE</b><br>${a.terrace_note}<br><br><b>Plantes :</b> ${a.plants_note}<br><br><b>Lumi√®res :</b> ${a.lighting_note}`},
      
      {k:"services",keys:["pharmacie","h√¥pital","dab","sim","laverie","consigne","services","distributeur","carte sim","supermarch√©","courses"],t:a=>`<b>SERVICES UTILES</b><br><br><b>Supermarch√©s :</b> ${a.supermarkets}<br><br><b>Pharmacies :</b> ${a.pharmacies}<br><br><b>Distributeurs :</b> ${a.atms}<br><br><b>Laverie :</b> ${a.laundry}<br><br><b>Consigne √† bagages :</b> ${a.luggage}<br><br><b>Cartes SIM :</b> ${a.sims}`},
      
      {k:"transports",keys:["transports","tram","bus","taxi","a√©roport","train","m√©tro","se d√©placer","comment arriver"],t:a=>`<b>TRANSPORTS</b><br>${a.transport}<br><br><b>A√©roports :</b> ${a.airports}<br><br><b>Taxi :</b> ${a.taxi}`},
      
      {k:"manger",keys:["manger","restaurant","d√Æner","d√©jeuner","nourriture","o√π manger","pizzeria","trattoria"],t:a=>`<b>O√ô MANGER</b><br>${a.eat}`},
      
      {k:"boire",keys:["boire","bar","vin","cocktail","ap√©ritif","caf√©","boissons"],t:a=>`<b>O√ô BOIRE</b><br>${a.drink}`},
      
      {k:"shopping",keys:["shopping","march√©","boutiques","acheter","courses","supermarch√©","vintage"],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:"visiter",keys:["visiter","quoi voir","mus√©e","attractions","voir","monuments","tourisme","sites","mo√Øse","domus aurea"],t:a=>`<b>QUOI VISITER</b><br>${a.visit}`},
      
      {k:"tr√©sors cach√©s",keys:["cach√©s","secrets","tr√©sors","peu connus","souterrains","suburra","pudenziana"],t:a=>`<b>TR√âSORS CACH√âS</b><br>${a.hidden_gems}`},
      
      {k:"exp√©riences",keys:["exp√©riences","promenade","tour","itin√©raire","coucher de soleil","romantique","quoi faire","activit√©s"],t:a=>`<b>EXP√âRIENCES RECOMMAND√âES</b><br>${a.experiences}<br><br><b>Promenade romantique :</b> ${a.romantic_walk}`},
      
      {k:"excursions",keys:["excursions","excursion","tivoli","ostia","castelli","sortie","sorties","hors rome"],t:a=>`<b>EXCURSIONS D'UNE JOURN√âE</b><br>${a.daytrips}`},
      
      {k:"urgence",keys:["urgence","police","ambulance","pompiers","m√©decin","v√©t√©rinaire","aide","urgent","sos"],t:a=>`<b>URGENCES</b><br>${a.emergency}`},

      {
        k:"billets & √©v√©nements",
        keys:["billets","tickets","√©v√©nement","√©v√©nements","concert","concerts","match","spectacles","th√©√¢tre"],
        t:()=>`<b>BILLETS ET √âV√âNEMENTS √Ä ROME</b><br><br>‚Ä¢ <b>TicketOne</b> - concerts, th√©√¢tre, sport :<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - billets officiels :<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - billets officiels :<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:"mus√©es & sites",
        keys:["mus√©e","mus√©es","site","sites","monuments","colis√©e","vatican","forums"],
        t:()=>`<b>MUS√âES ET SITES ARCH√âOLOGIQUES</b><br><br>‚Ä¢ <b>Colis√©e, Forum Romain et Palatin :</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Mus√©es du Vatican et Chapelle Sixtine :</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Mus√©es de Rome</b> (Capitolins, Ara Pacis, etc.) :<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:"expositions",
        keys:["exposition","expositions","art","shows","temporaires","galeries"],
        t:()=>`<b>EXPOSITIONS ET SHOWS D'ART</b><br><br>‚Ä¢ <b>Musei in Comune</b> - expositions temporaires :<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale :</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Mus√©e des Arts du XXIe si√®cle :<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },

  de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button f√ºr eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button ‚Äî oder schreibe hier‚Ä¶",
      apt_label:"Apartment", 
      voice_on:"üîä Stimme: An", 
      voice_off:"üîá Stimme: Aus",
      quick:[
        "WLAN","check in","check out","Wasser","Klimaanlage","Bad","K√ºche","Terrasse",
        "Essen","Trinken","Shopping","Sehensw√ºrdigkeiten","versteckte Perlen","Erlebnisse","Tagesausfl√ºge",
        "Tickets & Events","Museen & Sites","Ausstellungen",
        "Verkehr","Services","Notfall"
      ],
      fallback:"Keine direkte Antwort gefunden. Nutze einen schnellen Button wie WLAN, Terrasse, Verkehr oder Sehensw√ºrdigkeiten.",
      fb_label:"War diese Antwort hilfreich?",
      fb_like:"üëç Like",
      fb_dislike:"üëé Dislike",
      fb_thanks:"Danke f√ºr dein Feedback!"
    },
    apt:{
      checkin_time:"15:00", 
      checkout_time:"11:00",
      wifi_note:"Der Router steht auf dem Tisch. Drehe ihn um, um SSID und Passwort auf dem Etikett zu lesen.",
      wifi_ssid:"Siehe Router-Etikett", 
      wifi_password:"Siehe Router-Etikett",
      water_note:"Leitungswasser ist trinkbar. Warmwasser ist immer verf√ºgbar. Wichtig: Schalter links am Badspiegel nicht ber√ºhren, er steuert die Warmwasseranlage.",
      ac_note:"Klimaanlage vorhanden. Bitte beim Verlassen der Wohnung ausschalten.",
      bathroom_amenities:"F√∂hn, Badematte, Toilettenpapier und Handseife.",
      towels_note:"Pro Gast: ein gro√ües, ein mittleres und ein kleines Handtuch. Betten bei Ankunft gemacht.",
      lighting_note:"K√ºchenlicht: Schalter rechts an der Treppe (zur K√ºche gewandt). Terrassenlicht: Schalter innen rechts vor dem Ausgang.",
      kitchen_note:"Voll ausgestattete K√ºche. Elektrische Kochplatte: immer nach Gebrauch ausschalten und nie T√∂pfe unbeaufsichtigt lassen.",
      terrace_note:"Wenn Sie den Terrassenschirm √∂ffnen, binden Sie ihn am Gel√§nder fest. Schlie√üen Sie ihn immer vor dem Verlassen.",
      plants_note:"Wenn Sie m√∂chten, k√∂nnen Sie die Pflanzen einmal t√§glich gie√üen, au√üer Kakteen.",
      front_door_access:"Verwenden Sie den langen Schl√ºssel mit quadratischem Ende. Ziehen Sie die T√ºr zu sich und drehen Sie gegen den Uhrzeigersinn.",
      building_code:"Haust√ºrcode (Alternative zum runden Schl√ºssel): 7171 gefolgt vom Schl√ºsselsymbol.",
      intercom_note:"16",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express in der Via Urbana. Minim√§rkte in der Via Leonina.",
      pharmacies:"Farmacia Cavour in der Via Cavour 84. Apotheke in der Via Panisperna 40.",
      atms:"BNL in der Via Cavour 84. UniCredit auf der Piazza della Suburra 5.",
      laundry:"Wash and Dry Selbstbedienungs-Waschsalon in der Via Cavour 194.",
      luggage:"Radical Storage in den Bereichen Termini und Largo Argentina mit Online-Buchung.",
      sims:"Iliad in der Via Cavour 196. TIM und Vodafone in der Via Nazionale.",
      transport:"Metro B Haltestelle Cavour etwa 5 Minuten entfernt. Busse 75, 117 und 84 in der Via Cavour. Das Monti-Viertel ist ideal zum Laufen.",
      airports:"Fiumicino: Metro B Cavour bis Termini dann Leonardo Express oder FL1 ab Trastevere. Ciampino: Bus nach Termini dann Metro B Cavour. Privattransfer verf√ºgbar mit Welcome Pickups.",
      taxi:"Radio Taxi 06 3570 oder FreeNow-App.",
      emergency:"EU-Notruf 112. Polizei 113. Rettungsdienst 118. Feuerwehr 115. Englischsprachiger Arzt 06 488 2371. 24-Stunden-Tierarzt 06 660 681.",
      eat:"La Carbonara. Ai Tre Scalini. Trattoria Vecchia Roma. Fafiuche Wine Bar. Al42 by Pasta Chef Monti. Broccoletti. Cuoco e Camicia.",
      drink:"VinoRoma. La Bottega del Caff√® auf der Piazza Madonna dei Monti. Spritzeria Monti. Blackmarket Hall.",
      shop:"Mercato Monti Vintage in der Via Leonina 46 am Wochenende. Boutiquen in der Via Urbana und Via del Boschetto. Panisperna Buchhandlung. Lederhandwerk und Design.",
      visit:"Piazza Madonna dei Monti. Santa Maria ai Monti. San Martino ai Monti. San Pietro in Vincoli mit Michelangelos Moses. Colle Oppio Park und Domus Aurea. Trajansm√§rkte und Kaiserforen.",
      hidden_gems:"Untergrund von San Martino ai Monti mit F√ºhrungen. Santa Prassede und Kapelle von San Zenone. Borgia-Treppe. Antike Suburra. R√∂mische H√§user unter Santa Pudenziana.",
      experiences:"Aperitif auf der Piazza Madonna dei Monti. Vintage-Shopping auf dem Mercato Monti. Sonnenuntergangsfotos von D√§chern oder Terrasse. Spaziergang in der Via Urbana und Via dei Serpenti. Abend entlang der Foren.",
      romantic_walk:"Empfohlene Route: Via Leonina 71, Kolosseum, Konstantinsbogen, Via dei Fori Imperiali, Aussicht vom Campidoglio, Gelato von Fatamorgana Monti, La Bottega del Caff√®, R√ºckkehr.",
      daytrips:"Ostia Antica etwa 40 Minuten. Tivoli mit Villa d'Este und Villa Adriana etwa 1 Stunde. Castelli Romani.",
      checkout_note:"Vor der Abreise: Schalten Sie Lichter und Klimaanlage aus, schlie√üen Sie die Fenster, lassen Sie die Schl√ºssel auf dem Tisch und schlie√üen Sie die T√ºr sanft."
    },
    intents:[
      {k:"WLAN",keys:["wlan","wifi","wi-fi","internet","passwort","router","netzwerk"],t:a=>`<b>WLAN</b><br>${a.wifi_note}<br><br>Netzwerk: ${a.wifi_ssid}<br>Passwort: ${a.wifi_password}`},
      
      {k:"check in",keys:["check in","ankunft","zugang","eingang","t√ºr","haust√ºr","geb√§ude","code","sprechanlage"],t:a=>`<b>CHECK-IN</b><br>Sie k√∂nnen ab ${a.checkin_time} einchecken.<br><br><b>Zugang:</b> ${a.front_door_access}<br><br><b>Haust√ºrcode:</b> ${a.building_code}<br><br><b>Sprechanlage:</b> ${a.intercom_note}<br><br>Brauchen Sie Hilfe? Rufen Sie ${a.host_phone} an`},
      
      {k:"check out",keys:["check out","abreise","verlassen","ausgang"],t:a=>`<b>CHECK-OUT</b><br>Der Check-out ist um ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:"Wasser",keys:["wasser","warmwasser","trinkbar","hahn","spiegel","boiler"],t:a=>`<b>WASSER</b><br>${a.water_note}`},
      
      {k:"Klimaanlage",keys:["klimaanlage","klima","ac","luft","klimager√§t","heizung","k√ºhlung"],t:a=>`<b>KLIMAANLAGE</b><br>${a.ac_note}`},
      
      {k:"Bad",keys:["bad","f√∂hn","seife","handt√ºcher","dusche","haartrockner"],t:a=>`<b>BADEZIMMER</b><br>Sie finden: ${a.bathroom_amenities}<br><br><b>Handt√ºcher:</b> ${a.towels_note}`},
      
      {k:"K√ºche",keys:["k√ºche","kochen","herd","kochplatte","elektrisch"],t:a=>`<b>K√úCHE</b><br>${a.kitchen_note}`},
      
      {k:"Terrasse",keys:["terrasse","schirm","pflanzen","balkon","lichter","licht"],t:a=>`<b>TERRASSE</b><br>${a.terrace_note}<br><br><b>Pflanzen:</b> ${a.plants_note}<br><br><b>Lichter:</b> ${a.lighting_note}`},
      
      {k:"Services",keys:["apotheke","krankenhaus","geldautomat","sim","w√§scherei","gep√§ck","services","atm","sim-karte","supermarkt","einkauf"],t:a=>`<b>N√úTZLICHE SERVICES</b><br><br><b>Superm√§rkte:</b> ${a.supermarkets}<br><br><b>Apotheken:</b> ${a.pharmacies}<br><br><b>Geldautomaten:</b> ${a.atms}<br><br><b>Waschsalon:</b> ${a.laundry}<br><br><b>Gep√§ckaufbewahrung:</b> ${a.luggage}<br><br><b>SIM-Karten:</b> ${a.sims}`},
      
      {k:"Verkehr",keys:["verkehr","stra√üenbahn","bus","taxi","flughafen","zug","metro","fortbewegen","wie komme ich"],t:a=>`<b>VERKEHR</b><br>${a.transport}<br><br><b>Flugh√§fen:</b> ${a.airports}<br><br><b>Taxi:</b> ${a.taxi}`},
      
      {k:"Essen",keys:["essen","restaurant","abendessen","mittagessen","nahrung","wo essen","pizzeria","trattoria"],t:a=>`<b>WO ESSEN</b><br>${a.eat}`},
      
      {k:"Trinken",keys:["trinken","bar","wein","cocktail","aperitif","kaffee","getr√§nke"],t:a=>`<b>WO TRINKEN</b><br>${a.drink}`},
      
      {k:"Shopping",keys:["shopping","markt","gesch√§fte","kaufen","einkaufen","supermarkt","boutique","vintage"],t:a=>`<b>SHOPPING</b><br>${a.shop}`},
      
      {k:"Sehensw√ºrdigkeiten",keys:["sehensw√ºrdigkeiten","was sehen","museum","attraktionen","sehen","denkm√§ler","tourismus","st√§tten","moses","domus aurea"],t:a=>`<b>WAS BESICHTIGEN</b><br>${a.visit}`},
      
      {k:"versteckte Perlen",keys:["versteckt","geheim","perlen","wenig bekannt","unterirdisch","suburra","pudenziana"],t:a=>`<b>VERSTECKTE PERLEN</b><br>${a.hidden_gems}`},
      
      {k:"Erlebnisse",keys:["erlebnisse","spaziergang","tour","route","sonnenuntergang","romantisch","was tun","aktivit√§ten"],t:a=>`<b>EMPFOHLENE ERLEBNISSE</b><br>${a.experiences}<br><br><b>Romantischer Spaziergang:</b> ${a.romantic_walk}`},
      
      {k:"Tagesausfl√ºge",keys:["tagesausfl√ºge","tagesausflug","tivoli","ostia","castelli","ausflug","ausfl√ºge","au√üerhalb rom"],t:a=>`<b>TAGESAUSFL√úGE</b><br>${a.daytrips}`},
      
      {k:"Notfall",keys:["notfall","polizei","rettungsdienst","feuerwehr","arzt","tierarzt","hilfe","dringend","sos"],t:a=>`<b>NOTF√ÑLLE</b><br>${a.emergency}`},

      {
        k:"Tickets & Events",
        keys:["tickets","events","eintrittskarten","konzert","konzerte","spiel","shows","theater"],
        t:()=>`<b>TICKETS UND VERANSTALTUNGEN IN ROM</b><br><br>‚Ä¢ <b>TicketOne</b> - Konzerte, Theater, Sport:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - offizielle Tickets:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - offizielle Tickets:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:"Museen & Sites",
        keys:["museum","museen","site","sites","denkm√§ler","kolosseum","vatikan","foren"],
        t:()=>`<b>MUSEEN UND ARCH√ÑOLOGISCHE ST√ÑTTEN</b><br><br>‚Ä¢ <b>Kolosseum, Forum Romanum und Palatin:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Vatikanische Museen und Sixtinische Kapelle:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Museen von Rom</b> (Kapitolinische, Ara Pacis, usw.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:"Ausstellungen",
        keys:["ausstellung","ausstellungen","kunst","shows","tempor√§re","galerien"],
        t:()=>`<b>AUSSTELLUNGEN UND KUNSTSHOWS</b><br><br>‚Ä¢ <b>Musei in Comune</b> - tempor√§re Ausstellungen:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museum f√ºr Kunst des 21. Jahrhunderts:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  },
  es: {
    ui:{
      welcome:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n para una respuesta r√°pida.",
      placeholder:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n ‚Äî o escribe aqu√≠‚Ä¶",
      apt_label:"Apartamento", 
      voice_on:"üîä Voz: Activada", 
      voice_off:"üîá Voz: Desactivada",
      quick:[
        "wifi","check in","check out","agua","aire acondicionado","ba√±o","cocina","terraza",
        "comer","beber","compras","visitar","joyas ocultas","experiencias","excursiones",
        "entradas y eventos","museos y sitios","exposiciones",
        "transporte","servicios","emergencia"
      ],
      fallback:"No encontr√© una respuesta directa. Prueba un bot√≥n r√°pido como wifi, terraza, transporte o visitar.",
      fb_label:"¬øTe result√≥ √∫til?",
      fb_like:"üëç Me gusta",
      fb_dislike:"üëé No me gusta",
      fb_thanks:"¬°Gracias por tu opini√≥n!"
    },
    apt:{
      checkin_time:"15:00", 
      checkout_time:"11:00",
      wifi_note:"El router est√° sobre la mesa. G√≠ralo para leer el SSID y la contrase√±a en la etiqueta.",
      wifi_ssid:"Ver etiqueta del router", 
      wifi_password:"Ver etiqueta del router",
      water_note:"El agua del grifo es potable. El agua caliente est√° siempre disponible. Importante: no toques el interruptor a la izquierda del espejo del ba√±o, controla el sistema de agua caliente.",
      ac_note:"Hay aire acondicionado. Por favor ap√°galo al salir del apartamento.",
      bathroom_amenities:"Secador de pelo, alfombrilla de ba√±o, papel higi√©nico y jab√≥n de manos.",
      towels_note:"Por hu√©sped: una toalla grande, una mediana y una peque√±a. Camas preparadas a la llegada.",
      lighting_note:"Luces cocina: interruptor a la derecha de las escaleras (mirando a la cocina). Luces terraza: interruptor interior a la derecha antes de salir.",
      kitchen_note:"Cocina totalmente equipada. Placa el√©ctrica: apagarla siempre despu√©s de usarla y nunca dejar ollas sin vigilancia.",
      terrace_note:"Si abres la sombrilla de la terraza, √°tala a la barandilla. Ci√©rrala siempre antes de salir.",
      plants_note:"Si quieres, puedes regar las plantas una vez al d√≠a, excepto los cactus.",
      front_door_access:"Usa la llave larga con punta cuadrada. Tira de la puerta hacia ti y gira en sentido antihorario.",
      building_code:"C√≥digo de la puerta del edificio (alternativa a la llave redonda): 7171 seguido del s√≠mbolo de llave.",
      intercom_note:"16",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express en Via Urbana. Minimercados en Via Leonina.",
      pharmacies:"Farmacia Cavour en Via Cavour 84. Farmacia en Via Panisperna 40.",
      atms:"BNL en Via Cavour 84. UniCredit en Piazza della Suburra 5.",
      laundry:"Lavander√≠a autoservicio Wash and Dry en Via Cavour 194.",
      luggage:"Radical Storage en las zonas de Termini y Largo Argentina con reserva online.",
      sims:"Iliad en Via Cavour 196. TIM y Vodafone en Via Nazionale.",
      transport:"Metro B parada Cavour a unos 5 minutos. Autobuses 75, 117 y 84 en Via Cavour. El barrio Monti es ideal para caminar.",
      airports:"Fiumicino: Metro B Cavour hasta Termini y luego Leonardo Express o FL1 desde Trastevere. Ciampino: autob√∫s a Termini y luego Metro B Cavour. Transfer privado disponible con Welcome Pickups.",
      taxi:"Radio Taxi 06 3570 o app FreeNow.",
      emergency:"Emergencia UE 112. Polic√≠a 113. Ambulancia 118. Bomberos 115. M√©dico que habla ingl√©s 06 488 2371. Veterinario 24 horas 06 660 681.",
      eat:"La Carbonara. Ai Tre Scalini. Trattoria Vecchia Roma. Fafiuche Wine Bar. Al42 by Pasta Chef Monti. Broccoletti. Cuoco e Camicia.",
      drink:"VinoRoma. La Bottega del Caff√® en Piazza Madonna dei Monti. Spritzeria Monti. Blackmarket Hall.",
      shop:"Mercato Monti Vintage en Via Leonina 46 los fines de semana. Boutiques en Via Urbana y Via del Boschetto. Librer√≠a Panisperna. Artesan√≠a en cuero y dise√±o.",
      visit:"Piazza Madonna dei Monti. Santa Maria ai Monti. San Martino ai Monti. San Pietro in Vincoli con el Mois√©s de Miguel √Ångel. Parque del Colle Oppio y Domus Aurea. Mercados de Trajano y Foros Imperiales.",
      hidden_gems:"Subterr√°neos de San Martino ai Monti con visitas guiadas. Santa Prassede y Capilla de San Zenone. Escalinata de los Borgia. Antigua Suburra. Casas romanas bajo Santa Pudenziana.",
      experiences:"Aperitivo en Piazza Madonna dei Monti. Compras vintage en Mercato Monti. Fotos al atardecer desde los tejados o la terraza. Paseo por Via Urbana y Via dei Serpenti. Paseo nocturno por los Foros.",
      romantic_walk:"Ruta recomendada: Via Leonina 71, Coliseo, Arco de Constantino, Via dei Fori Imperiali, vista desde el Campidoglio, helado de Fatamorgana Monti, La Bottega del Caff√®, regreso.",
      daytrips:"Ostia Antica unos 40 minutos. Tivoli con Villa d'Este y Villa Adriana aproximadamente 1 hora. Castelli Romani.",
      checkout_note:"Antes de salir: apaga las luces y el aire acondicionado, cierra las ventanas, deja las llaves en la mesa y cierra la puerta suavemente."
    },
    intents:[
      {k:"wifi",keys:["wifi","wi-fi","internet","contrase√±a","router","red"],t:a=>`<b>WI-FI</b><br>${a.wifi_note}<br><br>Red: ${a.wifi_ssid}<br>Contrase√±a: ${a.wifi_password}`},
      
      {k:"check in",keys:["check in","llegada","acceso","entrada","puerta","portal","edificio","c√≥digo","portero"],t:a=>`<b>CHECK-IN</b><br>Puedes hacer el check-in a partir de las ${a.checkin_time}.<br><br><b>Acceso:</b> ${a.front_door_access}<br><br><b>C√≥digo del portal:</b> ${a.building_code}<br><br><b>Portero autom√°tico:</b> ${a.intercom_note}<br><br>¬øNecesitas ayuda? Llama al ${a.host_phone}`},
      
      {k:"check out",keys:["check out","salida","marchar","irse"],t:a=>`<b>CHECK-OUT</b><br>El check-out es a las ${a.checkout_time}.<br><br>${a.checkout_note}`},
      
      {k:"agua",keys:["agua","caliente","potable","grifo","espejo","caldera"],t:a=>`<b>AGUA</b><br>${a.water_note}`},
      
      {k:"aire acondicionado",keys:["aire acondicionado","ac","clima","climatizador","fr√≠o","calor"],t:a=>`<b>AIRE ACONDICIONADO</b><br>${a.ac_note}`},
      
      {k:"ba√±o",keys:["ba√±o","secador","jab√≥n","toallas","ducha","secador de pelo"],t:a=>`<b>BA√ëO</b><br>Encontrar√°s: ${a.bathroom_amenities}<br><br><b>Toallas:</b> ${a.towels_note}`},
      
      {k:"cocina",keys:["cocina","cocinar","hornilla","placa","el√©ctrica"],t:a=>`<b>COCINA</b><br>${a.kitchen_note}`},
      
      {k:"terraza",keys:["terraza","sombrilla","plantas","balc√≥n","luces","luz"],t:a=>`<b>TERRAZA</b><br>${a.terrace_note}<br><br><b>Plantas:</b> ${a.plants_note}<br><br><b>Luces:</b> ${a.lighting_note}`},
      
      {k:"servicios",keys:["farmacia","hospital","cajero","sim","lavander√≠a","equipaje","servicios","atm","tarjeta sim","supermercado","compra"],t:a=>`<b>SERVICIOS √öTILES</b><br><br><b>Supermercados:</b> ${a.supermarkets}<br><br><b>Farmacias:</b> ${a.pharmacies}<br><br><b>Cajeros:</b> ${a.atms}<br><br><b>Lavander√≠a:</b> ${a.laundry}<br><br><b>Consigna de equipaje:</b> ${a.luggage}<br><br><b>Tarjetas SIM:</b> ${a.sims}`},
      
      {k:"transporte",keys:["transporte","tranv√≠a","autob√∫s","taxi","aeropuerto","tren","metro","moverse","c√≥mo llegar"],t:a=>`<b>TRANSPORTE</b><br>${a.transport}<br><br><b>Aeropuertos:</b> ${a.airports}<br><br><b>Taxi:</b> ${a.taxi}`},
      
      {k:"comer",keys:["comer","restaurante","cena","almuerzo","comida","d√≥nde comer","pizzer√≠a","trattoria"],t:a=>`<b>D√ìNDE COMER</b><br>${a.eat}`},
      
      {k:"beber",keys:["beber","bar","vino","c√≥ctel","aperitivo","caf√©","bebidas"],t:a=>`<b>D√ìNDE BEBER</b><br>${a.drink}`},
      
      {k:"compras",keys:["compras","mercado","tiendas","comprar","hacer la compra","supermercado","boutique","vintage"],t:a=>`<b>COMPRAS</b><br>${a.shop}`},
      
      {k:"visitar",keys:["visitar","qu√© ver","museo","atracciones","ver","monumentos","turismo","sitios","mois√©s","domus aurea"],t:a=>`<b>QU√â VISITAR</b><br>${a.visit}`},
      
      {k:"joyas ocultas",keys:["ocultos","secretos","joyas","poco conocidos","subterr√°neos","suburra","pudenciana"],t:a=>`<b>JOYAS OCULTAS</b><br>${a.hidden_gems}`},
      
      {k:"experiencias",keys:["experiencias","paseo","tour","itinerario","atardecer","rom√°ntico","qu√© hacer","actividades"],t:a=>`<b>EXPERIENCIAS RECOMENDADAS</b><br>${a.experiences}<br><br><b>Paseo rom√°ntico:</b> ${a.romantic_walk}`},
      
      {k:"excursiones",keys:["excursiones","excursi√≥n","tivoli","ostia","castelli","salida","salidas","fuera de roma"],t:a=>`<b>EXCURSIONES DE UN D√çA</b><br>${a.daytrips}`},
      
      {k:"emergencia",keys:["emergencia","polic√≠a","ambulancia","bomberos","m√©dico","veterinario","ayuda","urgente","sos"],t:a=>`<b>EMERGENCIAS</b><br>${a.emergency}`},

      {
        k:"entradas y eventos",
        keys:["entradas","tickets","evento","eventos","concierto","conciertos","partido","espect√°culos","teatro"],
        t:()=>`<b>ENTRADAS Y EVENTOS EN ROMA</b><br><br>‚Ä¢ <b>TicketOne</b> - conciertos, teatro, deporte:<br><a href="https://www.ticketone.it/en/" target="_blank" rel="noopener noreferrer">www.ticketone.it</a><br><br>‚Ä¢ <b>AS Roma</b> - entradas oficiales:<br><a href="https://www.asroma.com/en/tickets" target="_blank" rel="noopener noreferrer">www.asroma.com/tickets</a><br><br>‚Ä¢ <b>SS Lazio</b> - entradas oficiales:<br><a href="https://www.sslazio.it/en" target="_blank" rel="noopener noreferrer">www.sslazio.it/tickets</a>`
      },
      {
        k:"museos y sitios",
        keys:["museo","museos","sitio","sitios","monumentos","coliseo","vaticano","foros"],
        t:()=>`<b>MUSEOS Y SITIOS ARQUEOL√ìGICOS</b><br><br>‚Ä¢ <b>Coliseo, Foro Romano y Palatino:</b><br><a href="https://colosseo.it/en" target="_blank" rel="noopener noreferrer">www.colosseo.it</a><br><br>‚Ä¢ <b>Museos Vaticanos y Capilla Sixtina:</b><br><a href="https://tickets.museivaticani.va/" target="_blank" rel="noopener noreferrer">tickets.museivaticani.va</a><br><br>‚Ä¢ <b>Museos de Roma</b> (Capitolinos, Ara Pacis, etc.):<br><a href="https://www.museiincomuneroma.it/en" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it</a>`
      },
      {
        k:"exposiciones",
        keys:["exposici√≥n","exposiciones","arte","shows","temporales","galer√≠as"],
        t:()=>`<b>EXPOSICIONES Y MUESTRAS DE ARTE</b><br><br>‚Ä¢ <b>Musei in Comune</b> - exposiciones temporales:<br><a href="https://www.museiincomuneroma.it/en/exhibitions" target="_blank" rel="noopener noreferrer">www.museiincomuneroma.it/exhibitions</a><br><br>‚Ä¢ <b>Scuderie del Quirinale:</b><br><a href="https://www.scuderiequirinale.it/" target="_blank" rel="noopener noreferrer">www.scuderiequirinale.it</a><br><br>‚Ä¢ <b>MAXXI</b> - Museo de las Artes del siglo XXI:<br><a href="https://www.maxxi.art/en/" target="_blank" rel="noopener noreferrer">www.maxxi.art</a>`
      }
    ]
  }

}; /* <-- chiude const DATA */

/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang); history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:['Samantha','Google US English','Google UK English Female','Microsoft Aria Online (Natural)'],
  it:['Alice','Eloisa','Google italiano','Microsoft Elsa Online (Natural)','Microsoft Isabella Online (Natural)'],
  fr:['Amelie','Thomas','Google fran√ßais','Microsoft Denise Online (Natural)','Microsoft Vivienne Online (Natural)'],
  de:['Anna','Markus','Google Deutsch','Microsoft Katja Online (Natural)','Microsoft Conrad Online (Natural)'],
  es:['Monica','Jorge','Paulina','Google espa√±ol','Microsoft Alvaro Online (Natural)']
};
function selectVoice(){
  if(!('speechSynthesis' in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||'').toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||'').toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if('speechSynthesis' in window){ refreshVoice(); speechSynthesis.onvoiceschanged = refreshVoice; }
function warm(){
  if(!('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance('.');
    dot.volume=0.01; if(pick) dot.voice=pick; dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch{}
}
function speak(t){
  if(!voiceOn || !('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t.replace(/<[^>]+>/g,''));
    if(pick) u.voice=pick; u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch{}
}

document.getElementById('voiceBtn').addEventListener('click',e=>{
  voiceOn=!voiceOn; e.currentTarget.setAttribute('aria-pressed',String(voiceOn));
  applyUI(); if(voiceOn) warm();
});
document.querySelector('.lang').addEventListener('click',e=>{
  const btn=e.target.closest('[data-lang]'); if(!btn) return;
  lang = btn.getAttribute('data-lang');
  localStorage.setItem('lang',lang);
  const u=new URL(location.href); u.searchParams.set('lang',lang); history.replaceState(null,'',u);
  refreshVoice(); applyUI(); chatEl.innerHTML=''; welcome();
  if(voiceOn) warm();
});

function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById('aptLabel').textContent = L.apt_label;
  document.getElementById('voiceBtn').textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll('.lang [data-lang]').forEach(b=> b.setAttribute('aria-current', b.getAttribute('data-lang')===lang ? 'true':'false'));
}

/* ============ CHAT LOGIC + FEEDBACK ============ */
function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  if(type==='me'){
    d.textContent = txt;
  } else {
    d.innerHTML = txt;
  }
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
  return d;
}
  function detectIntent(text){
  const L = DATA[lang]; const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0; for(const k of it.keys){ if(t.includes(k.toLowerCase())) s++; }
    if(s>score){ score=s; best=it; }
  }
  return best;
}
function getAnswer(text){
  const L = DATA[lang]; const apt=L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic: 'fallback' };
  try{ return { text: m.t(apt), topic: m.k }; }catch{ return { text: L.ui.fallback, topic: 'fallback' }; }
}

/* --- invio feedback al Google Sheet --- */
function postFeedback(vote, topic, answerText){
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      apartment: APARTMENT_ID.toLowerCase(),
      language: lang || "en",
      topic: topic,
      answer: answerText || "",
      vote: vote
    })
  }).catch(()=>{});
}

function attachFeedbackUI(botNode, topic, answerText) {
  const L = DATA[lang].ui;
  
  const wrap = document.createElement("div");
  wrap.className = "fb-box";

  const label = document.createElement("span");
  label.className = "fb-label";
  label.textContent = L.fb_label;

  const like = document.createElement("button");
  like.textContent = L.fb_like;
  like.onclick = () => {
    like.disabled = true;
    dislike.disabled = true;
    done.style.display = "inline";
    postFeedback("like", topic, answerText);
  };

  const dislike = document.createElement("button");
  dislike.textContent = L.fb_dislike;
  dislike.onclick = () => {
    like.disabled = true;
    dislike.disabled = true;
    done.style.display = "inline";
    postFeedback("dislike", topic, answerText);
  };

  const done = document.createElement("span");
  done.className = "fb-done";
  done.textContent = L.fb_thanks;
  done.style.display = "none";

  wrap.appendChild(label);
  wrap.appendChild(like);
  wrap.appendChild(dislike);
  wrap.appendChild(done);
  botNode.appendChild(wrap);
}

function welcome(){
  const L=DATA[lang].ui;
  const intro=document.createElement('div'); intro.className='intro';
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div'); q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button'); b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}

/* --- invio messaggio --- */
function send(){
  const text=(input.value||'').trim(); 
  if(!text) return;
  add('me',text); 
  input.value='';
  const {text:bot, topic} = getAnswer(text);
  const botNode = add('wd',bot); 
  speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}

/* --- eventi --- */
sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });

applyUI(); 
welcome();
</script>
</body>
</html>
