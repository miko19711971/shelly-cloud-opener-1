<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help ‚Äî Viale Trastevere 108</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:pre-wrap}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}

/* --- Feedback UI --- */
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: VIALETRASTEVERE108</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">üîá Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>

  <main id="chat" aria-live="polite"></main>

  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>

<script>
/* === CONFIG === */
const APARTMENT_ID = "VIALETRASTEVERE108";
/* Se in futuro ridistribuisci la Web App e cambia l'URL, aggiorna qui sotto */
 const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwJcg_XcZE19sbKPmfZmkGtUqNz7U2eXqsYaTcCQi1feoTcJuYnS7DOpnEyrc3CDvQY/exec";
/* ============ CONTENUTI LOCALIZZATI ============ */
const DATA = {
  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer ‚Äî or type here‚Ä¶",
      apt_label: "Apartment",
      voice_on: "üîä Voice: On",
      voice_off: "üîá Voice: Off",
      quick: ["wifi","check in","check out","water","AC","bathroom","kitchen","building","eat","drink","shop","visit","experience","day trips","tickets & events","museums & sites","exhibitions","transport","services","emergency"],
      fallback: "I did not find a direct answer. Try a quick button (wifi, kitchen, transport, visit‚Ä¶)."
    },
    apt: {
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:'Near the TV there is a WHITE router. Turn it around to see the label with SSID & password.',
      wifi_ssid:'See router label', wifi_password:'See router label',
      water_note:'Tap water is safe to drink. Hot water is always on.',
      ac_note:'Please turn OFF the air conditioning when you leave the apartment.',
      bathroom_amenities:'Toilet paper, hand soap, bath mat, hairdryer.',
      towels_note:'Per guest: 1 large + 1 medium towel. Beds are prepared on arrival.',
      bathroom_notice:'IMPORTANT (bathroom between the bedrooms): use ONLY the toilet paper provided. Do NOT flush anything else or the system will clog and overflow. Unclogging costs ‚Ç¨100.',
      bedrooms_note:'Two bedrooms + a double sofa bed. Keys are on the table on arrival.',
      gas_steps:'Gas handle (left of the meter): DOWN = CLOSED ‚Ä¢ HORIZONTAL = OPEN. To cook: 1) choose burner, 2) push knob down and turn, 3) keep pressed a few seconds until the flame is steady, 4) release.',
      kitchen_note:'The kitchen is fully stocked and ready to use.',
      main_door_hours:'Building door accessible with the key provided.',
      concierge:'Concierge: Massimo ‚Äî desk hours 08:30‚Äì13:00 and 15:30‚Äì18:30.',
      registration_note:'Please send your passports via WhatsApp to the host for mandatory guest registration.',
      host_phone:'+39 335 5245756',
      supermarkets:'Mini-market on Viale Trastevere near 108 ‚Ä¢ Fresh produce at Largo/Piazza San Cosimato (mornings).',
      pharmacies:'Pharmacy at Piazza Trilussa ‚Ä¢ Other options along Viale Trastevere.',
      luggage:'Radical Storage ‚Äî Piazza Mastai (‚âà5 min).',
      laundry:'Self-service laundry ‚Äî Viale Trastevere 150.',
      hospital:'Ospedale Nuovo Regina Margherita ‚Äî Via Emilio Morosini 30.',
      atms:'ATMs along Viale Trastevere (BNL, Unicredit, Intesa).',
      sims:'Vodafone (Viale Trastevere 143) ‚Ä¢ TIM (Piazza San Cosimato 70).',
      transport:'Tram 8 ‚Üí Largo Argentina / Piazza Venezia. Tram 3 nearby. Bus H ‚Üí Termini. Taxi: +39 06 3570 or FreeNow app.',
      airports:'Fiumicino: Tram 8 ‚Üí Trastevere Station ‚Üí FL1 train (~45 min). Ciampino: bus to Termini then Tram 8. Private transfer: Welcome Pickups.',
      emergency:'EU Emergency 112 ‚Ä¢ Police 113 ‚Ä¢ Ambulance 118 ‚Ä¢ Fire 115 ‚Ä¢ English-speaking doctor +39 06 488 2371 ‚Ä¢ 24h vet +39 06 660 681',
      eat:'Da Enzo al 29; Osteria der Belli; Tonnarello; Trattoria Da Teo; Spirito di Vino; Pianostrada; Trapizzino.',
      drink:'Enoteca Ferrara; Freni e Frizioni; L‚ÄôAngolo Divino; Mim√¨ e Coc√≤; La Prosciutteria Trastevere.',
      shop:'Porta Portese Market (Sun); artisanal bakeries & delis along Viale Trastevere; Via della Lungaretta boutiques.',
      visit:'Santa Maria in Trastevere; Santa Cecilia; Museo di Roma in Trastevere; Orto Botanico; Villa Farnesina; Piazza Trilussa; walk over Ponte Sisto to Campo de‚Äô Fiori.',
      experiences:'Evening walk: Viale Trastevere ‚Üí Piazza Trilussa ‚Üí Santa Maria ‚Üí alleys ‚Üí Tiber waterfront ‚Üí Campo de‚Äô Fiori. Aperitivo at Freni e Frizioni; church tour (S. Maria & S. Cecilia); sunset at Gianicolo.',
      romantic_walk:'Start: Viale Trastevere 108 ‚Üí Piazza S. Maria in Trastevere ‚Üí Gianicolo Terrace ‚Üí Orto Botanico ‚Üí Gelateria del Viale ‚Üí Biscottificio Innocenti ‚Üí back to Viale Trastevere 108.',
      daytrips:'Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & Hadrian‚Äôs Villa ~1h) ‚Ä¢ Castelli Romani (villages & wine).',
      checkout_note:'Before leaving: turn off lights/AC, close windows, leave keys on the table, and lock the door.'
    },
    intents: [
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nNetwork: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrival','access','self check-in','entrance','intercom','doorbell'],t:a=>`Check-in from ${a.checkin_time}.\n${a.bedrooms_note}\n${a.registration_note}\n${a.concierge}\nNeed help? Call ${a.host_phone}.`},
      {k:'check out',keys:['check out','leave','departure'],t:a=>a.checkout_note},
      {k:'water',keys:['water','hot water','drinkable','tap'],t:a=>a.water_note},
      {k:'AC',keys:['ac','air conditioning','aircon','air'],t:a=>a.ac_note},
      {k:'bathroom',keys:['bathroom','hairdryer','soap','towels','toilet','notice'],t:a=>`Bathrooms: ${a.bathroom_amenities}\nTowels: ${a.towels_note}\n${a.bathroom_notice}`},
      {k:'kitchen',keys:['kitchen','cook','cooking','stove','gas'],t:a=>`${a.kitchen_note}\nGas use: ${a.gas_steps}`},
      {k:'building',keys:['building','elevator','door','hours','concierge'],t:a=>`Door: ${a.main_door_hours}\n${a.concierge}`},
      {k:'services',keys:['pharmacy','hospital','atm','sim','laundry','luggage','supermarket','groceries'],t:a=>`Supermarkets: ${a.supermarkets}\nPharmacies: ${a.pharmacies}\nHospital: ${a.hospital}\nATMs: ${a.atms}\nLaundry: ${a.laundry}\nLuggage storage: ${a.luggage}\nSIMs: ${a.sims}`},
      {k:'transport',keys:['transport','tram','bus','taxi','airport','train','metro'],t:a=>`${a.transport}\nAirports: ${a.airports}`},
      {k:'eat',keys:['eat','restaurant','dinner','lunch','food'],t:a=>a.eat},
      {k:'drink',keys:['drink','bar','wine','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shop',keys:['shop','market','shopping','bakeries'],t:a=>a.shop},
      {k:'visit',keys:['visit','what to visit','see','sight','attraction','museum'],t:a=>a.visit},
      {k:'experience',keys:['experience','walk','tour','itinerary','sunset','romantic'],t:a=>`${a.experiences}\nRomantic route: ${a.romantic_walk}`},
      {k:'day trips',keys:['day trip','tivoli','ostia','castelli','excursion','bracciano'],t:a=>a.daytrips},

      /* üëá NUOVI 3 INTENT in inglese */
      {
        k:'tickets & events',
        keys:['tickets','events','concert','match','roma','lazio','football','soccer'],
        t: a =>
`TICKETS & EVENTS (Rome)
‚Ä¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
‚Ä¢ AS Roma ‚Äî Official tickets: https://www.asroma.com/en/tickets
‚Ä¢ SS Lazio ‚Äî Official tickets: https://www.sslazio.it/en`
      },
      {
        k:'museums & sites',
        keys:['museums','sites','vatican','colosseum','forum','palatine','borghese'],
        t: a =>
`MUSEUMS & SITES ‚Äî ROME
‚Ä¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
‚Ä¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
‚Ä¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
      },
      {
        k:'exhibitions',
        keys:['exhibition','exhibitions','maxxi','palazzo','scuderie','art'],
        t: a =>
`EXHIBITIONS ‚Äî ROME
‚Ä¢ MAXXI ‚Äî National Museum of 21st Century Arts: https://www.maxxi.art/en/
‚Ä¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
‚Ä¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
‚Ä¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
      },

      {k:'emergency',keys:['emergency','police','ambulance','fire','doctor','vet'],t:a=>a.emergency}
    ]
  },
    it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante ‚Äî oppure scrivi qui‚Ä¶",
      apt_label:"Appartamento", voice_on:"üîä Voce: On", voice_off:"üîá Voce: Off",
      quick:["wifi","check in","check out","acqua","aria condizionata","bagno","cucina","edificio","mangiare","bere","shopping","visitare","esperienze","gite di un giorno","biglietti & eventi","musei & siti","mostre","trasporti","servizi","emergenza"],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante (wifi, cucina, trasporti, visitare‚Ä¶)."
    },
    apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:'Vicino alla TV c‚Äô√® un router BIANCO. Giralo per leggere sull‚Äôetichetta SSID e password.',
      wifi_ssid:'Vedi etichetta del router', wifi_password:'Vedi etichetta del router',
      water_note:'L‚Äôacqua del rubinetto √® potabile. L‚Äôacqua calda √® sempre attiva.',
      ac_note:'Spegni l‚Äôaria condizionata quando lasci l‚Äôappartamento.',
      bathroom_amenities:'Carta igienica, sapone mani, tappetino, asciugacapelli.',
      towels_note:'Per ospite: 1 telo grande + 1 medio. Letti pronti all‚Äôarrivo.',
      bathroom_notice:'IMPORTANTE (bagno tra le camere): usare SOLO la carta igienica fornita. NON gettare altro nel WC: si intasa e tracima. Sblocco ‚Ç¨100.',
      bedrooms_note:'Due camere da letto + divano letto matrimoniale. Le chiavi sono sul tavolo all‚Äôarrivo.',
      gas_steps:'Manopola gas (a sinistra del contatore): IN BASSO = CHIUSO ‚Ä¢ ORIZZONTALE = APERTO. Per cucinare: 1) scegli il fuoco, 2) premi e gira la manopola, 3) tieni premuto pochi secondi finch√© la fiamma √® stabile, 4) rilascia.',
      kitchen_note:'Cucina completa e pronta all‚Äôuso.',
      main_door_hours:'Portone accessibile con la chiave fornita.',
      concierge:'Portineria: Massimo ‚Äî orari 08:30‚Äì13:00 e 15:30‚Äì18:30.',
      registration_note:'Per la registrazione obbligatoria, invia i passaporti via WhatsApp all‚Äôhost.',
      host_phone:'+39 335 5245756',
      supermarkets:'Mini-market su Viale Trastevere vicino al 108 ‚Ä¢ Prodotti freschi a Largo/Piazza San Cosimato (mattina).',
      pharmacies:'Farmacia a Piazza Trilussa ‚Ä¢ Altre lungo Viale Trastevere.',
      luggage:'Radical Storage ‚Äî Piazza Mastai (‚âà5 min).',
      laundry:'Lavanderia self-service ‚Äî Viale Trastevere 150.',
      hospital:'Ospedale Nuovo Regina Margherita ‚Äî Via Emilio Morosini 30.',
      atms:'Bancomat lungo Viale Trastevere (BNL, Unicredit, Intesa).',
      sims:'Vodafone (Viale Trastevere 143) ‚Ä¢ TIM (Piazza San Cosimato 70).',
      transport:'Tram 8 ‚Üí Largo Argentina / Piazza Venezia. Tram 3 vicino. Bus H ‚Üí Termini. Taxi: +39 06 3570 o app FreeNow.',
      airports:'Fiumicino: Tram 8 ‚Üí Stazione Trastevere ‚Üí FL1 (~45 min). Ciampino: bus per Termini poi Tram 8. Transfer privato: Welcome Pickups.',
      emergency:'Emergenze UE 112 ‚Ä¢ Polizia 113 ‚Ä¢ Ambulanza 118 ‚Ä¢ Vigili del Fuoco 115 ‚Ä¢ Medico in inglese +39 06 488 2371 ‚Ä¢ Veterinario 24h +39 06 660 681',
      eat:'Da Enzo al 29; Osteria der Belli; Tonnarello; Trattoria Da Teo; Spirito di Vino; Pianostrada; Trapizzino.',
      drink:'Enoteca Ferrara; Freni e Frizioni; L‚ÄôAngolo Divino; Mim√¨ e Coc√≤; La Prosciutteria Trastevere.',
      shop:'Mercato di Porta Portese (dom); forni e gastronomie artigianali su Viale Trastevere; boutique in Via della Lungaretta.',
      visit:'Santa Maria in Trastevere; Santa Cecilia; Museo di Roma in Trastevere; Orto Botanico; Villa Farnesina; Piazza Trilussa; passeggiata su Ponte Sisto verso Campo de‚Äô Fiori.',
      experiences:'Passeggiata serale: Viale Trastevere ‚Üí Piazza Trilussa ‚Üí S. Maria ‚Üí vicoli ‚Üí Lungotevere ‚Üí Campo de‚Äô Fiori. Aperitivo da Freni e Frizioni; chiese (S. Maria & S. Cecilia); tramonto al Gianicolo.',
      romantic_walk:'Partenza: Viale Trastevere 108 ‚Üí Piazza S. Maria in Trastevere ‚Üí Terrazza del Gianicolo ‚Üí Orto Botanico ‚Üí Gelateria del Viale ‚Üí Biscottificio Innocenti ‚Üí ritorno.',
      daytrips:'Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d‚ÄôEste & Villa Adriana ~1h) ‚Ä¢ Castelli Romani.',
      checkout_note:'Prima di partire: spegni luci/AC, chiudi le finestre, lascia le chiavi sul tavolo e chiudi a chiave la porta.'
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nRete: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrivo','accesso','self check-in','ingresso','citofono','campanello'],t:a=>`Check-in dalle ${a.checkin_time}.\n${a.bedrooms_note}\n${a.registration_note}\n${a.concierge}\nServe aiuto? ${a.host_phone}.`},
      {k:'check out',keys:['check out','partenza','lasciare'],t:a=>a.checkout_note},
      {k:'acqua',keys:['acqua','acqua calda','potabile','rubinetto'],t:a=>a.water_note},
      {k:'aria condizionata',keys:['aria condizionata','clima','condizionatore','ac'],t:a=>a.ac_note},
      {k:'bagno',keys:['bagno','asciugacapelli','sapone','asciugamani','wc','avviso'],t:a=>`Bagni: ${a.bathroom_amenities}\nAsciugamani: ${a.towels_note}\n${a.bathroom_notice}`},
      {k:'cucina',keys:['cucina','cucinare','fornello','gas'],t:a=>`${a.kitchen_note}\nUso gas: ${a.gas_steps}`},
      {k:'edificio',keys:['edificio','portone','ascensore','orari','portineria'],t:a=>`Portone: ${a.main_door_hours}\n${a.concierge}`},
      {k:'servizi',keys:['farmacia','ospedale','bancomat','sim','lavanderia','bagagli','supermercato','spesa'],t:a=>`Supermercati: ${a.supermarkets}\nFarmacie: ${a.pharmacies}\nOspedale: ${a.hospital}\nBancomat: ${a.atms}\nLavanderia: ${a.laundry}\nDeposito bagagli: ${a.luggage}\nSIM: ${a.sims}`},
      {k:'trasporti',keys:['trasporti','tram','bus','taxi','aeroporto','treno','metro'],t:a=>`${a.transport}\nAeroporti: ${a.airports}`},
      {k:'mangiare',keys:['mangiare','ristorante','cena','pranzo','cibo'],t:a=>a.eat},
      {k:'bere',keys:['bere','bar','vino','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shopping',keys:['shopping','mercato','negozi','panetterie'],t:a=>a.shop},
      {k:'visitare',keys:['visitare','cosa vedere','museo','attrazioni'],t:a=>a.visit},
      {k:'esperienze',keys:['esperienze','passeggiata','tour','itinerario','tramonto','romantico'],t:a=>`${a.experiences}\nPercorso romantico: ${a.romantic_walk}`},
      {k:'gite di un giorno',keys:['gite','gita','tivoli','ostia','castelli','escursione','bracciano'],t:a=>a.daytrips},

      /* üëá NUOVI 3 INTENT, ma testo in inglese */
      {
        k:'biglietti & eventi',
        keys:['biglietti','eventi','ticket','concerti','partita','roma','lazio'],
        t: a =>
`TICKETS & EVENTS (Rome)
‚Ä¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
‚Ä¢ AS Roma ‚Äî Official tickets: https://www.asroma.com/en/tickets
‚Ä¢ SS Lazio ‚Äî Official tickets: https://www.sslazio.it/en`
      },
      {
        k:'musei & siti',
        keys:['musei','siti','museo','vaticano','colosseo','foro','palatino','borghese'],
        t: a =>
`MUSEUMS & SITES ‚Äî ROME
‚Ä¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
‚Ä¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
‚Ä¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
      },
      {
        k:'mostre',
        keys:['mostre','maxxi','palazzo','scuderie','esposizioni'],
        t: a =>
`EXHIBITIONS ‚Äî ROME
‚Ä¢ MAXXI ‚Äî National Museum of 21st Century Arts: https://www.maxxi.art/en/
‚Ä¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
‚Ä¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
‚Ä¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
      },

      {k:'emergenza',keys:['emergenza','polizia','ambulanza','fuoco','medico','veterinario'],t:a=>a.emergency}
    ]
  },

  fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une r√©ponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ‚Äî ou √©crivez ici‚Ä¶",
      apt_label:"Appartement", voice_on:"üîä Voix : Activ√©e", voice_off:"üîá Voix : D√©sactiv√©e",
      quick:["wifi","check in","check out","eau","climatisation","salle de bain","cuisine","immeuble","manger","boire","shopping","visiter","exp√©riences","excursions","billets & √©v√©nements","mus√©es & sites","expositions","transports","services","urgence"],
      fallback:"Je n‚Äôai pas trouv√© de r√©ponse directe. Essayez un bouton (wifi, cuisine, transports, visiter‚Ä¶)."
    },
    apt:{
  checkin_time:'15:00', checkout_time:'11:00',
  wifi_note:'Pr√®s de la t√©l√©vision se trouve un routeur BLANC. Retournez-le pour voir l\'√©tiquette avec le SSID et le mot de passe.',
  wifi_ssid:'Voir l\'√©tiquette du routeur', wifi_password:'Voir l\'√©tiquette du routeur',
  water_note:'L\'eau du robinet est potable. L\'eau chaude est toujours disponible.',
  ac_note:'Veuillez √©teindre la climatisation lorsque vous quittez l\'appartement.',
  bathroom_amenities:'Papier toilette, savon pour les mains, tapis de bain, s√®che-cheveux.',
  towels_note:'Par personne : 1 grande serviette + 1 moyenne. Les lits sont faits √† l\'arriv√©e.',
  bathroom_notice:'IMPORTANT (salle de bain entre les chambres) : utilisez UNIQUEMENT le papier toilette fourni. Ne jetez RIEN d\'autre dans les WC, sinon le syst√®me se bouche et d√©borde. D√©bouchage : 100 ‚Ç¨.',
  bedrooms_note:'Deux chambres + canap√©-lit double. Les cl√©s sont sur la table √† l\'arriv√©e.',
  gas_steps:'Robinet de gaz (√† gauche du compteur) : EN BAS = FERM√â ‚Ä¢ HORIZONTAL = OUVERT. Pour cuisiner : 1) choisissez le br√ªleur, 2) appuyez sur le bouton et tournez, 3) maintenez appuy√© quelques secondes jusqu\'√† ce que la flamme soit stable, 4) rel√¢chez.',
  kitchen_note:'La cuisine est enti√®rement √©quip√©e et pr√™te √† l\'emploi.',
  main_door_hours:'Porte d\'entr√©e accessible avec la cl√© fournie.',
  concierge:'Concierge : Massimo ‚Äî heures de bureau 08h30‚Äì13h00 et 15h30‚Äì18h30.',
  registration_note:'Veuillez envoyer vos passeports par WhatsApp √† l\'h√¥te pour l\'enregistrement obligatoire des r√©sidents.',
  host_phone:'+39 335 5245756',
  supermarkets:'Mini-march√© sur Viale Trastevere pr√®s du 108 ‚Ä¢ Produits frais √† Largo/Piazza San Cosimato (le matin).',
  pharmacies:'Pharmacie √† Piazza Trilussa ‚Ä¢ Autres options le long de Viale Trastevere.',
  luggage:'Radical Storage ‚Äî Piazza Mastai (‚âà5 min).',
  laundry:'Laverie automatique ‚Äî Viale Trastevere 150.',
  hospital:'Ospedale Nuovo Regina Margherita ‚Äî Via Emilio Morosini 30.',
  atms:'Distributeurs automatiques le long de Viale Trastevere (BNL, Unicredit, Intesa).',
  sims:'Vodafone (Viale Trastevere 143) ‚Ä¢ TIM (Piazza San Cosimato 70).',
  transport:'Tram 8 ‚Üí Largo Argentina / Piazza Venezia. Tram 3 √† proximit√©. Bus H ‚Üí Termini. Taxi : +39 06 3570 ou app FreeNow.',
  airports:'Fiumicino : Tram 8 ‚Üí Gare Trastevere ‚Üí FL1 (~45 min). Ciampino : bus pour Termini puis Tram 8. Transfert priv√© : Welcome Pickups.',
  emergency:'Urgences UE 112 ‚Ä¢ Police 113 ‚Ä¢ Ambulance 118 ‚Ä¢ Pompiers 115 ‚Ä¢ M√©decin anglophone +39 06 488 2371 ‚Ä¢ V√©t√©rinaire 24h +39 06 660 681',
  eat:'Da Enzo al 29; Osteria der Belli; Tonnarello; Trattoria Da Teo; Spirito di Vino; Pianostrada; Trapizzino.',
  drink:'Enoteca Ferrara; Freni e Frizioni; L\'Angolo Divino; Mim√¨ e Coc√≤; La Prosciutteria Trastevere.',
  shop:'March√© de Porta Portese (dim.) ; boulangeries et √©piceries artisanales sur Viale Trastevere ; boutiques Via della Lungaretta.',
  visit:'Santa Maria in Trastevere ; Santa Cecilia ; Museo di Roma in Trastevere ; Orto Botanico ; Villa Farnesina ; Piazza Trilussa ; promenade sur Ponte Sisto vers Campo de\' Fiori.',
  experiences:'Promenade du soir : Viale Trastevere ‚Üí Piazza Trilussa ‚Üí S. Maria ‚Üí ruelles ‚Üí bords du Tibre ‚Üí Campo de\' Fiori. Ap√©ritif chez Freni e Frizioni ; visite des √©glises (S. Maria & S. Cecilia) ; coucher de soleil au Gianicolo.',
  romantic_walk:'D√©part : Viale Trastevere 108 ‚Üí Piazza S. Maria in Trastevere ‚Üí Terrasse du Gianicolo ‚Üí Orto Botanico ‚Üí Gelateria del Viale ‚Üí Biscottificio Innocenti ‚Üí retour.',
  daytrips:'Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d\'Este & Villa Adriana ~1h) ‚Ä¢ Castelli Romani (villages et vins).',
  checkout_note:'Avant de partir : √©teignez les lumi√®res/climatisation, fermez les fen√™tres, laissez les cl√©s sur la table et verrouillez la porte.'
},

        intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','mot de passe','routeur'],t:a=>`Wi-Fi : ${a.wifi_note}\nR√©seau : ${a.wifi_ssid}. Mot de passe : ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arriv√©e','acc√®s','self check-in','entr√©e','interphone','sonnette'],t:a=>`Arriv√©e √† partir de ${a.checkin_time}.\n${a.bedrooms_note}\n${a.registration_note}\n${a.concierge}\nBesoin d‚Äôaide ? ${a.host_phone}.`},
      {k:'check out',keys:['check out','d√©part','quitter'],t:a=>a.checkout_note},
      {k:'eau',keys:['eau','chaude','potable','robinet'],t:a=>a.water_note},
      {k:'climatisation',keys:['climatisation','clim','ac'],t:a=>a.ac_note},
      {k:'salle de bain',keys:['salle de bain','sdb','serviettes','papier','s√®che-cheveux'],t:a=>`Salles de bain : ${a.bathroom_amenities}\nServiettes : ${a.towels_note}\n${a.bathroom_notice}`},
      {k:'cuisine',keys:['cuisine','cuisiner','gaz','plaques'],t:a=>`${a.kitchen_note}\nGaz : ${a.gas_steps}`},
      {k:'immeuble',keys:['immeuble','porte','horaires','concierge','ascenseur'],t:a=>`Porte : ${a.main_door_hours}\n${a.concierge}`},
      {k:'services',keys:['pharmacie','h√¥pital','dab','sim','laverie','consigne','supermarch√©'],t:a=>`Supermarch√©s : ${a.supermarkets}\nPharmacies : ${a.pharmacies}\nH√¥pital : ${a.hospital}\nDAB : ${a.atms}\nLaverie : ${a.laundry}\nConsigne : ${a.luggage}\nCartes SIM : ${a.sims}`},
      {k:'transports',keys:['transports','tram','bus','taxi','a√©roport','train','m√©tro'],t:a=>`${a.transport}\nA√©roports : ${a.airports}`},
      {k:'manger',keys:['manger','restaurant','d√Æner','d√©jeuner'],t:a=>a.eat},
      {k:'boire',keys:['boire','bar','vin','cocktail','ap√©ritif'],t:a=>a.drink},
      {k:'shopping',keys:['shopping','march√©','boutiques','boulangeries'],t:a=>a.shop},
      {k:'visiter',keys:['visiter','mus√©e','attractions','voir'],t:a=>a.visit},
      {k:'exp√©riences',keys:['exp√©riences','balade','itin√©raire','coucher de soleil','romantique'],t:a=>`${a.experiences}\nParcours romantique : ${a.romantic_walk}`},
      {k:'excursions',keys:['excursions','ostia','tivoli','castelli','journ√©e'],t:a=>a.daytrips},

      /* üëá nuovi 3, testo in inglese */
      {
        k:'billets & √©v√©nements',
        keys:['billets','√©v√©nements','concert','match','roma','lazio'],
        t: a =>
`TICKETS & EVENTS (Rome)
‚Ä¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
‚Ä¢ AS Roma ‚Äî Official tickets: https://www.asroma.com/en/tickets
‚Ä¢ SS Lazio ‚Äî Official tickets: https://www.sslazio.it/en`
      },
      {
        k:'mus√©es & sites',
        keys:['mus√©es','sites','vatican','colis√©e','forum','palatin','borghese'],
        t: a =>
`MUSEUMS & SITES ‚Äî ROME
‚Ä¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
‚Ä¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
‚Ä¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
      },
      {
        k:'expositions',
        keys:['expositions','maxxi','palais','scuderie','art'],
        t: a =>
`EXHIBITIONS ‚Äî ROME
‚Ä¢ MAXXI ‚Äî National Museum of 21st Century Arts: https://www.maxxi.art/en/
‚Ä¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
‚Ä¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
‚Ä¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
      },

      {k:'urgence',keys:['urgence','police','ambulance','pompiers','m√©decin','v√©t√©rinaire'],t:a=>a.emergency}
    ]
  },

  de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button f√ºr eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button ‚Äî oder schreibe hier‚Ä¶",
      apt_label:"Apartment", voice_on:"üîä Stimme: An", voice_off:"üîá Stimme: Aus",
      quick:["WLAN","check in","check out","Wasser","Klimaanlage","Bad","K√ºche","Geb√§ude","Essen","Trinken","Shopping","Sehensw√ºrdigkeiten","Erlebnisse","Tagesausfl√ºge","Tickets & Events","Museen & St√§tten","Ausstellungen","Verkehr","Services","Notfall"],
      fallback:"Keine direkte Antwort gefunden. Nutze einen Button (WLAN, K√ºche, Verkehr, Sehensw√ºrdigkeiten‚Ä¶)."
    },
    apt:{
  checkin_time:'15:00', checkout_time:'11:00',
  wifi_note:'Neben dem Fernseher befindet sich ein WEISSER Router. Drehen Sie ihn um, um das Etikett mit SSID und Passwort zu sehen.',
  wifi_ssid:'Siehe Router-Etikett', wifi_password:'Siehe Router-Etikett',
  water_note:'Das Leitungswasser ist trinkbar. Warmwasser ist immer verf√ºgbar.',
  ac_note:'Bitte schalten Sie die Klimaanlage aus, wenn Sie die Wohnung verlassen.',
  bathroom_amenities:'Toilettenpapier, Handseife, Badematte, Haartrockner.',
  towels_note:'Pro Gast: 1 gro√ües + 1 mittleres Handtuch. Betten sind bei Ankunft bezogen.',
  bathroom_notice:'WICHTIG (Badezimmer zwischen den Schlafzimmern): Verwenden Sie NUR das bereitgestellte Toilettenpapier. Sp√ºlen Sie NICHTS anderes hinunter, sonst verstopft das System und l√§uft √ºber. Entstopfung kostet 100 ‚Ç¨.',
  bedrooms_note:'Zwei Schlafzimmer + Doppelschlafsofa. Die Schl√ºssel liegen bei Ankunft auf dem Tisch.',
  gas_steps:'Gashahn (links vom Z√§hler): UNTEN = GESCHLOSSEN ‚Ä¢ WAAGERECHT = OFFEN. Zum Kochen: 1) Brenner w√§hlen, 2) Knopf dr√ºcken und drehen, 3) einige Sekunden gedr√ºckt halten bis die Flamme stabil ist, 4) loslassen.',
  kitchen_note:'Die K√ºche ist vollst√§ndig ausgestattet und einsatzbereit.',
  main_door_hours:'Hauseingang zug√§nglich mit dem bereitgestellten Schl√ºssel.',
  concierge:'Hausmeister: Massimo ‚Äî B√ºrozeiten 08:30‚Äì13:00 und 15:30‚Äì18:30 Uhr.',
  registration_note:'Bitte senden Sie Ihre Reisep√§sse per WhatsApp an den Gastgeber f√ºr die obligatorische G√§stemeldung.',
  host_phone:'+39 335 5245756',
  supermarkets:'Mini-Markt auf dem Viale Trastevere nahe Nr. 108 ‚Ä¢ Frische Produkte auf dem Largo/Piazza San Cosimato (morgens).',
  pharmacies:'Apotheke auf der Piazza Trilussa ‚Ä¢ Weitere entlang des Viale Trastevere.',
  luggage:'Radical Storage ‚Äî Piazza Mastai (‚âà5 Min.).',
  laundry:'SB-Waschsalon ‚Äî Viale Trastevere 150.',
  hospital:'Ospedale Nuovo Regina Margherita ‚Äî Via Emilio Morosini 30.',
  atms:'Geldautomaten entlang des Viale Trastevere (BNL, Unicredit, Intesa).',
  sims:'Vodafone (Viale Trastevere 143) ‚Ä¢ TIM (Piazza San Cosimato 70).',
  transport:'Stra√üenbahn 8 ‚Üí Largo Argentina / Piazza Venezia. Stra√üenbahn 3 in der N√§he. Bus H ‚Üí Termini. Taxi: +39 06 3570 oder FreeNow App.',
  airports:'Fiumicino: Stra√üenbahn 8 ‚Üí Bahnhof Trastevere ‚Üí FL1 (~45 Min.). Ciampino: Bus nach Termini dann Stra√üenbahn 8. Privattransfer: Welcome Pickups.',
  emergency:'EU-Notruf 112 ‚Ä¢ Polizei 113 ‚Ä¢ Krankenwagen 118 ‚Ä¢ Feuerwehr 115 ‚Ä¢ Englischsprachiger Arzt +39 06 488 2371 ‚Ä¢ 24h-Tierarzt +39 06 660 681',
  eat:'Da Enzo al 29; Osteria der Belli; Tonnarello; Trattoria Da Teo; Spirito di Vino; Pianostrada; Trapizzino.',
  drink:'Enoteca Ferrara; Freni e Frizioni; L\'Angolo Divino; Mim√¨ e Coc√≤; La Prosciutteria Trastevere.',
  shop:'Flohmarkt Porta Portese (So.) ; handwerkliche B√§ckereien und Feinkostl√§den am Viale Trastevere ; Boutiquen in der Via della Lungaretta.',
  visit:'Santa Maria in Trastevere; Santa Cecilia; Museo di Roma in Trastevere; Botanischer Garten; Villa Farnesina; Piazza Trilussa; Spaziergang √ºber Ponte Sisto zum Campo de\' Fiori.',
  experiences:'Abendspaziergang: Viale Trastevere ‚Üí Piazza Trilussa ‚Üí S. Maria ‚Üí Gassen ‚Üí Tiberufer ‚Üí Campo de\' Fiori. Aperitivo bei Freni e Frizioni; Kirchenbesichtigung (S. Maria & S. Cecilia); Sonnenuntergang auf dem Gianicolo.',
  romantic_walk:'Start: Viale Trastevere 108 ‚Üí Piazza S. Maria in Trastevere ‚Üí Gianicolo-Terrasse ‚Üí Botanischer Garten ‚Üí Gelateria del Viale ‚Üí Biscottificio Innocenti ‚Üí zur√ºck.',
  daytrips:'Ostia Antica (~40 Min.) ‚Ä¢ Tivoli (Villa d\'Este & Hadriansvilla ~1 Std.) ‚Ä¢ Castelli Romani (D√∂rfer & Wein).',
  checkout_note:'Vor der Abreise: Lichter/Klimaanlage ausschalten, Fenster schlie√üen, Schl√ºssel auf den Tisch legen und die T√ºr abschlie√üen.'
},

    intents:[
      {k:'WLAN',keys:['wlan','wifi','wi-fi','internet','passwort','router'],t:a=>`WLAN: ${a.wifi_note}\nNetz: ${a.wifi_ssid}. Passwort: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','ankunft','zugang','selbst check-in','eingang','klingel','sprechanlage'],t:a=>`Check-in ab ${a.checkin_time}.\n${a.bedrooms_note}\n${a.registration_note}\n${a.concierge}\nHilfe? ${a.host_phone}.`},
      {k:'check out',keys:['check out','abreise','verlassen'],t:a=>a.checkout_note},
      {k:'Wasser',keys:['wasser','warmwasser','trinkbar','hahn'],t:a=>a.water_note},
      {k:'Klimaanlage',keys:['klimaanlage','klima','ac'],t:a=>a.ac_note},
      {k:'Bad',keys:['bad','handt√ºcher','seife','wc','hinweis','f√∂hn'],t:a=>`B√§der: ${a.bathroom_amenities}\nHandt√ºcher: ${a.towels_note}\n${a.bathroom_notice}`},
      {k:'K√ºche',keys:['k√ºche','kochen','herd','gas'],t:a=>`${a.kitchen_note}\nGas: ${a.gas_steps}`},
      {k:'Geb√§ude',keys:['geb√§ude','t√ºr','zeiten','hausmeister','aufzug'],t:a=>`T√ºr: ${a.main_door_hours}\n${a.concierge}`},
      {k:'Services',keys:['apotheke','krankenhaus','geldautomat','sim','w√§scherei','gep√§ck','supermarkt'],t:a=>`Superm√§rkte: ${a.supermarkets}\nApotheken: ${a.pharmacies}\nKrankenhaus: ${a.hospital}\nGeldautomaten: ${a.atms}\nWaschsalon: ${a.laundry}\nGep√§ck: ${a.luggage}\nSIM: ${a.sims}`},
      {k:'Verkehr',keys:['verkehr','tram','bus','taxi','flughafen','zug','metro'],t:a=>`${a.transport}\nFlugh√§fen: ${a.airports}`},
      {k:'Essen',keys:['essen','restaurant','abendessen','mittagessen'],t:a=>a.eat},
      {k:'Trinken',keys:['trinken','bar','wein','cocktail','aperitif'],t:a=>a.drink},
      {k:'Shopping',keys:['shopping','markt','gesch√§fte','b√§ckereien'],t:a=>a.shop},
      {k:'Sehensw√ºrdigkeiten',keys:['sehensw√ºrdigkeiten','besuchen','museum','attraktionen'],t:a=>a.visit},
      {k:'Erlebnisse',keys:['erlebnisse','spaziergang','tour','route','sonnenuntergang','romantisch'],t:a=>`${a.experiences}\nRomantische Route: ${a.romantic_walk}`},
      {k:'Tagesausfl√ºge',keys:['tagesausflug','tivoli','ostia','castelli','ausflug'],t:a=>a.daytrips},

      /* üëá nuovi 3 */
      {
        k:'Tickets & Events',
        keys:['tickets','events','konzert','match','roma','lazio','fussball'],
        t: a =>
`TICKETS & EVENTS (Rome)
‚Ä¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
‚Ä¢ AS Roma ‚Äî Official tickets: https://www.asroma.com/en/tickets
‚Ä¢ SS Lazio ‚Äî Official tickets: https://www.sslazio.it/en`
      },
      {
        k:'Museen & St√§tten',
        keys:['museum','museen','st√§tten','vatican','kolosseum','forum','palatin','borghese'],
        t: a =>
`MUSEUMS & SITES ‚Äî ROME
‚Ä¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
‚Ä¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
‚Ä¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
      },
      {
        k:'Ausstellungen',
        keys:['ausstellung','ausstellungen','maxxi','palazzo','scuderie','kunst'],
        t: a =>
`EXHIBITIONS ‚Äî ROME
‚Ä¢ MAXXI ‚Äî National Museum of 21st Century Arts: https://www.maxxi.art/en/
‚Ä¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
‚Ä¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
‚Ä¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
      },

      {k:'Notfall',keys:['notfall','polizei','rettung','feuerwehr','arzt','tierarzt'],t:a=>a.emergency}
    ]
  },

  es: {
    ui:{
      welcome:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n para una respuesta r√°pida.",
      placeholder:"Hola, soy Samantha, tu gu√≠a virtual. Toca un bot√≥n ‚Äî o escribe aqu√≠‚Ä¶",
      apt_label:"Apartamento", voice_on:"üîä Voz: Activada", voice_off:"üîá Voz: Desactivada",
      quick:["wifi","check in","check out","agua","aire acondicionado","ba√±o","cocina","edificio","comer","beber","compras","visitar","experiencias","excursiones","entradas y eventos","museos y sitios","exposiciones","transporte","servicios","emergencia"],
      fallback:"No encontr√© una respuesta directa. Prueba un bot√≥n (wifi, cocina, transporte, visitar‚Ä¶)."
    },
    apt:{
  checkin_time:'15:00', checkout_time:'11:00',
  wifi_note:'Cerca del televisor hay un router BLANCO. Dalo vuelta para ver la etiqueta con el SSID y la contrase√±a.',
  wifi_ssid:'Ver etiqueta del router', wifi_password:'Ver etiqueta del router',
  water_note:'El agua del grifo es potable. El agua caliente est√° siempre disponible.',
  ac_note:'Por favor, apaga el aire acondicionado cuando salgas del apartamento.',
  bathroom_amenities:'Papel higi√©nico, jab√≥n de manos, alfombra de ba√±o, secador de pelo.',
  towels_note:'Por hu√©sped: 1 toalla grande + 1 mediana. Las camas est√°n preparadas a la llegada.',
  bathroom_notice:'IMPORTANTE (ba√±o entre los dormitorios): usa SOLO el papel higi√©nico proporcionado. NO tires nada m√°s por el inodoro o el sistema se atascar√° y rebosar√°. Desatasco: 100 ‚Ç¨.',
  bedrooms_note:'Dos dormitorios + sof√° cama doble. Las llaves est√°n sobre la mesa a la llegada.',
  gas_steps:'Llave del gas (a la izquierda del contador): ABAJO = CERRADO ‚Ä¢ HORIZONTAL = ABIERTO. Para cocinar: 1) elige el quemador, 2) pulsa el mando y gira, 3) mant√©n pulsado unos segundos hasta que la llama sea estable, 4) suelta.',
  kitchen_note:'La cocina est√° totalmente equipada y lista para usar.',
  main_door_hours:'Puerta del edificio accesible con la llave proporcionada.',
  concierge:'Conserjer√≠a: Massimo ‚Äî horario 08:30‚Äì13:00 y 15:30‚Äì18:30.',
  registration_note:'Por favor, env√≠a los pasaportes por WhatsApp al anfitri√≥n para el registro obligatorio de hu√©spedes.',
  host_phone:'+39 335 5245756',
  supermarkets:'Minimarket en Viale Trastevere cerca del 108 ‚Ä¢ Productos frescos en Largo/Piazza San Cosimato (por las ma√±anas).',
  pharmacies:'Farmacia en Piazza Trilussa ‚Ä¢ Otras opciones a lo largo de Viale Trastevere.',
  luggage:'Radical Storage ‚Äî Piazza Mastai (‚âà5 min).',
  laundry:'Lavander√≠a autoservicio ‚Äî Viale Trastevere 150.',
  hospital:'Ospedale Nuovo Regina Margherita ‚Äî Via Emilio Morosini 30.',
  atms:'Cajeros autom√°ticos a lo largo de Viale Trastevere (BNL, Unicredit, Intesa).',
  sims:'Vodafone (Viale Trastevere 143) ‚Ä¢ TIM (Piazza San Cosimato 70).',
  transport:'Tranv√≠a 8 ‚Üí Largo Argentina / Piazza Venezia. Tranv√≠a 3 cercano. Bus H ‚Üí Termini. Taxi: +39 06 3570 o app FreeNow.',
  airports:'Fiumicino: Tranv√≠a 8 ‚Üí Estaci√≥n Trastevere ‚Üí FL1 (~45 min). Ciampino: autob√∫s a Termini y luego Tranv√≠a 8. Traslado privado: Welcome Pickups.',
  emergency:'Emergencias UE 112 ‚Ä¢ Polic√≠a 113 ‚Ä¢ Ambulancia 118 ‚Ä¢ Bomberos 115 ‚Ä¢ M√©dico en ingl√©s +39 06 488 2371 ‚Ä¢ Veterinario 24h +39 06 660 681',
  eat:'Da Enzo al 29; Osteria der Belli; Tonnarello; Trattoria Da Teo; Spirito di Vino; Pianostrada; Trapizzino.',
  drink:'Enoteca Ferrara; Freni e Frizioni; L\'Angolo Divino; Mim√¨ e Coc√≤; La Prosciutteria Trastevere.',
  shop:'Mercado de Porta Portese (dom.); panader√≠as y tiendas artesanales en Viale Trastevere; boutiques en Via della Lungaretta.',
  visit:'Santa Maria in Trastevere; Santa Cecilia; Museo di Roma in Trastevere; Orto Botanico; Villa Farnesina; Piazza Trilussa; paseo por Ponte Sisto hacia Campo de\' Fiori.',
  experiences:'Paseo nocturno: Viale Trastevere ‚Üí Piazza Trilussa ‚Üí S. Maria ‚Üí callejuelas ‚Üí orilla del T√≠ber ‚Üí Campo de\' Fiori. Aperitivo en Freni e Frizioni; visita a las iglesias (S. Maria & S. Cecilia); puesta de sol en el Gianicolo.',
  romantic_walk:'Inicio: Viale Trastevere 108 ‚Üí Piazza S. Maria in Trastevere ‚Üí Terraza del Gianicolo ‚Üí Orto Botanico ‚Üí Gelateria del Viale ‚Üí Biscottificio Innocenti ‚Üí regreso.',
  daytrips:'Ostia Antica (~40 min) ‚Ä¢ Tivoli (Villa d\'Este & Villa Adriana ~1h) ‚Ä¢ Castelli Romani (pueblos y vinos).',
  checkout_note:'Antes de salir: apaga las luces/aire acondicionado, cierra las ventanas, deja las llaves sobre la mesa y cierra la puerta con llave.'
},

    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','contrase√±a','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nRed: ${a.wifi_ssid}. Contrase√±a: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','llegada','acceso','self check-in','entrada','timbre','portero'],t:a=>`Check-in desde las ${a.checkin_time}.\n${a.bedrooms_note}\n${a.registration_note}\n${a.concierge}\n¬øNecesitas ayuda? ${a.host_phone}.`},
      {k:'check out',keys:['check out','salida','marchar'],t:a=>a.checkout_note},
      {k:'agua',keys:['agua','caliente','potable','grifo'],t:a=>a.water_note},
      {k:'aire acondicionado',keys:['aire acondicionado','ac','clima'],t:a=>a.ac_note},
      {k:'ba√±o',keys:['ba√±o','toallas','jab√≥n','wc','aviso','secador'],t:a=>`Ba√±os: ${a.bathroom_amenities}\nToallas: ${a.towels_note}\n${a.bathroom_notice}`},
      {k:'cocina',keys:['cocina','cocinar','hornilla','gas'],t:a=>`${a.kitchen_note}\nUso del gas: ${a.gas_steps}`},
      {k:'edificio',keys:['edificio','puerta','horarios','conserje','ascensor'],t:a=>`${a.main_door_hours}\n${a.concierge}`},
      {k:'servicios',keys:['farmacia','hospital','cajero','sim','lavander√≠a','equipaje','supermercado'],t:a=>`Supermercados: ${a.supermarkets}\nFarmacias: ${a.pharmacies}\nHospital: ${a.hospital}\nCajeros: ${a.atms}\nLavander√≠a: ${a.laundry}\nConsigna: ${a.luggage}\nSIM: ${a.sims}`},
      {k:'transporte',keys:['transporte','tranv√≠a','bus','taxi','aeropuerto','tren','metro'],t:a=>`${a.transport}\nAeropuertos: ${a.airports}`},
      {k:'comer',keys:['comer','restaurante','cena','almuerzo'],t:a=>a.eat},
      {k:'beber',keys:['beber','bar','vino','c√≥ctel','aperitivo'],t:a=>a.drink},
      {k:'compras',keys:['compras','mercado','tiendas','panader√≠as'],t:a=>a.shop},
      {k:'visitar',keys:['visitar','museo','atracciones','ver'],t:a=>a.visit},
      {k:'experiencias',keys:['experiencias','paseo','tour','itinerario','atardecer','rom√°ntico'],t:a=>`${a.experiences}\nRuta rom√°ntica: ${a.romantic_walk}`},
      {k:'excursiones',keys:['excursi√≥n','ostia','tivoli','castelli','d√≠a'],t:a=>a.daytrips},

      /* üëá nuovi 3 */
      {
        k:'entradas y eventos',
        keys:['entradas','eventos','ticket','concierto','partido','roma','lazio'],
        t: a =>
`TICKETS & EVENTS (Rome)
‚Ä¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
‚Ä¢ AS Roma ‚Äî Official tickets: https://www.asroma.com/en/tickets
‚Ä¢ SS Lazio ‚Äî Official tickets: https://www.sslazio.it/en`
      },
      {
        k:'museos y sitios',
        keys:['museos','sitios','vaticano','coliseo','foro','palatino','borghese'],
        t: a =>
`MUSEUMS & SITES ‚Äî ROME
‚Ä¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
‚Ä¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
‚Ä¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
      },
      {
        k:'exposiciones',
        keys:['exposiciones','maxxi','palacio','scuderie','arte'],
        t: a =>
`EXHIBITIONS ‚Äî ROME
‚Ä¢ MAXXI ‚Äî National Museum of 21st Century Arts: https://www.maxxi.art/en/
‚Ä¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
‚Ä¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
‚Ä¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
      },

      {k:'emergencia',keys:['emergencia','polic√≠a','ambulancia','bomberos','m√©dico','veterinario'],t:a=>a.emergency}
    ]
  }
}; /* <-- CHIUDE const DATA */
/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang); history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:['Samantha','Google US English','Google UK English Female','Microsoft Aria Online (Natural)'],
  it:['Alice','Eloisa','Google italiano','Microsoft Elsa Online (Natural)','Microsoft Isabella Online (Natural)'],
  fr:['Amelie','Thomas','Google fran√ßais','Microsoft Denise Online (Natural)','Microsoft Vivienne Online (Natural)'],
  de:['Anna','Markus','Google Deutsch','Microsoft Katja Online (Natural)','Microsoft Conrad Online (Natural)'],
  es:['Monica','Jorge','Paulina','Google espa√±ol','Microsoft Alvaro Online (Natural)']
};
function selectVoice(){
  if(!('speechSynthesis' in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||'').toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||'').toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if('speechSynthesis' in window){ refreshVoice(); speechSynthesis.onvoiceschanged = refreshVoice; }
function warm(){
  if(!('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance('.');
    dot.volume=0.01; if(pick) dot.voice=pick; dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch{}
}
function speak(t){
  if(!voiceOn || !('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t);
    if(pick) u.voice=pick; u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch{}
}

document.getElementById('voiceBtn').addEventListener('click',e=>{
  voiceOn=!voiceOn; e.currentTarget.setAttribute('aria-pressed',String(voiceOn));
  applyUI(); if(voiceOn) warm();
});
document.querySelector('.lang').addEventListener('click',e=>{
  const btn=e.target.closest('[data-lang]'); if(!btn) return;
  lang = btn.getAttribute('data-lang');
  localStorage.setItem('lang',lang);
  const u=new URL(location.href); u.searchParams.set('lang',lang); history.replaceState(null,'',u);
  refreshVoice(); applyUI(); chatEl.innerHTML=''; welcome();
  if(voiceOn) warm();
});
function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById('aptLabel').textContent = L.apt_label;
  document.getElementById('voiceBtn').textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll('.lang [data-lang]').forEach(b=> b.setAttribute('aria-current', b.getAttribute('data-lang')===lang ? 'true':'false'));
}

/* ============ CHAT LOGIC + FEEDBACK ============ */
// --- trasforma i link in <a> cliccabili e aggiunge spazio tra le righe
function linkify(str) {
  const escaped = str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
  const withLinks = escaped.replace(
    /(https?:\/\/[^\s]+)/g,
    url => `<a href="${url}" target="_blank" rel="noopener noreferrer" style="color:#0645AD;text-decoration:underline;">${url}</a>`
  );
  return withLinks.replace(/\n/g, "<br><br>");
}

function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  d.innerHTML = linkify(txt);
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
  return d;
}
function detectIntent(text){
  const L = DATA[lang]; const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0; for(const k of it.keys){ if(t.includes(k.toLowerCase())) s++; }
    if(s>score){ score=s; best=it; }
  }
  return best;
}
function getAnswer(text){
  const L = DATA[lang]; const apt=L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic: 'fallback' };
  try{ return { text: m.t(apt), topic: m.k }; }catch{ return { text: L.ui.fallback, topic: 'fallback' }; }
}
 function postFeedback(vote, topic, answerText){
  const cleanAnswer = (answerText || "").replace(/<[^>]+>/g, '').substring(0, 100);
  
  const params = new URLSearchParams({
    apartment: APARTMENT_ID.toLowerCase(),
    language: lang || "en",
    topic: topic || "",
    answer: cleanAnswer,
    vote: vote
  });
  
  fetch(GOOGLE_SCRIPT_URL + "?" + params.toString(), {
    method: "GET"
  }).catch(()=>{});
}
function attachFeedbackUI(container, topic, answerText){
  const box = document.createElement('div');
  box.className = 'fb-box';
  const label = document.createElement('span');
  label.className = 'fb-label';
  label.textContent = 'Was this helpful?';
  const likeBtn = document.createElement('button');
  likeBtn.type='button'; likeBtn.textContent='üëç Like';
  const dislikeBtn = document.createElement('button');
  dislikeBtn.type='button'; dislikeBtn.textContent='üëé Dislike';
  const done = document.createElement('span');
  done.className='fb-done'; done.textContent='Thanks for your feedback!';
  done.style.display='none';
  function finish(v){
    likeBtn.disabled = true; dislikeBtn.disabled = true;
    likeBtn.style.opacity = 0.6; dislikeBtn.style.opacity = 0.6;
    done.style.display = 'inline';
    postFeedback(v, topic, answerText);
  }
  likeBtn.addEventListener('click', ()=>finish('like'));
  dislikeBtn.addEventListener('click', ()=>finish('dislike'));
  box.appendChild(label); box.appendChild(likeBtn); box.appendChild(dislikeBtn); box.appendChild(done);
  container.appendChild(box);
}
function welcome(){
  const L=DATA[lang].ui;
  const intro=document.createElement('div'); intro.className='intro';
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div'); q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button'); b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}
function send(){
  const text=(input.value||'').trim(); if(!text) return;
  add('me',text); input.value='';
  const {text:bot, topic} = getAnswer(text);
  const botNode = add('wd',bot); speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}
sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });
applyUI(); welcome();
</script>
</body>
</html>
