<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help â€” Viale Trastevere 108</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:pre-wrap}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
.fb-box{margin-top:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.fb-box .fb-label{font-size:12px;opacity:.7;margin-right:4px}
.fb-box button{border:1px solid #ddd;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer}
.fb-box button:active{transform:scale(0.98)}
.fb-done{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: VIALETRASTEVERE108</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false">ðŸ”‡ Voice: Off</button>
      <nav class="lang">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>

  <main id="chat"></main>

  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer â€” or type hereâ€¦" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>

<script>
const APARTMENT_ID = "VIALETRASTEVERE108";
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxt0ToaaC9TOrQMJjcWXpyL1a_FCugoVIgZpB5MFY_IsJTJGHOtloEq1sjKs_F-c7Sd/exec";

const DATA = {

en:{
  ui:{
    welcome:"Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
    placeholder:"Hi, I am Samantha, your virtual guide. Tap a button for a quick answer â€” or type hereâ€¦",
    apt_label:"Apartment",
    voice_on:"ðŸ”Š Voice: On",
    voice_off:"ðŸ”‡ Voice: Off",
    quick:["wifi","check in","check out","water","AC","bathroom","kitchen","building","eat","drink","shop","visit","experience","day trips","tickets & events","museums & sites","exhibitions","transport","services","emergency"],
    fallback:"I did not find a direct answer. Try a quick button such as wifi, kitchen, transport or visit."
  },
  apt:{
    checkin_time:"15:00",
    checkout_time:"11:00",
    wifi_note:"Near the TV there is a white router. Turn it around to read the label with SSID and password.",
    wifi_ssid:"See router label",
    wifi_password:"See router label",
    water_note:"Tap water is safe to drink. Hot water is always available.",
    ac_note:"Please remember to turn off the air conditioning when you leave the apartment.",
    bathroom_amenities:"Toilet paper, hand soap, bath mat and hairdryer.",
    towels_note:"For each guest: one large towel and one medium towel. Beds are ready on arrival.",
    bathroom_notice:"Bathroom between the bedrooms. Use only the toilet paper provided. Do not flush anything else.",
    bedrooms_note:"Two bedrooms and one double sofa bed. The keys will be on the table on arrival.",
    gas_steps:"The gas knob is on the left of the meter. Down means closed, horizontal means open. To cook, choose the burner, press and turn the knob and keep it pressed for a few seconds until the flame is stable, then release.",
    kitchen_note:"The kitchen is fully equipped and ready to use.",
    main_door_hours:"The main building door can be accessed with the provided key.",
    concierge:"Concierge service available during the day.",
    registration_note:"For mandatory registration, please send passport photos via WhatsApp to the host.",
    host_phone:"+39 335 5245756",
    supermarkets:"Mini market on Viale Trastevere near number 108. Fresh food at Largo and Piazza San Cosimato in the morning.",
    pharmacies:"Pharmacy at Piazza Trilussa and others along Viale Trastevere.",
    luggage:"Radical Storage at Piazza Mastai, about five minutes away.",
    laundry:"Self service laundry on Viale Trastevere 150.",
    hospital:"Ospedale Nuovo Regina Margherita on Via Emilio Morosini 30.",
    atms:"ATMs along Viale Trastevere from BNL, Unicredit and Intesa.",
    sims:"Vodafone on Viale Trastevere 143 and TIM at Piazza San Cosimato 70.",
    transport:"Tram 8 to Largo Argentina or Piazza Venezia. Tram 3 nearby. Bus H to Termini. Taxi available via FreeNow or by phone.",
    airports:"Fiumicino Airport: Tram 8 to Trastevere Station and FL1 train, about forty five minutes. Ciampino Airport: bus to Termini then Tram 8. Private transfer available.",
    emergency:"EU emergency number 112. Police 113. Ambulance 118. Fire brigade 115. English speaking doctor 06 488 2371. 24 hour vet 06 660 681.",
    eat:"Da Enzo al 29, Osteria der Belli, Tonnarello, Trattoria Da Teo, Spirito di Vino, Pianostrada, Trapizzino.",
    drink:"Enoteca Ferrara, Freni e Frizioni, Lâ€™Angolo Divino, MimÃ¬ e CocÃ², La Prosciutteria Trastevere.",
    shop:"Porta Portese market on Sunday, artisanal bakeries and food shops along Viale Trastevere, boutiques on Via della Lungaretta.",
    visit:"Santa Maria in Trastevere, Santa Cecilia, Museo di Roma in Trastevere, Orto Botanico, Villa Farnesina, Piazza Trilussa and the walk over Ponte Sisto to Campo deâ€™ Fiori.",
    experiences:"Evening walk through Viale Trastevere, Piazza Trilussa, Santa Maria in Trastevere, historic alleys, the river and Campo deâ€™ Fiori. Aperitivo at Freni e Frizioni and sunset at Gianicolo.",
    romantic_walk:"Start from Viale Trastevere 108, Piazza Santa Maria in Trastevere, Gianicolo Terrace, Orto Botanico, gelato nearby and return.",
    daytrips:"Ostia Antica about forty minutes, Tivoli with Villa dâ€™Este and Hadrianâ€™s Villa about one hour, Castelli Romani.",
    checkout_note:"Before leaving, turn off lights and air conditioning, close the windows, leave the keys on the table and lock the door."
  }
},

it:{
  ui:{
    welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
    placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante oppure scrivi qui.",
    apt_label:"Appartamento",
    voice_on:"ðŸ”Š Voce: On",
    voice_off:"ðŸ”‡ Voce: Off",
    quick:["wifi","check in","check out","acqua","aria condizionata","bagno","cucina","edificio","mangiare","bere","shopping","visitare","esperienze","gite di un giorno","biglietti & eventi","musei & siti","mostre","trasporti","servizi","emergenza"],
    fallback:"Non ho trovato una risposta diretta. Prova un pulsante come wifi, cucina o trasporti."
  },
  apt:{
    checkin_time:"15:00",
    checkout_time:"11:00",
    wifi_note:"Vicino alla TV câ€™Ã¨ un router bianco. Giralo per leggere sullâ€™etichetta SSID e password.",
    wifi_ssid:"Vedi etichetta del router",
    wifi_password:"Vedi etichetta del router",
    water_note:"Lâ€™acqua del rubinetto Ã¨ potabile. Lâ€™acqua calda Ã¨ sempre disponibile.",
    ac_note:"Ricordati di spegnere lâ€™aria condizionata quando lasci lâ€™appartamento.",
    bathroom_amenities:"Carta igienica, sapone per le mani, tappetino e asciugacapelli.",
    towels_note:"Per ogni ospite: un telo grande e uno medio. Letti pronti allâ€™arrivo.",
    bathroom_notice:"Bagno tra le camere. Usa solo la carta igienica fornita. Non gettare altro nel WC.",
    bedrooms_note:"Due camere da letto e un divano letto matrimoniale. Le chiavi sono sul tavolo allâ€™arrivo.",
    gas_steps:"La manopola del gas Ã¨ a sinistra del contatore. In basso indica chiuso, in orizzontale indica aperto. Per cucinare scegli il fuoco, premi e gira la manopola e tienila premuta finchÃ© la fiamma Ã¨ stabile, poi rilascia.",
    kitchen_note:"Cucina completa e pronta allâ€™uso.",
    main_door_hours:"Il portone Ã¨ accessibile con la chiave fornita.",
    concierge:"Portineria presente durante il giorno.",
    registration_note:"Per la registrazione obbligatoria invia i documenti via WhatsApp allâ€™host.",
    host_phone:"+39 335 5245756",
    supermarkets:"Mini market su Viale Trastevere vicino al numero 108. Prodotti freschi a Largo e Piazza San Cosimato al mattino.",
    pharmacies:"Farmacia a Piazza Trilussa e altre lungo Viale Trastevere.",
    luggage:"Radical Storage in Piazza Mastai a circa cinque minuti.",
    laundry:"Lavanderia self service in Viale Trastevere 150.",
    hospital:"Ospedale Nuovo Regina Margherita in Via Emilio Morosini 30.",
    atms:"Bancomat BNL, Unicredit e Intesa lungo Viale Trastevere.",
    sims:"Vodafone in Viale Trastevere 143 e TIM in Piazza San Cosimato 70.",
    transport:"Tram 8 verso Largo Argentina o Piazza Venezia. Tram 3 nelle vicinanze. Bus H per Termini. Taxi disponibili.",
    airports:"Fiumicino: Tram 8 fino a Stazione Trastevere e treno FL1. Ciampino: bus per Termini e Tram 8. Transfer privato disponibile.",
    emergency:"Emergenze UE 112. Polizia 113. Ambulanza 118. Vigili del Fuoco 115. Medico in inglese 06 488 2371. Veterinario 24 ore 06 660 681.",
    eat:"Da Enzo al 29, Osteria der Belli, Tonnarello, Trattoria Da Teo, Spirito di Vino, Pianostrada, Trapizzino.",
    drink:"Enoteca Ferrara, Freni e Frizioni, Lâ€™Angolo Divino, MimÃ¬ e CocÃ², La Prosciutteria Trastevere.",
    shop:"Mercato di Porta Portese la domenica, forni e gastronomie artigianali su Viale Trastevere, boutique in Via della Lungaretta.",
    visit:"Santa Maria in Trastevere, Santa Cecilia, Museo di Roma in Trastevere, Orto Botanico, Villa Farnesina, Piazza Trilussa e passeggiata su Ponte Sisto verso Campo deâ€™ Fiori.",
    experiences:"Passeggiata serale tra Viale Trastevere, Piazza Trilussa, Santa Maria in Trastevere, vicoli storici, Lungotevere e Campo deâ€™ Fiori. Aperitivo da Freni e Frizioni e tramonto al Gianicolo.",
    romantic_walk:"Partenza da Viale Trastevere 108, Piazza Santa Maria in Trastevere, Terrazza del Gianicolo, Orto Botanico e rientro.",
    daytrips:"Ostia Antica circa quaranta minuti, Tivoli con Villa dâ€™Este e Villa Adriana circa unâ€™ora, Castelli Romani.",
    checkout_note:"Prima di partire spegni luci e aria condizionata, chiudi le finestre, lascia le chiavi sul tavolo e chiudi a chiave la porta."
  }
},
    intents:[
    {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}
Rete: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},

    {k:'check in',keys:['check in','arrivo','accesso','self check-in','ingresso','citofono','campanello'],t:a=>`Check-in dalle ${a.checkin_time}.
${a.bedrooms_note}
${a.registration_note}
${a.concierge}
Serve aiuto? ${a.host_phone}.`},

    {k:'check out',keys:['check out','partenza','lasciare'],t:a=>a.checkout_note},

    {k:'acqua',keys:['acqua','acqua calda','potabile','rubinetto'],t:a=>a.water_note},

    {k:'aria condizionata',keys:['aria condizionata','clima','condizionatore','ac'],t:a=>a.ac_note},

    {k:'bagno',keys:['bagno','asciugacapelli','sapone','asciugamani','wc','avviso'],t:a=>`Bagno: ${a.bathroom_amenities}
Asciugamani: ${a.towels_note}
${a.bathroom_notice}`},

    {k:'cucina',keys:['cucina','cucinare','fornello','gas'],t:a=>`${a.kitchen_note}
Uso del gas: ${a.gas_steps}`},

    {k:'edificio',keys:['edificio','portone','ascensore','orari','portineria'],t:a=>`Portone: ${a.main_door_hours}
${a.concierge}`},

    {k:'servizi',keys:['farmacia','ospedale','bancomat','sim','lavanderia','bagagli','supermercato','spesa'],t:a=>`Supermercati: ${a.supermarkets}
Farmacie: ${a.pharmacies}
Ospedale: ${a.hospital}
Bancomat: ${a.atms}
Lavanderia: ${a.laundry}
Deposito bagagli: ${a.luggage}
SIM: ${a.sims}`},

    {k:'trasporti',keys:['trasporti','tram','bus','taxi','aeroporto','treno','metro'],t:a=>`${a.transport}
Aeroporti: ${a.airports}`},

    {k:'mangiare',keys:['mangiare','ristorante','cena','pranzo','cibo'],t:a=>a.eat},

    {k:'bere',keys:['bere','bar','vino','cocktail','aperitivo'],t:a=>a.drink},

    {k:'shopping',keys:['shopping','mercato','negozi','panetterie'],t:a=>a.shop},

    {k:'visitare',keys:['visitare','cosa vedere','museo','attrazioni'],t:a=>a.visit},

    {k:'esperienze',keys:['esperienze','passeggiata','tour','itinerario','tramonto','romantico'],t:a=>`${a.experiences}
Percorso romantico: ${a.romantic_walk}`},

    {k:'gite di un giorno',keys:['gite','gita','tivoli','ostia','castelli','escursione','bracciano'],t:a=>a.daytrips},

    {
      k:'biglietti & eventi',
      keys:['biglietti','eventi','ticket','concerti','partita','roma','lazio'],
      t:()=>`TICKETS & EVENTS (Rome)
â€¢ TicketOne (concerts, theatre, sports): https://www.ticketone.it/en/
â€¢ AS Roma â€” Official tickets: https://www.asroma.com/en/tickets
â€¢ SS Lazio â€” Official tickets: https://www.sslazio.it/en`
    },

    {
      k:'musei & siti',
      keys:['musei','siti','museo','vaticano','colosseo','foro','palatino','borghese'],
      t:()=>`MUSEUMS & SITES â€” ROME
â€¢ Vatican Museums: https://www.museivaticani.va/content/museivaticani/en.html
â€¢ Colosseum, Roman Forum & Palatine Hill: https://parcocolosseo.it/en/
â€¢ Galleria Borghese (reservation required): https://galleriaborghese.beniculturali.it/en/`
    },

    {
      k:'mostre',
      keys:['mostre','maxxi','palazzo','scuderie','esposizioni'],
      t:()=>`EXHIBITIONS â€” ROME
â€¢ MAXXI â€” National Museum of 21st Century Arts: https://www.maxxi.art/en/
â€¢ Palazzo delle Esposizioni: https://www.palazzoesposizioni.it/
â€¢ Scuderie del Quirinale: https://www.scuderiequirinale.it/en
â€¢ Palazzo Bonaparte (Arthemisia): https://www.arthemisia.it/en/home/`
    },

    {k:'emergenza',keys:['emergenza','polizia','ambulanza','fuoco','medico','veterinario'],t:a=>a.emergency}
  ]
},

fr:{
  ui:{
    welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une rÃ©ponse rapide.",
    placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton ou Ã©crivez ici.",
    apt_label:"Appartement",
    voice_on:"ðŸ”Š Voix : ActivÃ©e",
    voice_off:"ðŸ”‡ Voix : DÃ©sactivÃ©e",
    quick:["wifi","check in","check out","eau","climatisation","salle de bain","cuisine","immeuble","manger","boire","shopping","visiter","expÃ©riences","excursions","billets & Ã©vÃ©nements","musÃ©es & sites","expositions","transports","services","urgence"],
    fallback:"Je nâ€™ai pas trouvÃ© de rÃ©ponse directe. Essayez un bouton comme wifi, cuisine ou transports."
  },
  apt:{
    checkin_time:"15:00",
    checkout_time:"11:00",
    wifi_note:"PrÃ¨s de la tÃ©lÃ©vision se trouve un routeur blanc. Tournez-le pour lire lâ€™Ã©tiquette avec le SSID et le mot de passe.",
    wifi_ssid:"Voir lâ€™Ã©tiquette du routeur",
    wifi_password:"Voir lâ€™Ã©tiquette du routeur",
    water_note:"Lâ€™eau du robinet est potable. Lâ€™eau chaude est toujours disponible.",
    ac_note:"Merci dâ€™Ã©teindre la climatisation lorsque vous quittez lâ€™appartement.",
    bathroom_amenities:"Papier toilette, savon pour les mains, tapis de bain et sÃ¨che-cheveux.",
    towels_note:"Par personne : une grande serviette et une moyenne. Les lits sont prÃªts Ã  lâ€™arrivÃ©e.",
    bathroom_notice:"Salle de bain entre les chambres. Utilisez uniquement le papier toilette fourni. Ne jetez rien dâ€™autre dans les toilettes.",
    bedrooms_note:"Deux chambres et un canapÃ©-lit double. Les clÃ©s seront sur la table Ã  lâ€™arrivÃ©e.",
    gas_steps:"Le bouton du gaz se trouve Ã  gauche du compteur. Vers le bas signifie fermÃ©, Ã  lâ€™horizontale signifie ouvert. Pour cuisiner, choisissez le brÃ»leur, appuyez et tournez le bouton et maintenez-le quelques secondes jusquâ€™Ã  ce que la flamme soit stable, puis relÃ¢chez.",
    kitchen_note:"La cuisine est entiÃ¨rement Ã©quipÃ©e et prÃªte Ã  lâ€™usage.",
    main_door_hours:"La porte de lâ€™immeuble est accessible avec la clÃ© fournie.",
    concierge:"Service de conciergerie disponible pendant la journÃ©e.",
    registration_note:"Pour lâ€™enregistrement obligatoire, veuillez envoyer les documents via WhatsApp Ã  lâ€™hÃ´te.",
    host_phone:"+39 335 5245756",
    supermarkets:"Mini marchÃ© sur Viale Trastevere prÃ¨s du numÃ©ro 108. Produits frais Ã  Largo et Piazza San Cosimato le matin.",
    pharmacies:"Pharmacie Ã  Piazza Trilussa et autres le long de Viale Trastevere.",
    luggage:"Radical Storage Ã  Piazza Mastai, Ã  environ cinq minutes.",
    laundry:"Laverie en libre-service sur Viale Trastevere 150.",
    hospital:"HÃ´pital Nuovo Regina Margherita, Via Emilio Morosini 30.",
    atms:"Distributeurs BNL, Unicredit et Intesa le long de Viale Trastevere.",
    sims:"Vodafone sur Viale Trastevere 143 et TIM Ã  Piazza San Cosimato 70.",
    transport:"Tram 8 vers Largo Argentina ou Piazza Venezia. Tram 3 Ã  proximitÃ©. Bus H vers Termini. Taxis disponibles.",
    airports:"Fiumicino : Tram 8 jusquâ€™Ã  la gare de Trastevere puis train FL1. Ciampino : bus jusquâ€™Ã  Termini puis Tram 8. Transfert privÃ© disponible.",
    emergency:"Urgences UE 112. Police 113. Ambulance 118. Pompiers 115. MÃ©decin anglophone 06 488 2371. VÃ©tÃ©rinaire 24h 06 660 681.",
    eat:"Da Enzo al 29, Osteria der Belli, Tonnarello, Trattoria Da Teo, Spirito di Vino, Pianostrada, Trapizzino.",
    drink:"Enoteca Ferrara, Freni e Frizioni, Lâ€™Angolo Divino, MimÃ¬ e CocÃ², La Prosciutteria Trastevere.",
    shop:"MarchÃ© de Porta Portese le dimanche, boulangeries et Ã©piceries artisanales sur Viale Trastevere, boutiques sur Via della Lungaretta.",
    visit:"Santa Maria in Trastevere, Santa Cecilia, Museo di Roma in Trastevere, Orto Botanico, Villa Farnesina, Piazza Trilussa et promenade sur le Ponte Sisto vers Campo deâ€™ Fiori.",
    experiences:"Promenade en soirÃ©e entre Viale Trastevere, Piazza Trilussa, Santa Maria in Trastevere, ruelles historiques, le Tibre et Campo deâ€™ Fiori. ApÃ©ritif chez Freni e Frizioni et coucher de soleil au Gianicolo.",
    romantic_walk:"DÃ©part de Viale Trastevere 108, Piazza Santa Maria in Trastevere, terrasse du Gianicolo, Orto Botanico et retour.",
    daytrips:"Ostia Antica Ã  environ quarante minutes, Tivoli avec la Villa dâ€™Este et la Villa dâ€™Hadrien Ã  environ une heure, Castelli Romani.",
    checkout_note:"Avant de partir, Ã©teignez les lumiÃ¨res et la climatisation, fermez les fenÃªtres, laissez les clÃ©s sur la table et fermez la porte Ã  clÃ©."
  },
  intents:[
    {k:'wifi',keys:['wifi','wi-fi','internet','mot de passe','routeur'],t:a=>`Wi-Fi : ${a.wifi_note}
RÃ©seau : ${a.wifi_ssid}. Mot de passe : ${a.wifi_password}.`},

    {k:'check in',keys:['check in','arrivÃ©e','accÃ¨s','entrÃ©e','interphone','sonnette'],t:a=>`ArrivÃ©e Ã  partir de ${a.checkin_time}.
${a.bedrooms_note}
${a.registration_note}
${a.concierge}
Besoin dâ€™aide ? ${a.host_phone}.`},

    {k:'check out',keys:['check out','dÃ©part','quitter'],t:a=>a.checkout_note},

    {k:'eau',keys:['eau','chaude','potable','robinet'],t:a=>a.water_note},

    {k:'climatisation',keys:['climatisation','clim','ac'],t:a=>a.ac_note},

    {k:'salle de bain',keys:['salle de bain','serviettes','papier','sÃ¨che-cheveux'],t:a=>`Salle de bain : ${a.bathroom_amenities}
Serviettes : ${a.towels_note}
${a.bathroom_notice}`},

    {k:'cuisine',keys:['cuisine','cuisiner','gaz','plaques'],t:a=>`${a.kitchen_note}
Gaz : ${a.gas_steps}`},

    {k:'immeuble',keys:['immeuble','porte','horaires','concierge'],t:a=>`Porte : ${a.main_door_hours}
${a.concierge}`},

    {k:'services',keys:['pharmacie','hÃ´pital','dab','sim','laverie','consigne','supermarchÃ©'],t:a=>`SupermarchÃ©s : ${a.supermarkets}
Pharmacies : ${a.pharmacies}
HÃ´pital : ${a.hospital}
DAB : ${a.atms}
Laverie : ${a.laundry}
Consigne : ${a.luggage}
SIM : ${a.sims}`},

    {k:'transports',keys:['transports','tram','bus','taxi','aÃ©roport','train'],t:a=>`${a.transport}
AÃ©roports : ${a.airports}`},

    {k:'manger',keys:['manger','restaurant','dÃ®ner','dÃ©jeuner'],t:a=>a.eat},

    {k:'boire',keys:['boire','bar','vin','cocktail','apÃ©ritif'],t:a=>a.drink},

    {k:'shopping',keys:['shopping','marchÃ©','boutiques'],t:a=>a.shop},

    {k:'visiter',keys:['visiter','musÃ©e','attractions'],t:a=>a.visit},

    {k:'expÃ©riences',keys:['expÃ©riences','balade','itinÃ©raire','romantique'],t:a=>`${a.experiences}
Parcours romantique : ${a.romantic_walk}`},

    {k:'excursions',keys:['excursions','tivoli','ostia','castelli'],t:a=>a.daytrips},

    {k:'urgence',keys:['urgence','police','ambulance','pompiers','mÃ©decin','vÃ©tÃ©rinaire'],t:a=>a.emergency}
  ]
},
de:{
  ui:{
    welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button fÃ¼r eine schnelle Antwort.",
    placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button oder schreibe hier.",
    apt_label:"Apartment",
    voice_on:"ðŸ”Š Stimme: An",
    voice_off:"ðŸ”‡ Stimme: Aus",
    quick:["WLAN","check in","check out","Wasser","Klimaanlage","Bad","KÃ¼che","GebÃ¤ude","Essen","Trinken","Shopping","SehenswÃ¼rdigkeiten","Erlebnisse","TagesausflÃ¼ge","Tickets & Events","Museen & StÃ¤tten","Ausstellungen","Verkehr","Services","Notfall"],
    fallback:"Keine direkte Antwort gefunden. Nutze einen Button wie WLAN, KÃ¼che oder Verkehr."
  },
  apt:{
    checkin_time:"15:00",
    checkout_time:"11:00",
    wifi_note:"In der NÃ¤he des Fernsehers befindet sich ein weiÃŸer Router. Drehe ihn um, um SSID und Passwort auf dem Etikett zu lesen.",
    wifi_ssid:"Siehe Router-Etikett",
    wifi_password:"Siehe Router-Etikett",
    water_note:"Leitungswasser ist trinkbar. Warmwasser ist jederzeit verfÃ¼gbar.",
    ac_note:"Bitte schalte die Klimaanlage aus, wenn du die Wohnung verlÃ¤sst.",
    bathroom_amenities:"Toilettenpapier, Handseife, Badematte und Haartrockner.",
    towels_note:"Pro Gast ein groÃŸes und ein mittleres Handtuch. Betten sind bei Ankunft vorbereitet.",
    bathroom_notice:"Bad zwischen den Schlafzimmern. Bitte nur das bereitgestellte Toilettenpapier verwenden. Nichts anderes in die Toilette werfen.",
    bedrooms_note:"Zwei Schlafzimmer und ein Doppelschlafsofa. Die SchlÃ¼ssel liegen bei Ankunft auf dem Tisch.",
    gas_steps:"Der Gashebel befindet sich links vom ZÃ¤hler. Nach unten bedeutet geschlossen, waagerecht bedeutet offen. Zum Kochen Brenner wÃ¤hlen, Knopf drÃ¼cken und drehen und einige Sekunden gedrÃ¼ckt halten, bis die Flamme stabil ist, dann loslassen.",
    kitchen_note:"Die KÃ¼che ist vollstÃ¤ndig ausgestattet und einsatzbereit.",
    main_door_hours:"Die HaustÃ¼r ist mit dem bereitgestellten SchlÃ¼ssel zugÃ¤nglich.",
    concierge:"Hausmeisterservice tagsÃ¼ber verfÃ¼gbar.",
    registration_note:"FÃ¼r die gesetzlich vorgeschriebene Registrierung sende bitte die Ausweisdokumente per WhatsApp an den Host.",
    host_phone:"+39 335 5245756",
    supermarkets:"Minimarkt in der Viale Trastevere nahe Nummer 108. Frische Produkte morgens auf dem Largo und der Piazza San Cosimato.",
    pharmacies:"Apotheke an der Piazza Trilussa sowie weitere entlang der Viale Trastevere.",
    luggage:"Radical Storage an der Piazza Mastai, etwa fÃ¼nf Minuten entfernt.",
    laundry:"Selbstbedienungswaschsalon in der Viale Trastevere 150.",
    hospital:"Krankenhaus Nuovo Regina Margherita, Via Emilio Morosini 30.",
    atms:"Geldautomaten von BNL, Unicredit und Intesa entlang der Viale Trastevere.",
    sims:"Vodafone in der Viale Trastevere 143 und TIM an der Piazza San Cosimato 70.",
    transport:"StraÃŸenbahn 8 nach Largo Argentina oder Piazza Venezia. StraÃŸenbahn 3 in der NÃ¤he. Bus H nach Termini. Taxis verfÃ¼gbar.",
    airports:"Fiumicino: Tram 8 zur Station Trastevere und FL1-Zug. Ciampino: Bus nach Termini und Tram 8. Privater Transfer mÃ¶glich.",
    emergency:"EU-Notruf 112. Polizei 113. Rettungsdienst 118. Feuerwehr 115. Englischsprachiger Arzt 06 488 2371. Tierarzt 24 Stunden 06 660 681.",
    eat:"Da Enzo al 29, Osteria der Belli, Tonnarello, Trattoria Da Teo, Spirito di Vino, Pianostrada, Trapizzino.",
    drink:"Enoteca Ferrara, Freni e Frizioni, Lâ€™Angolo Divino, MimÃ¬ e CocÃ², La Prosciutteria Trastevere.",
    shop:"Porta-Portese-Markt am Sonntag, handwerkliche BÃ¤ckereien und FeinkostlÃ¤den entlang der Viale Trastevere, Boutiquen in der Via della Lungaretta.",
    visit:"Santa Maria in Trastevere, Santa Cecilia, Museo di Roma in Trastevere, Orto Botanico, Villa Farnesina, Piazza Trilussa und Spaziergang Ã¼ber die Ponte Sisto zum Campo deâ€™ Fiori.",
    experiences:"Abendlicher Spaziergang durch die Viale Trastevere, Piazza Trilussa, Santa Maria in Trastevere, historische Gassen, das Tiberufer und Campo deâ€™ Fiori. Aperitif bei Freni e Frizioni und Sonnenuntergang am Gianicolo.",
    romantic_walk:"Start an der Viale Trastevere 108, Piazza Santa Maria in Trastevere, Gianicolo-Terrasse, Orto Botanico und RÃ¼ckkehr.",
    daytrips:"Ostia Antica etwa vierzig Minuten, Tivoli mit Villa dâ€™Este und Hadriansvilla etwa eine Stunde, Castelli Romani.",
    checkout_note:"Vor der Abreise Lichter und Klimaanlage ausschalten, Fenster schlieÃŸen, SchlÃ¼ssel auf dem Tisch lassen und die TÃ¼r abschlieÃŸen."
  },
  intents:[
    {k:'WLAN',keys:['wlan','wifi','internet','passwort','router'],t:a=>`WLAN: ${a.wifi_note}
Netzwerk: ${a.wifi_ssid}. Passwort: ${a.wifi_password}.`},

    {k:'check in',keys:['check in','ankunft','zugang','eingang','klingel'],t:a=>`Check-in ab ${a.checkin_time}.
${a.bedrooms_note}
${a.registration_note}
${a.concierge}
Hilfe? ${a.host_phone}.`},

    {k:'check out',keys:['check out','abreise','verlassen'],t:a=>a.checkout_note},

    {k:'Wasser',keys:['wasser','warmwasser','trinkbar'],t:a=>a.water_note},

    {k:'Klimaanlage',keys:['klimaanlage','klima','ac'],t:a=>a.ac_note},

    {k:'Bad',keys:['bad','handtÃ¼cher','wc','hinweis'],t:a=>`Bad: ${a.bathroom_amenities}
HandtÃ¼cher: ${a.towels_note}
${a.bathroom_notice}`},

    {k:'KÃ¼che',keys:['kÃ¼che','kochen','gas','herd'],t:a=>`${a.kitchen_note}
Gas: ${a.gas_steps}`},

    {k:'GebÃ¤ude',keys:['gebÃ¤ude','tÃ¼r','hausmeister'],t:a=>`TÃ¼r: ${a.main_door_hours}
${a.concierge}`},

    {k:'Services',keys:['apotheke','krankenhaus','geldautomat','sim','wÃ¤sche','gepÃ¤ck'],t:a=>`SupermÃ¤rkte: ${a.supermarkets}
Apotheken: ${a.pharmacies}
Krankenhaus: ${a.hospital}
Geldautomaten: ${a.atms}
Waschsalon: ${a.laundry}
GepÃ¤ck: ${a.luggage}
SIM: ${a.sims}`},

    {k:'Verkehr',keys:['verkehr','tram','bus','taxi','flughafen'],t:a=>`${a.transport}
FlughÃ¤fen: ${a.airports}`},

    {k:'Essen',keys:['essen','restaurant'],t:a=>a.eat},

    {k:'Trinken',keys:['trinken','bar','wein'],t:a=>a.drink},

    {k:'Shopping',keys:['shopping','markt','geschÃ¤fte'],t:a=>a.shop},

    {k:'SehenswÃ¼rdigkeiten',keys:['sehen','besuchen','museum'],t:a=>a.visit},

    {k:'Erlebnisse',keys:['erlebnisse','spaziergang','romantisch'],t:a=>`${a.experiences}
Romantische Route: ${a.romantic_walk}`},

    {k:'TagesausflÃ¼ge',keys:['tagesausflug','tivoli','ostia'],t:a=>a.daytrips},

    {k:'Notfall',keys:['notfall','polizei','arzt','feuerwehr'],t:a=>a.emergency}
  ]
},

es:{
  ui:{
    welcome:"Hola, soy Samantha, tu guÃ­a virtual. Toca un botÃ³n para obtener una respuesta rÃ¡pida.",
    placeholder:"Hola, soy Samantha, tu guÃ­a virtual. Toca un botÃ³n o escribe aquÃ­.",
    apt_label:"Apartamento",
    voice_on:"ðŸ”Š Voz: Activada",
    voice_off:"ðŸ”‡ Voz: Desactivada",
    quick:["wifi","check in","check out","agua","aire acondicionado","baÃ±o","cocina","edificio","comer","beber","compras","visitar","experiencias","excursiones","entradas y eventos","museos y sitios","exposiciones","transporte","servicios","emergencia"],
    fallback:"No encontrÃ© una respuesta directa. Prueba un botÃ³n como wifi, cocina o transporte."
  },
  apt:{
    checkin_time:"15:00",
    checkout_time:"11:00",
    wifi_note:"Cerca del televisor hay un router blanco. GÃ­ralo para leer la etiqueta con el SSID y la contraseÃ±a.",
    wifi_ssid:"Ver etiqueta del router",
    wifi_password:"Ver etiqueta del router",
    water_note:"El agua del grifo es potable. El agua caliente estÃ¡ siempre disponible.",
    ac_note:"Por favor apaga el aire acondicionado cuando salgas del apartamento.",
    bathroom_amenities:"Papel higiÃ©nico, jabÃ³n de manos, alfombrilla y secador de pelo.",
    towels_note:"Por huÃ©sped: una toalla grande y una mediana. Las camas estÃ¡n listas a la llegada.",
    bathroom_notice:"BaÃ±o entre los dormitorios. Usa solo el papel higiÃ©nico proporcionado. No arrojes nada mÃ¡s al inodoro.",
    bedrooms_note:"Dos dormitorios y un sofÃ¡ cama doble. Las llaves estarÃ¡n sobre la mesa a la llegada.",
    gas_steps:"La perilla del gas estÃ¡ a la izquierda del contador. Abajo significa cerrado, horizontal significa abierto. Para cocinar elige el fuego, presiona y gira la perilla y mantenla presionada unos segundos hasta que la llama sea estable, luego suelta.",
    kitchen_note:"La cocina estÃ¡ completamente equipada y lista para usar.",
    main_door_hours:"La puerta del edificio es accesible con la llave proporcionada.",
    concierge:"Servicio de conserjerÃ­a disponible durante el dÃ­a.",
    registration_note:"Para el registro obligatorio, envÃ­a los documentos por WhatsApp al anfitriÃ³n.",
    host_phone:"+39 335 5245756",
    supermarkets:"Mini mercado en Viale Trastevere cerca del nÃºmero 108. Productos frescos en Largo y Piazza San Cosimato por la maÃ±ana.",
    pharmacies:"Farmacia en Piazza Trilussa y otras a lo largo de Viale Trastevere.",
    luggage:"Radical Storage en Piazza Mastai, a unos cinco minutos.",
    laundry:"LavanderÃ­a autoservicio en Viale Trastevere 150.",
    hospital:"Hospital Nuovo Regina Margherita, Via Emilio Morosini 30.",
    atms:"Cajeros BNL, Unicredit e Intesa a lo largo de Viale Trastevere.",
    sims:"Vodafone en Viale Trastevere 143 y TIM en Piazza San Cosimato 70.",
    transport:"TranvÃ­a 8 hacia Largo Argentina o Piazza Venezia. TranvÃ­a 3 cercano. AutobÃºs H hacia Termini. Taxis disponibles.",
    airports:"Fiumicino: TranvÃ­a 8 hasta la estaciÃ³n Trastevere y tren FL1. Ciampino: autobÃºs a Termini y tranvÃ­a 8. Transfer privado disponible.",
    emergency:"Emergencias UE 112. PolicÃ­a 113. Ambulancia 118. Bomberos 115. MÃ©dico en inglÃ©s 06 488 2371. Veterinario 24 horas 06 660 681.",
    eat:"Da Enzo al 29, Osteria der Belli, Tonnarello, Trattoria Da Teo, Spirito di Vino, Pianostrada, Trapizzino.",
    drink:"Enoteca Ferrara, Freni e Frizioni, Lâ€™Angolo Divino, MimÃ¬ e CocÃ², La Prosciutteria Trastevere.",
    shop:"Mercado de Porta Portese el domingo, panaderÃ­as y tiendas artesanales en Viale Trastevere, boutiques en Via della Lungaretta.",
    visit:"Santa Maria in Trastevere, Santa Cecilia, Museo di Roma in Trastevere, Orto Botanico, Villa Farnesina, Piazza Trilussa y paseo por el Ponte Sisto hasta Campo deâ€™ Fiori.",
    experiences:"Paseo nocturno por Viale Trastevere, Piazza Trilussa, Santa Maria in Trastevere, callejones histÃ³ricos, el rÃ­o TÃ­ber y Campo deâ€™ Fiori. Aperitivo en Freni e Frizioni y atardecer en el Gianicolo.",
    romantic_walk:"Salida desde Viale Trastevere 108, Piazza Santa Maria in Trastevere, terraza del Gianicolo, Orto Botanico y regreso.",
    daytrips:"Ostia Antica a unos cuarenta minutos, Tivoli con Villa dâ€™Este y Villa Adriana a una hora, Castelli Romani.",
    checkout_note:"Antes de salir apaga luces y aire acondicionado, cierra las ventanas, deja las llaves sobre la mesa y cierra la puerta con llave."
  },
  intents:[
    {k:'wifi',keys:['wifi','internet','router'],t:a=>`Wi-Fi: ${a.wifi_note}
Red: ${a.wifi_ssid}. ContraseÃ±a: ${a.wifi_password}.`},

    {k:'check in',keys:['check in','llegada','entrada'],t:a=>`Check-in desde las ${a.checkin_time}.
${a.bedrooms_note}
${a.registration_note}
${a.concierge}
Â¿Necesitas ayuda? ${a.host_phone}.`},

    {k:'check out',keys:['check out','salida'],t:a=>a.checkout_note},

    {k:'agua',keys:['agua','potable','caliente'],t:a=>a.water_note},

    {k:'aire acondicionado',keys:['aire acondicionado','ac','clima'],t:a=>a.ac_note},

    {k:'baÃ±o',keys:['baÃ±o','toallas','wc'],t:a=>`BaÃ±o: ${a.bathroom_amenities}
Toallas: ${a.towels_note}
${a.bathroom_notice}`},

    {k:'cocina',keys:['cocina','cocinar','gas'],t:a=>`${a.kitchen_note}
Uso del gas: ${a.gas_steps}`},

    {k:'edificio',keys:['edificio','puerta','conserje'],t:a=>`${a.main_door_hours}
${a.concierge}`},

    {k:'servicios',keys:['farmacia','hospital','cajero','lavanderÃ­a','equipaje'],t:a=>`Supermercados: ${a.supermarkets}
Farmacias: ${a.pharmacies}
Hospital: ${a.hospital}
Cajeros: ${a.atms}
LavanderÃ­a: ${a.laundry}
Consigna: ${a.luggage}
SIM: ${a.sims}`},

    {k:'transporte',keys:['transporte','tranvÃ­a','bus','taxi','aeropuerto'],t:a=>`${a.transport}
Aeropuertos: ${a.airports}`},

    {k:'comer',keys:['comer','restaurante'],t:a=>a.eat},

    {k:'beber',keys:['beber','bar'],t:a=>a.drink},

    {k:'compras',keys:['compras','mercado'],t:a=>a.shop},

    {k:'visitar',keys:['visitar','museo'],t:a=>a.visit},

    {k:'experiencias',keys:['experiencias','romÃ¡ntico'],t:a=>`${a.experiences}
Ruta romÃ¡ntica: ${a.romantic_walk}`},

    {k:'excursiones',keys:['excursiÃ³n','tivoli','ostia'],t:a=>a.daytrips},

    {k:'emergencia',keys:['emergencia','policÃ­a','mÃ©dico'],t:a=>a.emergency}
  ]
},
}; /* <-- CHIUDE const DATA */

/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang); history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:['Samantha','Google US English','Google UK English Female','Microsoft Aria Online (Natural)'],
  it:['Alice','Eloisa','Google italiano','Microsoft Elsa Online (Natural)','Microsoft Isabella Online (Natural)'],
  fr:['Amelie','Thomas','Google franÃ§ais','Microsoft Denise Online (Natural)','Microsoft Vivienne Online (Natural)'],
  de:['Anna','Markus','Google Deutsch','Microsoft Katja Online (Natural)','Microsoft Conrad Online (Natural)'],
  es:['Monica','Jorge','Paulina','Google espaÃ±ol','Microsoft Alvaro Online (Natural)']
};
function selectVoice(){
  if(!('speechSynthesis' in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||'').toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||'').toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if('speechSynthesis' in window){ refreshVoice(); speechSynthesis.onvoiceschanged = refreshVoice; }
function warm(){
  if(!('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance('.');
    dot.volume=0.01; if(pick) dot.voice=pick; dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch{}
}
function speak(t){
  if(!voiceOn || !('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t);
    if(pick) u.voice=pick; u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch{}
}

document.getElementById('voiceBtn').addEventListener('click',e=>{
  voiceOn=!voiceOn; e.currentTarget.setAttribute('aria-pressed',String(voiceOn));
  applyUI(); if(voiceOn) warm();
});
document.querySelector('.lang').addEventListener('click',e=>{
  const btn=e.target.closest('[data-lang]'); if(!btn) return;
  lang = btn.getAttribute('data-lang');
  localStorage.setItem('lang',lang);
  const u=new URL(location.href); u.searchParams.set('lang',lang); history.replaceState(null,'',u);
  refreshVoice(); applyUI(); chatEl.innerHTML=''; welcome();
  if(voiceOn) warm();
});
function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById('aptLabel').textContent = L.apt_label;
  document.getElementById('voiceBtn').textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll('.lang [data-lang]').forEach(b=> b.setAttribute('aria-current', b.getAttribute('data-lang')===lang ? 'true':'false'));
}

/* ============ CHAT LOGIC + FEEDBACK ============ */
function linkify(str) {
  const escaped = str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
  const withLinks = escaped.replace(
    /(https?:\/\/[^\s]+)/g,
    url => `<a href="${url}" target="_blank" rel="noopener noreferrer" style="color:#0645AD;text-decoration:underline;">${url}</a>`
  );
  return withLinks.replace(/\n/g, "<br><br>");
}

function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  d.innerHTML = linkify(txt);
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
  return d;
}
function detectIntent(text){
  const L = DATA[lang]; const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0; for(const k of it.keys){ if(t.includes(k.toLowerCase())) s++; }
    if(s>score){ score=s; best=it; }
  }
  return best;
}
function getAnswer(text){
  const L = DATA[lang]; const apt=L.apt;
  const m = detectIntent(text);
  if(!m) return { text: L.ui.fallback, topic: 'fallback' };
  try{ return { text: m.t(apt), topic: m.k }; }
  catch{ return { text: L.ui.fallback, topic: 'fallback' }; }
}
function postFeedback(vote, topic, answerText){
  try{
    fetch(GOOGLE_SCRIPT_URL, {
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        apartment_id: APARTMENT_ID,
        language: (lang||'en').toUpperCase(),
        topic: topic,
        answer_text: answerText,
        vote: vote
      })
    });
  }catch{}
}
function attachFeedbackUI(container, topic, answerText){
  const box = document.createElement('div');
  box.className = 'fb-box';
  const label = document.createElement('span');
  label.className = 'fb-label';
  label.textContent = 'Was this helpful?';
  const likeBtn = document.createElement('button');
  likeBtn.type='button'; likeBtn.textContent='ðŸ‘ Like';
  const dislikeBtn = document.createElement('button');
  dislikeBtn.type='button'; dislikeBtn.textContent='ðŸ‘Ž Dislike';
  const done = document.createElement('span');
  done.className='fb-done'; done.textContent='Thanks for your feedback!';
  done.style.display='none';
  function finish(v){
    likeBtn.disabled = true; dislikeBtn.disabled = true;
    likeBtn.style.opacity = 0.6; dislikeBtn.style.opacity = 0.6;
    done.style.display = 'inline';
    postFeedback(v, topic, answerText);
  }
  likeBtn.addEventListener('click', ()=>finish('like'));
  dislikeBtn.addEventListener('click', ()=>finish('dislike'));
  box.appendChild(label); box.appendChild(likeBtn); box.appendChild(dislikeBtn); box.appendChild(done);
  container.appendChild(box);
}
function welcome(){
  const L=DATA[lang].ui;
  const intro=document.createElement('div'); intro.className='intro';
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div'); q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button'); b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}
function send(){
  const text=(input.value||'').trim(); if(!text) return;
  add('me',text); input.value='';
  const {text:bot, topic} = getAnswer(text);
  const botNode = add('wd',bot); speak(bot);
  attachFeedbackUI(botNode, topic, bot);
}
sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });
applyUI(); welcome();
</script>
</body>
</html>
  
