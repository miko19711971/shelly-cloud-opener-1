<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Guest Help — Via del Portico d’Ottavia 1D</title>
<link rel="icon" type="image/jpeg" href="logo-niceflatinrome.jpg">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f6f6}
.wrap{max-width:760px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:10px 14px}
.h-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:10px}
.brand{font-weight:700;color:#a33}
.apt{margin-left:auto;opacity:.75}
img.logo{height:36px;width:auto;display:block}
.controls{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.lang{display:flex;gap:6px;margin-left:auto}
.lang button{border:1px solid #ddd;background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer;font-size:13px}
.lang button[aria-current="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
#voiceBtn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:10px;cursor:pointer;font-size:14px}
#voiceBtn[aria-pressed="true"]{background:#2b2118;color:#fff;border-color:#2b2118}
main{flex:1;padding:12px}
.msg{max-width:85%;line-height:1.35;border-radius:12px;padding:10px 12px;margin:8px 0;white-space:pre-wrap}
.msg.wd{background:#fff;border:1px solid #e0e0e0}
.msg.me{background:#e8f0fe;border:1px solid #c5d5ff;margin-left:auto}
.quick{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.quick button{border:1px solid #d6c5b8;background:#fff;color:#333;padding:6px 10px;border-radius:12px;cursor:pointer}
.quick button:active{transform:translateY(1px)}
footer{position:sticky;bottom:0;background:#fff;display:flex;gap:8px;padding:10px;border-top:1px solid #e0e0e0}
input{flex:1;padding:12px;border:1px solid #cbd5e1;border-radius:10px;outline:none}
#sendBtn{padding:12px 14px;border:1px solid #2b2118;background:#2b2118;color:#fff;border-radius:10px;cursor:pointer}
.intro{background:#fff;border:1px solid #e0e0e0;padding:12px;border-radius:12px;margin:12px 0}
.intro b{display:block;margin-bottom:6px}
.small{opacity:.7;font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="h-row">
      <div class="h-left">
        <img class="logo" src="logo-niceflatinrome.jpg" alt="NiceFlatInRome">
        <div class="brand">niceflatinrome.com</div>
      </div>
      <div class="apt"><span id="aptLabel">Apartment</span>: PORTICO1D</div>
    </div>
    <div class="controls">
      <button id="voiceBtn" aria-pressed="false" title="Toggle voice">🔇 Voice: Off</button>
      <nav class="lang" aria-label="Language">
        <button data-lang="en" aria-current="true">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="es">ES</button>
      </nav>
    </div>
  </header>

  <main id="chat" aria-live="polite"></main>

  <footer>
    <input id="input" placeholder="Hi, I am Samantha, your virtual guide. Tap a button for a quick answer — or type here…" autocomplete="off">
    <button id="sendBtn">Send</button>
  </footer>
</div>
<script>

/* ============ CONTENUTI LOCALIZZATI (PORTICO 1D) ============ */
const DATA = {
  en: {
    ui: {
      welcome: "Hi, I am Samantha, your virtual guide. Tap a button to get a quick answer.",
      placeholder: "Hi, I am Samantha, your virtual guide. Tap a button for a quick answer — or type here…",
      apt_label: "Apartment",
      voice_on: "🔊 Voice: On",
      voice_off: "🔇 Voice: Off",
      quick: ["wifi","check in","check out","water","AC","bathroom","kitchen","eat","drink","shop","visit","hidden gems","experience","day trips","transport","services","emergency"],
      fallback: "I did not find a direct answer. Try a quick button (wifi, transport, visit…)."
    },
    apt: {
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Look at the bed: on the right side there’s a chest bench with the router on top. SSID and password are on the label attached to the router.",
      wifi_ssid:'See router label', wifi_password:'See router label',
      water_note:'Tap water is safe to drink. Hot water is always available.',
      ac_note:'Air conditioning works via remote control. Please turn it OFF when you go out.',
      bathroom_amenities:'Toilet paper, hand soap, bath mat, hairdryer.',
      towels_note:'Per guest: 1 large + 1 medium towel. Bed is prepared on arrival.',
      kitchen_note:'Kitchen is fully equipped for your needs.',
      intercom_note:'At the building door, our unit is the third button from the bottom.',
      registration_note:'Please send photos of two identity documents via WhatsApp for guest registration (required by law).',
      host_phone:'+39 335 5245756',
      supermarkets:'Carrefour Express – Via Arenula 41 • Conad City – Via di Santa Maria del Pianto 4 • Punto Simply – Via dei Falegnami 4',
      pharmacies:'Farmacia della Reginella – Via della Reginella 25 • Farmacia Internazionale – Largo Arenula 14 (English speaking) • Farmacia San Salvatore – Piazza della Enciclopedia Italiana 53',
      luggage:'Radical Storage – Largo di Torre Argentina (5 min walk)',
      laundry:'Self-service laundry – Via Arenula 47',
      hospital:'Fatebenefratelli Hospital – Tiber Island',
      atms:'Unicredit (Largo Arenula 1) • BNL (Via Arenula 41) • Intesa (Via Arenula 27)',
      transport:"Tram 8 (stop: Arenula/Cairoli) → Trastevere or Piazza Venezia. Buses from Largo Argentina. Taxi: +39 06 3570 or use FreeNow app.",
      airports:"Fiumicino: Tram 8 → Trastevere Station → FL1 train (~45 min). Ciampino: Terravision bus or taxi. Private transfer: Welcome Pickups.",
      emergency:"EU Emergency 112 • Police 113 • Ambulance 118 • Fire 115 • English-speaking doctor +39 06 488 2371 • 24h vet +39 06 660 681",
      eat:"Giggetto al Portico d’Ottavia • Ba’Ghetto (Main & Bistrot) • Nonna Betta • Rimessa Roscioli • Il Giardino Romano • Sora Margherita • Yotvata (dairy, kosher).",
      drink:"Beppe e i Suoi Formaggi (wine & cheese) • Il Goccetto (historic wine bar) • Bar del Fico (cocktails) • Caffè del Portico • Bibliothè (tea room) • Antico Caffè del Teatro di Marcello.",
      shop:"Via del Portico d’Ottavia (artisan shops & kosher bakeries) • Forno Boccione (no sign outside) • Via Arenula boutiques • Jewish Bookstore • Kosher Delight • Fish stalls at Piazza Costaguti (mornings).",
      visit:"Portico d’Ottavia • Teatro di Marcello • Great Synagogue of Rome & Jewish Museum (closed Sat & Jewish holidays; museum usually 10:00–17:00) • Piazza Mattei (Turtle Fountain) • Tiber Island.",
      hidden_gems:"Torre dei Grassi • Ponte Emilio “Ponte Rotto” (single remaining arch) • Via della Reginella (Rome’s narrow street).",
      experiences:"Guided tours in the Jewish Ghetto • Jewish-Roman food tastings • Evening walk to Campo de’ Fiori & Piazza Navona • Photo walk through hidden squares • Bike ride around Tiber Island.",
      daytrips:"Ostia Antica (~40 min) • Tivoli (Villa d’Este & Hadrian’s Villa ~1h) • Castelli Romani (villages & wine).",
      checkout_note:"Before leaving: turn off lights/AC, close windows, leave keys on the table, gently close the door."
    },
    intents: [
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nNetwork: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrival','self check-in','access','entrance','intercom','doorbell'],t:a=>`Check-in from ${a.checkin_time}.\nIntercom: ${a.intercom_note}\nRegistration: ${a.registration_note}\nNeed help? Call ${a.host_phone}.`},
      {k:'check out',keys:['check out','leave','departure'],t:a=>a.checkout_note},
      {k:'water',keys:['water','hot water','drinkable','tap','shower'],t:a=>a.water_note},
      {k:'AC',keys:['ac','air conditioning','aircon','air conditioner'],t:a=>a.ac_note},
      {k:'bathroom',keys:['bathroom','hairdryer','towels','amenities','soap'],t:a=>`Bathroom: ${a.bathroom_amenities}\nTowels: ${a.towels_note}`},
      {k:'kitchen',keys:['kitchen','cook','cooking','stove'],t:a=>a.kitchen_note},
      {k:'services',keys:['pharmacy','hospital','atm','sim','laundry','luggage','supermarket','groceries'],t:a=>`Supermarkets: ${a.supermarkets}\nPharmacies: ${a.pharmacies}\nHospital: ${a.hospital}\nATMs: ${a.atms}\nLaundry: ${a.laundry}\nLuggage storage: ${a.luggage}`},
      {k:'transport',keys:['transport','tram','bus','taxi','airport','train','metro'],t:a=>`${a.transport}\nAirports: ${a.airports}`},
      {k:'eat',keys:['eat','restaurant','dinner','lunch','food'],t:a=>a.eat},
      {k:'drink',keys:['drink','bar','wine','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shop',keys:['shop','market','shopping','bakeries','kosher'],t:a=>a.shop},
      {k:'visit',keys:['what to visit','see','sight','attraction','museum','synagogue'],t:a=>a.visit},
      {k:'hidden gems',keys:['hidden','secret','gem','less-known','off the beaten path'],t:a=>a.hidden_gems},
      {k:'experience',keys:['experience','walk','tour','itinerary','sunset','photo'],t:a=>a.experiences},
      {k:'day trips',keys:['day trip','tivoli','ostia','castelli','excursion'],t:a=>a.daytrips},
      {k:'emergency',keys:['emergency','police','ambulance','fire','doctor','vet'],t:a=>a.emergency}
    ]
  },

  it: {
    ui:{
      welcome:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante per una risposta rapida.",
      placeholder:"Ciao, sono Samantha, la tua guida virtuale. Tocca un pulsante — oppure scrivi qui…",
      apt_label:"Appartamento", voice_on:"🔊 Voce: On", voice_off:"🔇 Voce: Off",
      quick:["wifi","check in","check out","acqua","aria condizionata","bagno","cucina","mangiare","bere","shopping","visitare","angoli nascosti","esperienze","gite di un giorno","trasporti","servizi","emergenza"],
      fallback:"Non ho trovato una risposta diretta. Prova un pulsante (wifi, trasporti, visitare…)."
    },
    apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Guarda il letto: sul lato destro c’è una panca contenitore con sopra il router. SSID e password sono sull’etichetta del router.",
      wifi_ssid:"Vedi etichetta del router", wifi_password:"Vedi etichetta del router",
      water_note:"L’acqua del rubinetto è potabile. L’acqua calda è sempre disponibile.",
      ac_note:"L’aria condizionata funziona con telecomando. Spegnila quando esci, per favore.",
      bathroom_amenities:"Carta igienica, sapone mani, tappetino, asciugacapelli.",
      towels_note:"Per ospite: 1 telo grande + 1 medio. Letto pronto all’arrivo.",
      kitchen_note:"Cucina completa e pronta all’uso.",
      intercom_note:"Al portone, il nostro interno è il terzo pulsante dal basso.",
      registration_note:"Invia per WhatsApp le foto di due documenti d’identità per la registrazione (obbligatoria).",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express – Via Arenula 41 • Conad City – Via di S. Maria del Pianto 4 • Punto Simply – Via dei Falegnami 4",
      pharmacies:"Farmacia della Reginella – Via della Reginella 25 • Farmacia Internazionale – Largo Arenula 14 (English speaking) • Farmacia San Salvatore – Piazza dell’Enciclopedia Italiana 53",
      luggage:"Radical Storage – Largo di Torre Argentina (5 min a piedi)",
      laundry:"Lavanderia self-service – Via Arenula 47",
      hospital:"Ospedale Fatebenefratelli – Isola Tiberina",
      atms:"Unicredit (Largo Arenula 1) • BNL (Via Arenula 41) • Intesa (Via Arenula 27)",
      transport:"Tram 8 (fermata Arenula/Cairoli) → Trastevere o Piazza Venezia. Autobus da Largo Argentina. Taxi: +39 06 3570 o app FreeNow.",
      airports:"Fiumicino: Tram 8 → Stazione Trastevere → treno FL1 (~45 min). Ciampino: bus Terravision o taxi. Transfer privato: Welcome Pickups.",
      emergency:"Emergenze UE 112 • Polizia 113 • Ambulanza 118 • Vigili del Fuoco 115 • Medico in inglese +39 06 488 2371 • Veterinario 24h +39 06 660 681",
      eat:"Giggetto al Portico d’Ottavia • Ba’Ghetto (Main & Bistrot) • Nonna Betta • Rimessa Roscioli • Il Giardino Romano • Sora Margherita • Yotvata (latteria kosher).",
      drink:"Beppe e i Suoi Formaggi (vino & formaggi) • Il Goccetto • Bar del Fico • Caffè del Portico • Bibliothè (tea room) • Antico Caffè del Teatro di Marcello.",
      shop:"Via del Portico d’Ottavia (artigianato & forni kosher) • Forno Boccione (senza insegna) • Boutique di Via Arenula • Libreria Ebraica • Kosher Delight • Banchi del pesce in Piazza Costaguti (mattina).",
      visit:"Portico d’Ottavia • Teatro di Marcello • Grande Sinagoga & Museo Ebraico (chiuso sabato e feste ebraiche; museo di solito 10:00–17:00) • Piazza Mattei (Fontana delle Tartarughe) • Isola Tiberina.",
      hidden_gems:"Torre dei Grassi • Ponte Emilio “Ponte Rotto” (arco superstite) • Via della Reginella (una delle vie più strette).",
      experiences:"Tour nel Ghetto • Degustazioni giudaico-romane • Passeggiata serale verso Campo de’ Fiori & Piazza Navona • Photo walk fra piazze nascoste • Giro in bici attorno all’Isola Tiberina.",
      daytrips:"Ostia Antica (~40 min) • Tivoli (Villa d’Este & Villa Adriana ~1h) • Castelli Romani.",
      checkout_note:"Prima di partire: spegni luci/AC, chiudi le finestre, lascia le chiavi sul tavolo, chiudi la porta delicatamente."
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','password','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nRete: ${a.wifi_ssid}. Password: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrivo','self check-in','accesso','ingresso','citofono','campanello'],t:a=>`Check-in dalle ${a.checkin_time}.\nCitofono: ${a.intercom_note}\nRegistrazione: ${a.registration_note}\nAiuto? Chiama ${a.host_phone}.`},
      {k:'check out',keys:['check out','partenza','lasciare'],t:a=>a.checkout_note},
      {k:'acqua',keys:['acqua','acqua calda','potabile','rubinetto','doccia'],t:a=>a.water_note},
      {k:'aria condizionata',keys:['aria condizionata','clima','condizionatore','ac'],t:a=>a.ac_note},
      {k:'bagno',keys:['bagno','asciugacapelli','asciugamani','amenities','sapone'],t:a=>`Bagno: ${a.bathroom_amenities}\nAsciugamani: ${a.towels_note}`},
      {k:'cucina',keys:['cucina','cucinare','fornelli','stufa'],t:a=>a.kitchen_note},
      {k:'servizi',keys:['farmacia','ospedale','bancomat','sim','lavanderia','bagagli','supermercato','spesa'],t:a=>`Supermercati: ${a.supermarkets}\nFarmacie: ${a.pharmacies}\nOspedale: ${a.hospital}\nBancomat: ${a.atms}\nLavanderia: ${a.laundry}\nDeposito bagagli: ${a.luggage}`},
      {k:'trasporti',keys:['trasporti','tram','bus','taxi','aeroporto','treno','metro'],t:a=>`${a.transport}\nAeroporti: ${a.airports}`},
      {k:'mangiare',keys:['mangiare','ristorante','cena','pranzo','cibo'],t:a=>a.eat},
      {k:'bere',keys:['bere','bar','vino','cocktail','aperitivo'],t:a=>a.drink},
      {k:'shopping',keys:['shopping','mercato','negozi','forni','kosher'],t:a=>a.shop},
      {k:'visitare',keys:['cosa vedere','visitare','attrazioni','museo','sinagoga'],t:a=>a.visit},
      {k:'angoli nascosti',keys:['nascosti','segreti','gioielli','meno noti','fuori percorso'],t:a=>a.hidden_gems},
      {k:'esperienze',keys:['esperienze','passeggiata','tour','itinerario','tramonto','foto'],t:a=>a.experiences},
      {k:'gite di un giorno',keys:['gite','gita','tivoli','ostia','castelli','escursione'],t:a=>a.daytrips},
      {k:'emergenza',keys:['emergenza','polizia','ambulanza','vigili','medico','veterinario'],t:a=>a.emergency}
    ]
  },

  fr: {
    ui:{
      welcome:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton pour une réponse rapide.",
      placeholder:"Bonjour, je suis Samantha, votre guide virtuel. Touchez un bouton — ou écrivez ici…",
      apt_label:"Appartement", voice_on:"🔊 Voix : Activée", voice_off:"🔇 Voix : Désactivée",
      quick:["wifi","check in","check out","eau","climatisation","salle de bain","cuisine","manger","boire","shopping","visiter","trésors cachés","expériences","excursions","transports","services","urgence"],
      fallback:"Je n’ai pas trouvé de réponse directe. Essayez un bouton (wifi, transports, visiter…)."
    },
    apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Regardez le lit : sur la droite, une banquette-coffre avec le routeur dessus. SSID et mot de passe sur l’étiquette du routeur.",
      wifi_ssid:"Voir l’étiquette du routeur", wifi_password:"Voir l’étiquette du routeur",
      water_note:"L’eau du robinet est potable. L’eau chaude est toujours disponible.",
      ac_note:"La clim fonctionne avec télécommande. Merci de l’éteindre en sortant.",
      bathroom_amenities:"Papier toilette, savon pour les mains, tapis de bain, sèche-cheveux.",
      towels_note:"Par personne : 1 grande + 1 moyenne. Lit prêt à l’arrivée.",
      kitchen_note:"Cuisine entièrement équipée, prête à l’emploi.",
      intercom_note:"À la porte de l’immeuble, notre unité est le 3ᵉ bouton en partant du bas.",
      registration_note:"Envoyez par WhatsApp les photos de deux pièces d’identité pour l’enregistrement (obligatoire).",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express – Via Arenula 41 • Conad City – Via di S. Maria del Pianto 4 • Punto Simply – Via dei Falegnami 4",
      pharmacies:"Farmacia della Reginella – Via della Reginella 25 • Farmacia Internazionale – Largo Arenula 14 (anglais) • Farmacia San Salvatore – Piazza dell’Enciclopedia Italiana 53",
      luggage:"Radical Storage – Largo di Torre Argentina (5 min à pied)",
      laundry:"Laverie en libre-service – Via Arenula 47",
      hospital:"Hôpital Fatebenefratelli – Île Tibérine",
      atms:"Unicredit (Largo Arenula 1) • BNL (Via Arenula 41) • Intesa (Via Arenula 27)",
      transport:"Tram 8 (arrêt Arenula/Cairoli) → Trastevere ou Piazza Venezia. Bus depuis Largo Argentina. Taxi : +39 06 3570 ou appli FreeNow.",
      airports:"Fiumicino : Tram 8 → gare de Trastevere → FL1 (~45 min). Ciampino : bus Terravision ou taxi. Transfert privé : Welcome Pickups.",
      emergency:"Urgences UE 112 • Police 113 • Ambulance 118 • Pompiers 115 • Médecin anglophone +39 06 488 2371 • Vétérinaire 24h +39 06 660 681",
      eat:"Giggetto al Portico d’Ottavia • Ba’Ghetto (Main & Bistrot) • Nonna Betta • Rimessa Roscioli • Il Giardino Romano • Sora Margherita • Yotvata (laitier, casher).",
      drink:"Beppe e i Suoi Formaggi (vin & fromages) • Il Goccetto (bar à vins) • Bar del Fico (cocktails) • Caffè del Portico • Bibliothè (salon de thé) • Antico Caffè del Teatro di Marcello.",
      shop:"Via del Portico d’Ottavia (artisanat & boulangeries casher) • Forno Boccione (sans enseigne) • Boutiques de Via Arenula • Librairie juive • Kosher Delight • Poissonniers Piazza Costaguti (matin).",
      visit:"Portique d’Octavie • Théâtre de Marcellus • Grande Synagogue & Musée Juif de Rome (fermé samedi & fêtes juives ; musée souvent 10:00–17:00) • Piazza Mattei (Fontaine des Tortues) • Île Tibérine.",
      hidden_gems:"Torre dei Grassi • Ponte Emilio « Ponte Rotto » (arche restante) • Via della Reginella (ruelle très étroite).",
      experiences:"Visites guidées du Ghetto • Dégustations judéo-romaines • Balade du soir vers Campo de’ Fiori & Piazza Navona • Photo walk dans les places cachées • Tour à vélo autour de l’Île Tibérine.",
      daytrips:"Ostia Antica (~40 min) • Tivoli (Villa d’Este & d’Hadrien ~1h) • Castelli Romani.",
      checkout_note:"Avant de partir : éteignez lumières/clim, fermez les fenêtres, laissez les clés sur la table, fermez la porte délicatement."
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','mot de passe','routeur'],t:a=>`Wi-Fi : ${a.wifi_note}\nRéseau : ${a.wifi_ssid}. Mot de passe : ${a.wifi_password}.`},
      {k:'check in',keys:['check in','arrivée','accès','self check-in','entrée','interphone','sonnette'],t:a=>`Arrivée à partir de ${a.checkin_time}.\nInterphone : ${a.intercom_note}\nEnregistrement : ${a.registration_note}\nBesoin d’aide ? ${a.host_phone}.`},
      {k:'check out',keys:['check out','départ','quitter'],t:a=>a.checkout_note},
      {k:'eau',keys:['eau','chaude','potable','robinet','douche'],t:a=>a.water_note},
      {k:'climatisation',keys:['climatisation','clim','ac'],t:a=>a.ac_note},
      {k:'salle de bain',keys:['salle de bain','serviettes','savon','sèche-cheveux','commodités'],t:a=>`Salle de bain : ${a.bathroom_amenities}\nServiettes : ${a.towels_note}`},
      {k:'cuisine',keys:['cuisine','cuisiner','plaques','four'],t:a=>a.kitchen_note},
      {k:'services',keys:['pharmacie','hôpital','dab','sim','laverie','consigne','supermarché','courses'],t:a=>`Supermarchés : ${a.supermarkets}\nPharmacies : ${a.pharmacies}\nHôpital : ${a.hospital}\nDAB : ${a.atms}\nLaverie : ${a.laundry}\nConsigne : ${a.luggage}`},
      {k:'transports',keys:['transports','tram','bus','taxi','aéroport','train','métro'],t:a=>`${a.transport}\nAéroports : ${a.airports}`},
      {k:'manger',keys:['manger','restaurant','dîner','déjeuner'],t:a=>a.eat},
      {k:'boire',keys:['boire','bar','vin','cocktail','apéritif'],t:a=>a.drink},
      {k:'shopping',keys:['shopping','marché','boutiques','boulangeries','casher'],t:a=>a.shop},
      {k:'visiter',keys:['que visiter','visiter','voir','musée','synagogue','attractions'],t:a=>a.visit},
      {k:'trésors cachés',keys:['trésors','cachés','secrets','peu connus'],t:a=>a.hidden_gems},
      {k:'expériences',keys:['expériences','balade','tour','itinéraire','coucher de soleil','photo'],t:a=>a.experiences},
      {k:'excursions',keys:['excursion','tivoli','ostia','castelli','journée'],t:a=>a.daytrips},
      {k:'urgence',keys:['urgence','police','ambulance','pompiers','médecin','vétérinaire'],t:a=>a.emergency}
    ]
  },

  de: {
    ui:{
      welcome:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button für eine schnelle Antwort.",
      placeholder:"Hallo, ich bin Samantha, dein virtueller Guide. Tippe auf einen Button — oder schreibe hier…",
      apt_label:"Apartment", voice_on:"🔊 Stimme: An", voice_off:"🔇 Stimme: Aus",
      quick:["WLAN","check in","check out","Wasser","Klimaanlage","Bad","Küche","Essen","Trinken","Shopping","Sehenswürdigkeiten","versteckte Perlen","Erlebnisse","Tagesausflüge","Verkehr","Services","Notfall"],
      fallback:"Keine direkte Antwort gefunden. Nutze einen Button (WLAN, Verkehr, Sehenswürdigkeiten…)."
    },
    apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Neben dem Bett: rechts steht eine Truhenbank mit dem Router darauf. SSID & Passwort stehen auf dem Etikett am Router.",
      wifi_ssid:"Siehe Router-Etikett", wifi_password:"Siehe Router-Etikett",
      water_note:"Leitungswasser ist trinkbar. Warmwasser ist jederzeit verfügbar.",
      ac_note:"Klimaanlage per Fernbedienung. Bitte beim Verlassen AUSSCHALTEN.",
      bathroom_amenities:"Toilettenpapier, Handseife, Badematte, Föhn.",
      towels_note:"Pro Gast: 1 großes + 1 mittleres Handtuch. Bett bei Ankunft gemacht.",
      kitchen_note:"Voll ausgestattete Küche.",
      intercom_note:"An der Haustür ist unsere Klingel der dritte Knopf von unten.",
      registration_note:"Bitte Fotos von zwei Ausweisen per WhatsApp zur Gästeregistrierung senden (gesetzlich vorgeschrieben).",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express – Via Arenula 41 • Conad City – Via di S. Maria del Pianto 4 • Punto Simply – Via dei Falegnami 4",
      pharmacies:"Farmacia della Reginella – Via della Reginella 25 • Farmacia Internazionale – Largo Arenula 14 (Englisch) • Farmacia San Salvatore – Piazza dell’Enciclopedia Italiana 53",
      luggage:"Radical Storage – Largo di Torre Argentina (5 Min zu Fuß)",
      laundry:"Waschsalon – Via Arenula 47",
      hospital:"Krankenhaus Fatebenefratelli – Tiberinsel",
      atms:"Unicredit (Largo Arenula 1) • BNL (Via Arenula 41) • Intesa (Via Arenula 27)",
      transport:"Tram 8 (Haltestelle Arenula/Cairoli) → Trastevere oder Piazza Venezia. Busse ab Largo Argentina. Taxi: +39 06 3570 oder FreeNow-App.",
      airports:"Fiumicino: Tram 8 → Bahnhof Trastevere → FL1 (~45 Min). Ciampino: Terravision-Bus oder Taxi. Privater Transfer: Welcome Pickups.",
      emergency:"EU-Notruf 112 • Polizei 113 • Rettung 118 • Feuerwehr 115 • Englischsprachiger Arzt +39 06 488 2371 • Tierarzt 24h +39 06 660 681",
      eat:"Giggetto al Portico d’Ottavia • Ba’Ghetto (Main & Bistrot) • Nonna Betta • Rimessa Roscioli • Il Giardino Romano • Sora Margherita • Yotvata (koscher, Milch).",
      drink:"Beppe e i Suoi Formaggi • Il Goccetto • Bar del Fico • Caffè del Portico • Bibliothè • Antico Caffè del Teatro di Marcello.",
      shop:"Via del Portico d’Ottavia (Handwerk & koschere Bäckereien) • Forno Boccione (ohne Schild) • Via Arenula Boutiquen • Jüdische Buchhandlung • Kosher Delight • Fischstände Piazza Costaguti (morgens).",
      visit:"Portico d’Ottavia • Theater des Marcellus • Große Synagoge & Jüdisches Museum (Sa & jüdische Feiertage geschlossen; Museum meist 10:00–17:00) • Piazza Mattei (Schildkrötenbrunnen) • Tiberinsel.",
      hidden_gems:"Torre dei Grassi • Ponte Emilio „Ponte Rotto“ (letzter Bogen) • Via della Reginella (sehr schmale Gasse).",
      experiences:"Geführte Touren im Ghetto • Jüdisch-römische Verkostungen • Abendspaziergang zu Campo de’ Fiori & Piazza Navona • Fotowalk durch versteckte Plätze • Radtour um die Tiberinsel.",
      daytrips:"Ostia Antica (~40 Min) • Tivoli (Villa d’Este & Hadriansvilla ~1h) • Castelli Romani.",
      checkout_note:"Vor der Abreise: Licht/AC aus, Fenster schließen, Schlüssel auf dem Tisch lassen, Tür sanft schließen."
    },
    intents:[
      {k:'WLAN',keys:['wlan','wifi','wi-fi','internet','passwort','router'],t:a=>`WLAN: ${a.wifi_note}\nNetz: ${a.wifi_ssid}. Passwort: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','ankunft','zugang','self check-in','eingang','sprechanlage','klingel'],t:a=>`Check-in ab ${a.checkin_time}.\nSprechanlage: ${a.intercom_note}\nRegistrierung: ${a.registration_note}\nHilfe? ${a.host_phone}.`},
      {k:'check out',keys:['check out','abreise','verlassen'],t:a=>a.checkout_note},
      {k:'Wasser',keys:['wasser','warmwasser','trinkbar','hahn','dusche'],t:a=>a.water_note},
      {k:'Klimaanlage',keys:['klimaanlage','klima','ac'],t:a=>a.ac_note},
      {k:'Bad',keys:['bad','handtücher','seife','föhn','ausstattung'],t:a=>`Bad: ${a.bathroom_amenities}\nHandtücher: ${a.towels_note}`},
      {k:'Küche',keys:['küche','kochen','herd','ofen'],t:a=>a.kitchen_note},
      {k:'Services',keys:['apotheke','krankenhaus','geldautomat','sim','wäscherei','gepäck','supermarkt','einkauf'],t:a=>`Supermärkte: ${a.supermarkets}\nApotheken: ${a.pharmacies}\nKrankenhaus: ${a.hospital}\nGeldautomaten: ${a.atms}\nWaschsalon: ${a.laundry}\nGepäck: ${a.luggage}`},
      {k:'Verkehr',keys:['verkehr','tram','bus','taxi','flughafen','zug','metro'],t:a=>`${a.transport}\nFlughäfen: ${a.airports}`},
      {k:'Essen',keys:['essen','restaurant','abendessen','mittagessen'],t:a=>a.eat},
      {k:'Trinken',keys:['trinken','bar','wein','cocktail','aperitif'],t:a=>a.drink},
      {k:'Shopping',keys:['shopping','markt','geschäfte','bäckereien','koscher'],t:a=>a.shop},
      {k:'Sehenswürdigkeiten',keys:['was sehen','besuchen','attraktionen','museum','synagoge'],t:a=>a.visit},
      {k:'versteckte Perlen',keys:['versteckt','geheim','perlen','weniger bekannt'],t:a=>a.hidden_gems},
      {k:'Erlebnisse',keys:['erlebnisse','spaziergang','tour','route','sonnenuntergang','foto'],t:a=>a.experiences},
      {k:'Tagesausflüge',keys:['tagesausflug','tivoli','ostia','castelli','ausflug'],t:a=>a.daytrips},
      {k:'Notfall',keys:['notfall','polizei','rettung','feuerwehr','arzt','tierarzt'],t:a=>a.emergency}
    ]
  },

  es: {
    ui:{
      welcome:"Hola, soy Samantha, tu guía virtual. Toca un botón para una respuesta rápida.",
      placeholder:"Hola, soy Samantha, tu guía virtual. Toca un botón — o escribe aquí…",
      apt_label:"Apartamento", voice_on:"🔊 Voz: Activada", voice_off:"🔇 Voz: Desactivada",
      quick:["wifi","check in","check out","agua","aire acondicionado","baño","cocina","comer","beber","compras","visitar","joyas ocultas","experiencias","excursiones","transporte","servicios","emergencia"],
      fallback:"No encontré una respuesta directa. Prueba un botón (wifi, transporte, visitar…)."
    },
    apt:{
      checkin_time:'15:00', checkout_time:'11:00',
      wifi_note:"Mira la cama: a la derecha hay un banco-baúl con el router encima. SSID y contraseña están en la etiqueta del router.",
      wifi_ssid:"Ver etiqueta del router", wifi_password:"Ver etiqueta del router",
      water_note:"El agua del grifo es potable. El agua caliente está siempre disponible.",
      ac_note:"El aire acondicionado funciona con mando. Apágalo al salir, por favor.",
      bathroom_amenities:"Papel higiénico, jabón de manos, alfombrilla, secador.",
      towels_note:"Por huésped: 1 toalla grande + 1 mediana. Cama preparada a la llegada.",
      kitchen_note:"Cocina completamente equipada.",
      intercom_note:"En la puerta del edificio, nuestra unidad es el tercer botón desde abajo.",
      registration_note:"Envía por WhatsApp fotos de dos documentos de identidad para el registro (obligatorio).",
      host_phone:"+39 335 5245756",
      supermarkets:"Carrefour Express – Via Arenula 41 • Conad City – Via di S. Maria del Pianto 4 • Punto Simply – Via dei Falegnami 4",
      pharmacies:"Farmacia della Reginella – Via della Reginella 25 • Farmacia Internazionale – Largo Arenula 14 (inglés) • Farmacia San Salvatore – Piazza dell’Enciclopedia Italiana 53",
      luggage:"Radical Storage – Largo di Torre Argentina (5 min a pie)",
      laundry:"Lavandería autoservicio – Via Arenula 47",
      hospital:"Hospital Fatebenefratelli – Isla Tiberina",
      atms:"Unicredit (Largo Arenula 1) • BNL (Via Arenula 41) • Intesa (Via Arenula 27)",
      transport:"Tranvía 8 (parada Arenula/Cairoli) → Trastevere o Piazza Venezia. Autobuses desde Largo Argentina. Taxi: +39 06 3570 o app FreeNow.",
      airports:"Fiumicino: Tranvía 8 → Estación Trastevere → FL1 (~45 min). Ciampino: bus Terravision o taxi. Traslado privado: Welcome Pickups.",
      emergency:"Emergencia UE 112 • Policía 113 • Ambulancia 118 • Bomberos 115 • Médico en inglés +39 06 488 2371 • Veterinario 24h +39 06 660 681",
      eat:"Giggetto al Portico d’Ottavia • Ba’Ghetto (Main & Bistrot) • Nonna Betta • Rimessa Roscioli • Il Giardino Romano • Sora Margherita • Yotvata (kosher lácteo).",
      drink:"Beppe e i Suoi Formaggi • Il Goccetto • Bar del Fico • Caffè del Portico • Bibliothè • Antico Caffè del Teatro di Marcello.",
      shop:"Via del Portico d’Ottavia (artesanía y panaderías kosher) • Forno Boccione (sin letrero) • Boutiques de Via Arenula • Librería judía • Kosher Delight • Puestos de pescado en Piazza Costaguti (mañanas).",
      visit:"Pórtico de Octavia • Teatro de Marcelo • Gran Sinagoga y Museo Judío (cerrado sábados y fiestas judías; museo suele 10:00–17:00) • Piazza Mattei (Fuente de las Tortugas) • Isla Tiberina.",
      hidden_gems:"Torre dei Grassi • Ponte Emilio «Ponte Rotto» (arco restante) • Via della Reginella (calle muy estrecha).",
      experiences:"Visitas guiadas por el Gueto • Degustaciones judeo-romanas • Paseo vespertino a Campo de’ Fiori y Piazza Navona • Photo walk por plazas escondidas • Ruta en bici alrededor de la Isla Tiberina.",
      daytrips:"Ostia Antica (~40 min) • Tivoli (Villa d’Este y Villa Adriana ~1h) • Castelli Romani.",
      checkout_note:"Antes de salir: apaga luces/AC, cierra ventanas, deja las llaves en la mesa y cierra la puerta suavemente."
    },
    intents:[
      {k:'wifi',keys:['wifi','wi-fi','internet','contraseña','router'],t:a=>`Wi-Fi: ${a.wifi_note}\nRed: ${a.wifi_ssid}. Contraseña: ${a.wifi_password}.`},
      {k:'check in',keys:['check in','llegada','self check-in','acceso','entrada','interfono','timbre'],t:a=>`Check-in desde las ${a.checkin_time}.\nInterfono: ${a.intercom_note}\nRegistro: ${a.registration_note}\n¿Necesitas ayuda? ${a.host_phone}.`},
      {k:'check out',keys:['check out','salida','marchar'],t:a=>a.checkout_note},
      {k:'agua',keys:['agua','caliente','potable','grifo','ducha'],t:a=>a.water_note},
      {k:'aire acondicionado',keys:['aire acondicionado','ac','clima'],t:a=>a.ac_note},
      {k:'baño',keys:['baño','toallas','jabón','secador','amenities'],t:a=>`Baño: ${a.bathroom_amenities}\nToallas: ${a.towels_note}`},
      {k:'cocina',keys:['cocina','cocinar','hornillos','estufa'],t:a=>a.kitchen_note},
      {k:'servicios',keys:['farmacia','hospital','cajero','sim','lavandería','equipaje','supermercado','compras'],t:a=>`Supermercados: ${a.supermarkets}\nFarmacias: ${a.pharmacies}\nHospital: ${a.hospital}\nCajeros: ${a.atms}\nLavandería: ${a.laundry}\nConsigna: ${a.luggage}`},
      {k:'transporte',keys:['transporte','tranvía','bus','taxi','aeropuerto','tren','metro'],t:a=>`${a.transport}\nAeropuertos: ${a.airports}`},
      {k:'comer',keys:['comer','restaurante','cena','almuerzo'],t:a=>a.eat},
      {k:'beber',keys:['beber','bar','vino','cóctel','aperitivo'],t:a=>a.drink},
      {k:'compras',keys:['compras','mercado','tiendas','panaderías','kosher'],t:a=>a.shop},
      {k:'visitar',keys:['qué visitar','visitar','ver','museo','sinagoga','atracciones'],t:a=>a.visit},
      {k:'joyas ocultas',keys:['oculto','secreto','joya','menos conocido'],t:a=>a.hidden_gems},
      {k:'experiencias',keys:['experiencias','paseo','tour','itinerario','atardecer','foto'],t:a=>a.experiences},
      {k:'excursiones',keys:['excursión','tivoli','ostia','castelli','día'],t:a=>a.daytrips},
      {k:'emergencia',keys:['emergencia','policía','ambulancia','bomberos','médico','veterinario'],t:a=>a.emergency}
    ]
  }
}; /* <-- CHIUDE const DATA */

/* ============ RILEVAMENTO LINGUA + UI ============ */
const chatEl = document.getElementById('chat');
const input  = document.getElementById('input');
const sendBtn= document.getElementById('sendBtn');

const url = new URL(location.href);
let lang = (url.searchParams.get('lang') || localStorage.getItem('lang') || (navigator.language||'en').slice(0,2)).toLowerCase();
if(!DATA[lang]) lang='en';
url.searchParams.set('lang',lang); history.replaceState(null,'',url);
localStorage.setItem('lang',lang);

/* ============ TTS MULTILINGUA (voci preferite) ============ */
let voiceOn=false, pick=null;
const VOICE_PREFS = {
  en:['Samantha','Google US English','Google UK English Female','Microsoft Aria Online (Natural)'],
  it:['Alice','Eloisa','Google italiano','Microsoft Elsa Online (Natural)','Microsoft Isabella Online (Natural)'],
  fr:['Amelie','Thomas','Google français','Microsoft Denise Online (Natural)','Microsoft Vivienne Online (Natural)'],
  de:['Anna','Markus','Google Deutsch','Microsoft Katja Online (Natural)','Microsoft Conrad Online (Natural)'],
  es:['Monica','Jorge','Paulina','Google español','Microsoft Alvaro Online (Natural)']
};
function selectVoice(){
  if(!('speechSynthesis' in window)) return null;
  const all = speechSynthesis.getVoices()||[];
  const prefs = VOICE_PREFS[lang]||[];
  for(const name of prefs){
    const v = all.find(v => (v.name||'').toLowerCase()===name.toLowerCase());
    if(v) return v;
  }
  const byLang = all.find(v => (v.lang||'').toLowerCase().startsWith(lang));
  return byLang || all[0] || null;
}
function refreshVoice(){ pick = selectVoice(); }
if('speechSynthesis' in window){ refreshVoice(); speechSynthesis.onvoiceschanged = refreshVoice; }
function warm(){
  if(!('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const dot = new SpeechSynthesisUtterance('.');
    dot.volume=0.01; if(pick) dot.voice=pick; dot.lang = pick?.lang || lang;
    speechSynthesis.speak(dot);
  }catch{}
}
function speak(t){
  if(!voiceOn || !('speechSynthesis' in window)) return;
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t);
    if(pick) u.voice=pick; u.lang = pick?.lang || lang;
    speechSynthesis.speak(u);
  }catch{}
}

document.getElementById('voiceBtn').addEventListener('click',e=>{
  voiceOn=!voiceOn; e.currentTarget.setAttribute('aria-pressed',String(voiceOn));
  applyUI(); if(voiceOn) warm();
});
document.querySelector('.lang').addEventListener('click',e=>{
  const btn=e.target.closest('[data-lang]'); if(!btn) return;
  lang = btn.getAttribute('data-lang');
  localStorage.setItem('lang',lang);
  const u=new URL(location.href); u.searchParams.set('lang',lang); history.replaceState(null,'',u);
  refreshVoice(); applyUI(); chatEl.innerHTML=''; welcome();
  if(voiceOn) warm();
});

function applyUI(){
  const L = DATA[lang].ui;
  document.getElementById('aptLabel').textContent = L.apt_label;
  document.getElementById('voiceBtn').textContent = voiceOn ? L.voice_on : L.voice_off;
  input.placeholder = L.placeholder;
  document.querySelectorAll('.lang [data-lang]').forEach(b=> b.setAttribute('aria-current', b.getAttribute('data-lang')===lang ? 'true':'false'));
}

/* ============ CHAT LOGIC ============ */
function add(type, txt){
  const d=document.createElement('div');
  d.className='msg '+(type==='me'?'me':'wd');
  d.textContent=txt;
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
}

function detectIntent(text){
  const L = DATA[lang]; const t = (text||'').toLowerCase();
  let best=null,score=0;
  for(const it of L.intents){
    let s=0; for(const k of it.keys){ if(t.includes(k.toLowerCase())) s++; }
    if(s>score){ score=s; best=it; }
  }
  return best;
}

function answerFor(text){
  const L = DATA[lang];
  const apt = L.apt;
  const m = detectIntent(text);
  if(!m) return L.ui.fallback;
  try{ return m.t(apt); }catch{ return L.ui.fallback; }
}

function welcome(){
  const L=DATA[lang].ui;
  const intro=document.createElement('div'); intro.className='intro';
  intro.innerHTML = `<b>${L.welcome}</b>`;
  chatEl.appendChild(intro);
  const q=document.createElement('div'); q.className='quick';
  for(const key of L.quick){
    const b=document.createElement('button'); b.textContent=key;
    b.onclick=()=>{ input.value=key; send(); };
    q.appendChild(b);
  }
  chatEl.appendChild(q);
}

function send(){
  const text=(input.value||'').trim(); if(!text) return;
  add('me',text); input.value='';
  const bot=answerFor(text);
  add('wd',bot); speak(bot);
}

sendBtn.addEventListener('click',send);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') send(); });

applyUI(); welcome();
</script>
</body>
</html>
